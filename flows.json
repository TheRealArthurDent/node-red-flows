[
    {
        "id": "a09414b5.859f68",
        "type": "tab",
        "label": "Shutters",
        "disabled": false,
        "info": ""
    },
    {
        "id": "615f1b13.386e84",
        "type": "tab",
        "label": "Stop reason - doesn't work",
        "disabled": false,
        "info": ""
    },
    {
        "id": "9c0f9de.b23666",
        "type": "tab",
        "label": "Illumination",
        "disabled": false,
        "info": ""
    },
    {
        "id": "60c03b99.7554f4",
        "type": "tab",
        "label": "Presence detection",
        "disabled": false,
        "info": ""
    },
    {
        "id": "94c83aa3.f236d8",
        "type": "tab",
        "label": "Evening detection",
        "disabled": false,
        "info": ""
    },
    {
        "id": "c13d8339.426df",
        "type": "tab",
        "label": "Stop Sonos",
        "disabled": false,
        "info": ""
    },
    {
        "id": "4b1f3e4c.b2604",
        "type": "tab",
        "label": "Roomba",
        "disabled": false,
        "info": ""
    },
    {
        "id": "a8a95e02.bf408",
        "type": "tab",
        "label": "Spielerei",
        "disabled": false,
        "info": ""
    },
    {
        "id": "8e42c1ce474ca950",
        "type": "tab",
        "label": "Weather warnings",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "9de561f7972ae9bc",
        "type": "tab",
        "label": "Button | Good night",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f6761c15b55e2d63",
        "type": "tab",
        "label": "Bedroom | Changing cloth",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c4f89efe363c2ef8",
        "type": "tab",
        "label": "Direct Button actions",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "9d832c5af722ac78",
        "type": "tab",
        "label": "Get up, stand up!",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "acc19fe5f27ac7a1",
        "type": "tab",
        "label": "Various Timers",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "2595f1ad.a5eb8e",
        "type": "subflow",
        "name": "Conditional shutter action",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 80,
                "wires": [
                    {
                        "id": "57dcb3ef.f0a21c"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1260,
                "y": 80,
                "wires": [
                    {
                        "id": "52c568a8f8c48224",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "shutter.name",
                "type": "str",
                "value": ""
            },
            {
                "name": "half-open-position",
                "type": "num",
                "value": "50"
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "16c9c5c.ad34a3a",
        "type": "subflow",
        "name": "Office shutter",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 80,
                "wires": [
                    {
                        "id": "0a3db6c5b236b791"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1060,
                "y": 840,
                "wires": [
                    {
                        "id": "81c539e1.7f02c8",
                        "port": 1
                    },
                    {
                        "id": "81c539e1.7f02c8",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "ef57397d.2bd4c8",
        "type": "subflow",
        "name": "Unless already closed",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 100,
                "y": 80,
                "wires": [
                    {
                        "id": "36c43e5a.a6d732"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 900,
                "y": 80,
                "wires": [
                    {
                        "id": "73b871fe.7489c",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "3206442.27205bc",
        "type": "subflow",
        "name": "Presence changed",
        "info": "",
        "category": "",
        "in": [],
        "out": [
            {
                "x": 1080,
                "y": 140,
                "wires": [
                    {
                        "id": "368b7b5a.a74604",
                        "port": 0
                    },
                    {
                        "id": "9b7c9b61.875668",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "ee56faad.f111e8",
        "type": "subflow",
        "name": "Check roomba preconditions",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 80,
                "wires": [
                    {
                        "id": "a34e0cf7.01b1e"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1160,
                "y": 400,
                "wires": [
                    {
                        "id": "7571090c.6ad398",
                        "port": 1
                    },
                    {
                        "id": "ed34009d.dac06",
                        "port": 1
                    },
                    {
                        "id": "a34e0cf7.01b1e",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1160,
                "y": 280,
                "wires": [
                    {
                        "id": "fb1b78e1.99c688",
                        "port": 0
                    },
                    {
                        "id": "fe33c2f0.ebe59",
                        "port": 0
                    },
                    {
                        "id": "2cb039d1.d5bfd6",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "72258bd0d3dfaa6d",
        "type": "subflow",
        "name": "Keep eastern shutters closed",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 100,
                "wires": [
                    {
                        "id": "e2089093bdce2db2"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1140,
                "y": 220,
                "wires": [
                    {
                        "id": "0a5e75c9c16b1027",
                        "port": 0
                    },
                    {
                        "id": "0a5e75c9c16b1027",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "threshold.tempMax",
                "type": "num",
                "value": "24"
            },
            {
                "name": "threshold.clouds",
                "type": "num",
                "value": "30"
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "893d1cfdd62ef503",
        "type": "subflow",
        "name": "Unless already open",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 120,
                "wires": [
                    {
                        "id": "b3a946ac74282633"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 840,
                "y": 120,
                "wires": [
                    {
                        "id": "09f918ba14fce27a",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "c6d3de9075efb38f",
        "type": "subflow",
        "name": "Get current and desired position",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 140,
                "y": 80,
                "wires": [
                    {
                        "id": "dcf0bdcbe68c4533"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1060,
                "y": 360,
                "wires": [
                    {
                        "id": "962a8cf0fab5e00d",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "shutter.name",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "76dd2645ea70b9ac",
        "type": "subflow",
        "name": "Create mqtt message",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 200,
                "y": 80,
                "wires": [
                    {
                        "id": "3e3d3992a11cbd69"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 520,
                "y": 80,
                "wires": [
                    {
                        "id": "3e3d3992a11cbd69",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "shutter-name",
                "type": "str",
                "value": ""
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "7adf4d18a6dba978",
        "type": "subflow",
        "name": "Close shutters based on sensor data",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 100,
                "y": 60,
                "wires": [
                    {
                        "id": "dc581ad77af97b71"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 760,
                "y": 260,
                "wires": [
                    {
                        "id": "98f07d0221c344b5",
                        "port": 0
                    }
                ]
            },
            {
                "x": 760,
                "y": 300,
                "wires": [
                    {
                        "id": "98f07d0221c344b5",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "a50e9ae33aac98c4",
        "type": "subflow",
        "name": "Weather warnings telegram",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 140,
                "y": 120,
                "wires": [
                    {
                        "id": "fe9df3f33d9425cc"
                    },
                    {
                        "id": "af327074f1bc870d"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1560,
                "y": 300,
                "wires": [
                    {
                        "id": "ceb504474e8b6ae6",
                        "port": 0
                    },
                    {
                        "id": "345bbe669ce966c3",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "7efede71724c22bc",
        "type": "subflow",
        "name": "Get object properties from iobroker",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 80,
                "wires": [
                    {
                        "id": "2082d639cde13352"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1220,
                "y": 80,
                "wires": [
                    {
                        "id": "109b42c3efde0f57",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "topic",
                "type": "str",
                "value": ""
            },
            {
                "name": "attribute-names",
                "type": "str",
                "value": "value"
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "c144853baeb5f845",
        "type": "subflow",
        "name": "Double click",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 100,
                "y": 140,
                "wires": [
                    {
                        "id": "ba18a69ab61eeeac"
                    },
                    {
                        "id": "d44980ba9fbc8af9"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 790,
                "y": 120,
                "wires": [
                    {
                        "id": "d44980ba9fbc8af9",
                        "port": 0
                    }
                ]
            },
            {
                "x": 790,
                "y": 180,
                "wires": [
                    {
                        "id": "d44980ba9fbc8af9",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99",
        "outputLabels": [
            "single",
            "double"
        ]
    },
    {
        "id": "a0bf89c9c0c89918",
        "type": "subflow",
        "name": "Timed dimmer",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 100,
                "wires": [
                    {
                        "id": "080e65a6b93f9aed"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1300,
                "y": 100,
                "wires": [
                    {
                        "id": "d3e777f121037316",
                        "port": 0
                    }
                ]
            },
            {
                "x": 1330,
                "y": 280,
                "wires": [
                    {
                        "id": "14b46e87adb10456",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "ID",
                "type": "str",
                "value": "",
                "ui": {
                    "type": "input",
                    "opts": {
                        "types": [
                            "str"
                        ]
                    }
                }
            },
            {
                "name": "START_VALUE",
                "type": "num",
                "value": "0",
                "ui": {
                    "type": "input",
                    "opts": {
                        "types": [
                            "num",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "END_VALUE",
                "type": "num",
                "value": "255",
                "ui": {
                    "type": "input",
                    "opts": {
                        "types": [
                            "num",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "DURATION_CHANGE",
                "type": "num",
                "value": "30",
                "ui": {
                    "icon": "font-awesome/fa-clock-o",
                    "type": "input",
                    "opts": {
                        "types": [
                            "num",
                            "env"
                        ]
                    }
                }
            },
            {
                "name": "DURATION_HOLD",
                "type": "str",
                "value": "30"
            }
        ],
        "meta": {},
        "color": "#DDAA99",
        "inputLabels": [
            "start"
        ],
        "outputLabels": [
            "new value",
            "reset"
        ]
    },
    {
        "id": "9c37ac267425c096",
        "type": "subflow",
        "name": "Move shutter to desired position",
        "info": "Creates a command to move the specified shutter to it's last desired position in case it's not already there.\r\nWill not forward the message in case current and desired positions are equal.",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 60,
                "wires": [
                    {
                        "id": "f2066a039a46dfa1"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1020,
                "y": 60,
                "wires": [
                    {
                        "id": "145cb51adbe06f65",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "shutter.name",
                "type": "str",
                "value": "",
                "ui": {
                    "type": "input",
                    "opts": {
                        "types": [
                            "str",
                            "env"
                        ]
                    }
                }
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "1b53c3a9bc37dc0e",
        "type": "subflow",
        "name": "Terrasse light on",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 120,
                "wires": [
                    {
                        "id": "e41ffe2ba458ac80"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 980,
                "y": 120,
                "wires": [
                    {
                        "id": "2bc543c4d2e41610",
                        "port": 1
                    }
                ]
            },
            {
                "x": 980,
                "y": 180,
                "wires": [
                    {
                        "id": "2bc543c4d2e41610",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "395982643a88a924",
        "type": "subflow",
        "name": "Get solar events",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 120,
                "y": 100,
                "wires": [
                    {
                        "id": "4964491c2915304a"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 860,
                "y": 100,
                "wires": [
                    {
                        "id": "71638ab9082b6109",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "latitude",
                "type": "num",
                "value": "48.18609507662278"
            },
            {
                "name": "longitude",
                "type": "num",
                "value": "11.596313697132464"
            },
            {
                "name": "date",
                "type": "str",
                "value": "today"
            }
        ],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "f1f93d18.375ea",
        "type": "mqtt-broker",
        "name": "mosquitto",
        "broker": "mosquitto",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "compatmode": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "subscribers/node-red/connection-status",
        "birthQos": "1",
        "birthPayload": "CONNECTED",
        "birthMsg": {},
        "closeTopic": "subscribers/node-red/connection-status",
        "closeQos": "1",
        "closePayload": "DISCONNECTING",
        "closeMsg": {},
        "willTopic": "subscribers/node-red/connection-status",
        "willQos": "1",
        "willRetain": "true",
        "willPayload": "DISCONNECTED",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "9a755bfc.1124c8",
        "type": "sonos-config",
        "name": "Sonos Büro",
        "serialnum": "",
        "ipaddress": "192.168.1.61"
    },
    {
        "id": "e440dc25.3eb78",
        "type": "sonos-config",
        "name": "Sonos Wohnzimmer",
        "serialnum": "",
        "ipaddress": "192.168.1.88"
    },
    {
        "id": "abb06234.e8fcf",
        "type": "telegram bot",
        "botname": "Test",
        "usernames": "",
        "chatids": "",
        "baseapiurl": "",
        "updatemode": "polling",
        "pollinterval": "1800",
        "usesocks": false,
        "sockshost": "",
        "socksport": "6667",
        "socksusername": "anonymous",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbotport": "8443",
        "publicbotport": "8443",
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": true
    },
    {
        "id": "f88b4105.9be82",
        "type": "telegrambot-config",
        "z": "4b1f3e4c.b2604",
        "botname": "Roomba",
        "usernames": "",
        "chatIds": "-474645721",
        "pollInterval": "300"
    },
    {
        "id": "35f160c4.6ef4d",
        "type": "telegram bot",
        "botname": "Roomba_sendOnly",
        "usernames": "",
        "chatids": "",
        "baseapiurl": "",
        "updatemode": "none",
        "pollinterval": "300",
        "usesocks": false,
        "sockshost": "",
        "socksport": "6667",
        "socksusername": "anonymous",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbotport": "8443",
        "publicbotport": "8443",
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": false
    },
    {
        "id": "966aead04bc37acf",
        "type": "deconz-server",
        "name": "Phoscon-GW",
        "config_version": 1,
        "ip": "deconz.outbound",
        "port": "443",
        "ws_port": "8443",
        "secure": false,
        "polling": "15"
    },
    {
        "id": "a641922fff0cd09a",
        "type": "sonos-config",
        "name": "Sonos Bad",
        "serialnum": "",
        "ipaddress": "192.168.1.67"
    },
    {
        "id": "57dcb3ef.f0a21c",
        "type": "change",
        "z": "2595f1ad.a5eb8e",
        "name": "Decode target position",
        "rules": [
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "half-open",
                "fromt": "str",
                "to": "half-open-position",
                "tot": "env"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "open",
                "fromt": "str",
                "to": "100",
                "tot": "num"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "closed",
                "fromt": "str",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 210,
        "y": 80,
        "wires": [
            [
                "8a0d20bf3b088033"
            ]
        ]
    },
    {
        "id": "d1df22e1bade53d1",
        "type": "ioBroker out",
        "z": "2595f1ad.a5eb8e",
        "name": "Safe desired position",
        "topic": "",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "Last automatically requested shutter position",
        "role": "value",
        "payloadType": "number",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1340,
        "y": 140,
        "wires": []
    },
    {
        "id": "37f7eef31442242b",
        "type": "change",
        "z": "2595f1ad.a5eb8e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "desiredPositionName",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1050,
        "y": 140,
        "wires": [
            [
                "d1df22e1bade53d1"
            ]
        ]
    },
    {
        "id": "8a0d20bf3b088033",
        "type": "subflow:c6d3de9075efb38f",
        "z": "2595f1ad.a5eb8e",
        "name": "",
        "env": [
            {
                "name": "shutter.name",
                "value": "${shutter-name}",
                "type": "env"
            }
        ],
        "x": 490,
        "y": 80,
        "wires": [
            [
                "190e5e0473edc8db"
            ]
        ]
    },
    {
        "id": "52c568a8f8c48224",
        "type": "subflow:76dd2645ea70b9ac",
        "z": "2595f1ad.a5eb8e",
        "name": "",
        "env": [
            {
                "name": "shutter-name",
                "value": "${shutter-name}",
                "type": "env"
            }
        ],
        "x": 1080,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "190e5e0473edc8db",
        "type": "function",
        "z": "2595f1ad.a5eb8e",
        "name": "Determine action",
        "func": "if(msg.preventMovement) {\n    msg.reason = \"preventMovement is active. Shutters will not be moved.\"\n    msg.payload = \"Don't move.\"\n    return [null, msg];    \n}\nif(msg.lastDesiredPosition === undefined || msg.currentPosition === msg.lastDesiredPosition) {\n    msg.reason = 'Moving shutter. No manual change detected.'\n    return [msg, null];\n}\nif(msg.overrideManualChange) {\n    msg.reason = 'Moving shutter. Overriding manual change due to msg.overrideManualChange.'\n    return [msg, null];\n}\nmsg.reason = \"Manual change detected. Shutters will not be moved.\"\nmsg.payload = \"Don't move.\"\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 80,
        "wires": [
            [
                "37f7eef31442242b",
                "52c568a8f8c48224",
                "ec982b1846210bfd"
            ],
            [
                "ec982b1846210bfd"
            ]
        ]
    },
    {
        "id": "ec982b1846210bfd",
        "type": "debug",
        "z": "2595f1ad.a5eb8e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 200,
        "wires": []
    },
    {
        "id": "863fd4bd.e4a498",
        "type": "switch",
        "z": "16c9c5c.ad34a3a",
        "name": "Shutter fully opened",
        "property": "position",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "95",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 340,
        "y": 280,
        "wires": [
            [
                "b69e3aec.a19fb8"
            ],
            [
                "7a71410b.01a41"
            ]
        ]
    },
    {
        "id": "c3bcffda.1755",
        "type": "ioBroker get",
        "z": "16c9c5c.ad34a3a",
        "name": "get shutter office position",
        "topic": "mqtt-client.0.shellies.shutter-office.roller.0.pos",
        "attrname": "position",
        "payloadType": "value",
        "x": 350,
        "y": 220,
        "wires": [
            [
                "863fd4bd.e4a498"
            ]
        ]
    },
    {
        "id": "7a71410b.01a41",
        "type": "debug",
        "z": "16c9c5c.ad34a3a",
        "name": "not fully opened",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Shutter not fully opened.\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 280,
        "wires": []
    },
    {
        "id": "b69e3aec.a19fb8",
        "type": "weekday",
        "z": "16c9c5c.ad34a3a",
        "name": "",
        "sun": true,
        "mon": false,
        "tue": false,
        "wed": false,
        "thu": false,
        "fri": false,
        "sat": true,
        "x": 300,
        "y": 400,
        "wires": [
            [
                "ff251e04.5ed32"
            ],
            [
                "5aa1be54.76e8e"
            ]
        ]
    },
    {
        "id": "ff251e04.5ed32",
        "type": "debug",
        "z": "16c9c5c.ad34a3a",
        "name": "weekend",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Weekend. Happy days!\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 400,
        "wires": []
    },
    {
        "id": "3a9c20fc.4392a",
        "type": "comment",
        "z": "16c9c5c.ad34a3a",
        "name": "presence marijke / mika BMW Laptop",
        "info": "",
        "x": 510,
        "y": 480,
        "wires": []
    },
    {
        "id": "3d5cafb1.9eca1",
        "type": "comment",
        "z": "16c9c5c.ad34a3a",
        "name": "clouds",
        "info": "",
        "x": 510,
        "y": 700,
        "wires": []
    },
    {
        "id": "5aa1be54.76e8e",
        "type": "ioBroker get",
        "z": "16c9c5c.ad34a3a",
        "name": "Marijke present",
        "topic": "fb-checkpresence.0.Marijke Android.presence",
        "attrname": "presence_marijke",
        "payloadType": "value",
        "x": 320,
        "y": 540,
        "wires": [
            [
                "a6c4695f.4255d8"
            ]
        ]
    },
    {
        "id": "a6c4695f.4255d8",
        "type": "switch",
        "z": "16c9c5c.ad34a3a",
        "name": "Marijke present",
        "property": "presence_marijke",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 320,
        "y": 600,
        "wires": [
            [
                "96e34ef3.99229"
            ],
            [
                "2ca4f3bb.97bd8c"
            ]
        ]
    },
    {
        "id": "2ca4f3bb.97bd8c",
        "type": "ioBroker get",
        "z": "16c9c5c.ad34a3a",
        "name": "Mika present",
        "topic": "fb-checkpresence.0.Mika Android.presence",
        "attrname": "presence_mika",
        "payloadType": "value",
        "x": 690,
        "y": 540,
        "wires": [
            [
                "fb228325.cfb73"
            ]
        ]
    },
    {
        "id": "fb228325.cfb73",
        "type": "switch",
        "z": "16c9c5c.ad34a3a",
        "name": "Mika present",
        "property": "presence_mika",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 690,
        "y": 600,
        "wires": [
            [
                "96e34ef3.99229"
            ],
            [
                "59d924fe.655d7c"
            ]
        ]
    },
    {
        "id": "96e34ef3.99229",
        "type": "ioBroker get",
        "z": "16c9c5c.ad34a3a",
        "name": "Actual clouds for today",
        "topic": "openweathermap.0.forecast.current.clouds",
        "attrname": "clouds",
        "payloadType": "value",
        "x": 340,
        "y": 740,
        "wires": [
            [
                "81c539e1.7f02c8"
            ]
        ]
    },
    {
        "id": "59d924fe.655d7c",
        "type": "debug",
        "z": "16c9c5c.ad34a3a",
        "name": "nobody working",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Nobody's workin fella.\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 990,
        "y": 600,
        "wires": []
    },
    {
        "id": "81c539e1.7f02c8",
        "type": "switch",
        "z": "16c9c5c.ad34a3a",
        "name": "",
        "property": "clouds",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "60",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 290,
        "y": 800,
        "wires": [
            [
                "406e6639.caa928"
            ],
            [
                "6f645173.19f59"
            ]
        ]
    },
    {
        "id": "406e6639.caa928",
        "type": "debug",
        "z": "16c9c5c.ad34a3a",
        "name": "cloudy",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"It is cloudy. Clouds: \" & clouds",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 960,
        "y": 780,
        "wires": []
    },
    {
        "id": "224263b9.baa8dc",
        "type": "comment",
        "z": "16c9c5c.ad34a3a",
        "name": "weekend?",
        "info": "",
        "x": 520,
        "y": 360,
        "wires": []
    },
    {
        "id": "6f645173.19f59",
        "type": "debug",
        "z": "16c9c5c.ad34a3a",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "\"Go\" & clouds",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 860,
        "wires": []
    },
    {
        "id": "0a3db6c5b236b791",
        "type": "function",
        "z": "16c9c5c.ad34a3a",
        "name": "no action during summer",
        "func": "function addDays(date, days) {\n  var result = new Date(date);\n  result.setDate(result.getDate() + days);\n  return result;\n}\n\n// longest day of the year is midsommar - 21.06.####\n// deactivate function during summer (21.06. +/- n days)\nvar daysAroundMidsommar = 30;\nvar today = new Date();\n// node.warn('today ' + today);\nvar midsommar = new Date(today.getFullYear(), 5, 21);\nvar startDate = addDays(midsommar, -1 * daysAroundMidsommar);\n// node.warn('startDate: ' + startDate);\nvar endDate = addDays(midsommar, daysAroundMidsommar);\n//node.warn('endDate: ' + endDate);\n\nif (startDate < today && today < endDate) {\n    return [null, msg];\n}\nreturn [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 80,
        "wires": [
            [
                "c3bcffda.1755"
            ],
            [
                "b76879b65b9f4091"
            ]
        ]
    },
    {
        "id": "b76879b65b9f4091",
        "type": "debug",
        "z": "16c9c5c.ad34a3a",
        "name": "summer!",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Summer time! Sun is too high, so we don't need to shut.\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 80,
        "wires": []
    },
    {
        "id": "36c43e5a.a6d732",
        "type": "ioBroker get",
        "z": "ef57397d.2bd4c8",
        "name": "get shutter bedroom position",
        "topic": "mqtt-client.0.shellies.shutter-bedroom.roller.0.pos",
        "attrname": "position",
        "payloadType": "value",
        "x": 300,
        "y": 80,
        "wires": [
            [
                "73b871fe.7489c"
            ]
        ]
    },
    {
        "id": "73b871fe.7489c",
        "type": "switch",
        "z": "ef57397d.2bd4c8",
        "name": "",
        "property": "position",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "50",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 570,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "be0262c4.57185",
        "type": "ioBroker in",
        "z": "3206442.27205bc",
        "name": "Marijke Android.presence",
        "topic": "fb-checkpresence.0.Marijke Android.presence",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "x": 170,
        "y": 100,
        "wires": [
            [
                "e9805d9c.537d8"
            ]
        ]
    },
    {
        "id": "e9805d9c.537d8",
        "type": "switch",
        "z": "3206442.27205bc",
        "name": "Marijke present",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 400,
        "y": 100,
        "wires": [
            [
                "9b7c9b61.875668"
            ],
            [
                "6603d69.d113628"
            ]
        ]
    },
    {
        "id": "d880c877.2aad18",
        "type": "ioBroker in",
        "z": "3206442.27205bc",
        "name": "Mika Android.presence",
        "topic": "fb-checkpresence.0.Mika Android.presence",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "x": 160,
        "y": 280,
        "wires": [
            [
                "1a2a88f9.630667"
            ]
        ]
    },
    {
        "id": "1a2a88f9.630667",
        "type": "switch",
        "z": "3206442.27205bc",
        "name": "Mika present",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 280,
        "wires": [
            [
                "9b7c9b61.875668"
            ],
            [
                "ee07e4e1.e54ad8"
            ]
        ]
    },
    {
        "id": "ee07e4e1.e54ad8",
        "type": "ioBroker get",
        "z": "3206442.27205bc",
        "name": "Marijke present",
        "topic": "fb-checkpresence.0.Marijke Android.presence",
        "attrname": "presence_marijke",
        "payloadType": "value",
        "x": 600,
        "y": 280,
        "wires": [
            [
                "3bc8a4e5.34419c"
            ]
        ]
    },
    {
        "id": "3bc8a4e5.34419c",
        "type": "switch",
        "z": "3206442.27205bc",
        "name": "Marijke present",
        "property": "presence_marijke",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 600,
        "y": 340,
        "wires": [
            [
                "9b7c9b61.875668"
            ],
            [
                "368b7b5a.a74604"
            ]
        ]
    },
    {
        "id": "368b7b5a.a74604",
        "type": "change",
        "z": "3206442.27205bc",
        "name": "false",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 340,
        "wires": [
            [
                "571ecc11.ce6684"
            ]
        ]
    },
    {
        "id": "9b7c9b61.875668",
        "type": "change",
        "z": "3206442.27205bc",
        "name": "true",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 20,
        "wires": [
            [
                "571ecc11.ce6684"
            ]
        ]
    },
    {
        "id": "6603d69.d113628",
        "type": "ioBroker get",
        "z": "3206442.27205bc",
        "name": "Mika present",
        "topic": "fb-checkpresence.0.Mika Android.presence",
        "attrname": "presence_mika",
        "payloadType": "value",
        "x": 590,
        "y": 100,
        "wires": [
            [
                "bdc57581.a20bc8"
            ]
        ]
    },
    {
        "id": "bdc57581.a20bc8",
        "type": "switch",
        "z": "3206442.27205bc",
        "name": "Mika present",
        "property": "presence_mika",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 160,
        "wires": [
            [
                "9b7c9b61.875668"
            ],
            [
                "368b7b5a.a74604"
            ]
        ]
    },
    {
        "id": "571ecc11.ce6684",
        "type": "ioBroker out",
        "z": "3206442.27205bc",
        "name": "presence",
        "topic": "presence.presence",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "presence.presence",
        "role": "indicator",
        "payloadType": "boolean",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1120,
        "y": 200,
        "wires": []
    },
    {
        "id": "6c60671c.238d48",
        "type": "ioBroker get",
        "z": "ee56faad.f111e8",
        "name": "",
        "topic": "roomba.0.states.binFull",
        "attrname": "payload",
        "payloadType": "value",
        "x": 450,
        "y": 180,
        "wires": [
            [
                "8af4e7f1.9e04a8"
            ]
        ]
    },
    {
        "id": "6ec55d4a.7f1fd4",
        "type": "ioBroker get",
        "z": "ee56faad.f111e8",
        "name": "",
        "topic": "roomba.0.states.battery",
        "attrname": "payload",
        "payloadType": "value",
        "x": 450,
        "y": 280,
        "wires": [
            [
                "7571090c.6ad398"
            ]
        ]
    },
    {
        "id": "8af4e7f1.9e04a8",
        "type": "switch",
        "z": "ee56faad.f111e8",
        "name": "bin full",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 690,
        "y": 180,
        "wires": [
            [
                "fe33c2f0.ebe59"
            ],
            [
                "6ec55d4a.7f1fd4"
            ]
        ]
    },
    {
        "id": "fe33c2f0.ebe59",
        "type": "template",
        "z": "ee56faad.f111e8",
        "name": "bin full",
        "field": "payload",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "My dustbin is full. :(",
        "output": "str",
        "x": 930,
        "y": 180,
        "wires": [
            [
                "96293c53.6913e"
            ]
        ]
    },
    {
        "id": "7571090c.6ad398",
        "type": "switch",
        "z": "ee56faad.f111e8",
        "name": "battery low",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lte",
                "v": "70",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 710,
        "y": 280,
        "wires": [
            [
                "fb1b78e1.99c688"
            ],
            []
        ]
    },
    {
        "id": "96293c53.6913e",
        "type": "debug",
        "z": "ee56faad.f111e8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1210,
        "y": 180,
        "wires": []
    },
    {
        "id": "fb1b78e1.99c688",
        "type": "template",
        "z": "ee56faad.f111e8",
        "name": "battery low",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "My battery is low! :( {{payload}}%",
        "output": "str",
        "x": 950,
        "y": 280,
        "wires": [
            [
                "96293c53.6913e"
            ]
        ]
    },
    {
        "id": "a34e0cf7.01b1e",
        "type": "switch",
        "z": "ee56faad.f111e8",
        "name": "switch command type",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "/dock",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 440,
        "y": 80,
        "wires": [
            [],
            [
                "6c60671c.238d48"
            ]
        ]
    },
    {
        "id": "e1285c9f.1bc13",
        "type": "ioBroker get",
        "z": "ee56faad.f111e8",
        "name": "",
        "topic": "roomba.0.states.docked",
        "attrname": "payload",
        "payloadType": "value",
        "x": 450,
        "y": 520,
        "wires": [
            [
                "ed34009d.dac06"
            ]
        ]
    },
    {
        "id": "ed34009d.dac06",
        "type": "switch",
        "z": "ee56faad.f111e8",
        "name": "docked",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 700,
        "y": 520,
        "wires": [
            [
                "2cb039d1.d5bfd6"
            ],
            []
        ]
    },
    {
        "id": "2cb039d1.d5bfd6",
        "type": "template",
        "z": "ee56faad.f111e8",
        "name": "docked",
        "field": "payload",
        "fieldType": "msg",
        "format": "text",
        "syntax": "plain",
        "template": "I am already docked.",
        "output": "str",
        "x": 940,
        "y": 520,
        "wires": [
            [
                "96293c53.6913e"
            ]
        ]
    },
    {
        "id": "fd0a0006.d6184",
        "type": "comment",
        "z": "ee56faad.f111e8",
        "name": "That doesn't really work.",
        "info": "Roomba (or the iobroker adapter) do not reliably updated the \"docked\" attribute. Hence this check can prevent you from sending Roomba home, even if it's currently cleaning.",
        "x": 450,
        "y": 480,
        "wires": []
    },
    {
        "id": "c548a4a8c9925c9c",
        "type": "debug",
        "z": "72258bd0d3dfaa6d",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1170,
        "y": 260,
        "wires": []
    },
    {
        "id": "e2089093bdce2db2",
        "type": "ioBroker get",
        "z": "72258bd0d3dfaa6d",
        "name": "Maximum temperature for today",
        "topic": "openweathermap.0.forecast.day0.temperatureMax",
        "attrname": "tempMax",
        "payloadType": "value",
        "errOnInvalidState": "nothing",
        "x": 350,
        "y": 100,
        "wires": [
            [
                "d9c4aa15c9801f9b"
            ]
        ]
    },
    {
        "id": "d9c4aa15c9801f9b",
        "type": "ioBroker get",
        "z": "72258bd0d3dfaa6d",
        "name": "Clouds for today",
        "topic": "openweathermap.0.forecast.day0.clouds",
        "attrname": "clouds",
        "payloadType": "value",
        "errOnInvalidState": "nothing",
        "x": 300,
        "y": 160,
        "wires": [
            [
                "dccdeea20d62d04f"
            ]
        ]
    },
    {
        "id": "c819f65c76b045d1",
        "type": "comment",
        "z": "72258bd0d3dfaa6d",
        "name": "",
        "info": "Also consider inside temperature (github issue 16)",
        "x": 280,
        "y": 220,
        "wires": []
    },
    {
        "id": "dccdeea20d62d04f",
        "type": "function",
        "z": "72258bd0d3dfaa6d",
        "name": "Determine open shutters",
        "func": "if (msg.tempMax > env.get(\"threshold.tempMax\") \n    && msg.clouds < env.get(\"threshold.clouds\")) {\n    msg.payload = 40;\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 550,
        "y": 220,
        "wires": [
            [
                "0a5e75c9c16b1027"
            ]
        ]
    },
    {
        "id": "0a5e75c9c16b1027",
        "type": "subflow:7adf4d18a6dba978",
        "z": "72258bd0d3dfaa6d",
        "name": "",
        "x": 870,
        "y": 220,
        "wires": [
            [
                "c548a4a8c9925c9c"
            ],
            []
        ]
    },
    {
        "id": "b3a946ac74282633",
        "type": "ioBroker get",
        "z": "893d1cfdd62ef503",
        "name": "get shutter bedroom position",
        "topic": "mqtt-client.0.shellies.shutter-bedroom.roller.0.pos",
        "attrname": "position",
        "payloadType": "value",
        "x": 380,
        "y": 120,
        "wires": [
            [
                "09f918ba14fce27a"
            ]
        ]
    },
    {
        "id": "09f918ba14fce27a",
        "type": "switch",
        "z": "893d1cfdd62ef503",
        "name": "",
        "property": "position",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "50",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 650,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "dcf0bdcbe68c4533",
        "type": "change",
        "z": "c6d3de9075efb38f",
        "name": "ioBroker value names",
        "rules": [
            {
                "t": "set",
                "p": "desiredPositionName",
                "pt": "msg",
                "to": "0_userdata.0.shutters.${shutter.name}.desiredPosition",
                "tot": "env"
            },
            {
                "t": "set",
                "p": "currentPositionName",
                "pt": "msg",
                "to": "mqtt-client.0.shellies.shutter-${shutter.name}.roller.0.pos",
                "tot": "env"
            },
            {
                "t": "set",
                "p": "preventMovement",
                "pt": "msg",
                "to": "node-red.0.states.preventAutomaticShutterMovement.${shutter.name}.active",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 80,
        "wires": [
            [
                "1b60fad11fe5b582"
            ]
        ]
    },
    {
        "id": "1b60fad11fe5b582",
        "type": "change",
        "z": "c6d3de9075efb38f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "desiredPositionName",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 240,
        "wires": [
            [
                "1b5fbf6fa780c709"
            ]
        ]
    },
    {
        "id": "1b5fbf6fa780c709",
        "type": "ioBroker get",
        "z": "c6d3de9075efb38f",
        "name": "get lastDesiredPosition",
        "topic": "",
        "attrname": "lastDesiredPosition",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 600,
        "y": 240,
        "wires": [
            [
                "b662f6580a9ee6a3"
            ]
        ]
    },
    {
        "id": "00e39422ca49da5e",
        "type": "ioBroker get",
        "z": "c6d3de9075efb38f",
        "name": "get currentPosition",
        "topic": "",
        "attrname": "currentPosition",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 590,
        "y": 300,
        "wires": [
            [
                "cbec7a93e02f6a8c"
            ]
        ]
    },
    {
        "id": "b662f6580a9ee6a3",
        "type": "change",
        "z": "c6d3de9075efb38f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "currentPositionName",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 300,
        "wires": [
            [
                "00e39422ca49da5e"
            ]
        ]
    },
    {
        "id": "b639388a0ee670a2",
        "type": "ioBroker get",
        "z": "c6d3de9075efb38f",
        "name": "get preventMovement",
        "topic": "",
        "attrname": "preventMovement",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 600,
        "y": 360,
        "wires": [
            [
                "962a8cf0fab5e00d"
            ]
        ]
    },
    {
        "id": "cbec7a93e02f6a8c",
        "type": "change",
        "z": "c6d3de9075efb38f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "preventMovement",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 360,
        "wires": [
            [
                "b639388a0ee670a2"
            ]
        ]
    },
    {
        "id": "962a8cf0fab5e00d",
        "type": "function",
        "z": "c6d3de9075efb38f",
        "name": "transform to boolean",
        "func": "msg.preventMovement = (msg.preventMovement === \"true\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "3e3d3992a11cbd69",
        "type": "change",
        "z": "76dd2645ea70b9ac",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "shellies/shutter-${shutter.name}/roller/0/command/pos",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "dc581ad77af97b71",
        "type": "ioBroker get",
        "z": "7adf4d18a6dba978",
        "name": "get brightness",
        "topic": "0_userdata.0.shutters.thresholds.brightness",
        "attrname": "brightness",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 260,
        "y": 60,
        "wires": [
            [
                "c846bbb3ac05e2a2"
            ]
        ]
    },
    {
        "id": "da3c228a7addb077",
        "type": "ioBroker get",
        "z": "7adf4d18a6dba978",
        "name": "get currentTemperature",
        "topic": "deconz.0.Sensors.5.temperature",
        "attrname": "currentTemperature",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 290,
        "y": 240,
        "wires": [
            [
                "9821e759fc3fcbb7"
            ]
        ]
    },
    {
        "id": "9821e759fc3fcbb7",
        "type": "ioBroker get",
        "z": "7adf4d18a6dba978",
        "name": "get currentBrightness",
        "topic": "alias.0.sensors.brightness.livingroom.0",
        "attrname": "currentBrightness",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 280,
        "y": 280,
        "wires": [
            [
                "98f07d0221c344b5"
            ]
        ]
    },
    {
        "id": "c846bbb3ac05e2a2",
        "type": "ioBroker get",
        "z": "7adf4d18a6dba978",
        "name": "get brightnessMax",
        "topic": "0_userdata.0.shutters.thresholds.brightnessMax",
        "attrname": "brightnessMax",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 270,
        "y": 100,
        "wires": [
            [
                "033a3f888e214375"
            ]
        ]
    },
    {
        "id": "033a3f888e214375",
        "type": "ioBroker get",
        "z": "7adf4d18a6dba978",
        "name": "get temp",
        "topic": "0_userdata.0.shutters.thresholds.temp",
        "attrname": "temp",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 240,
        "y": 140,
        "wires": [
            [
                "6adf38c89ac61f66"
            ]
        ]
    },
    {
        "id": "6adf38c89ac61f66",
        "type": "ioBroker get",
        "z": "7adf4d18a6dba978",
        "name": "get tempMax",
        "topic": "0_userdata.0.shutters.thresholds.tempMax",
        "attrname": "tempMax",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 250,
        "y": 180,
        "wires": [
            [
                "da3c228a7addb077"
            ]
        ]
    },
    {
        "id": "98f07d0221c344b5",
        "type": "function",
        "z": "7adf4d18a6dba978",
        "name": "",
        "func": "if (Number(msg.currentBrightness) > Number(msg.brightnessMax)) {\n    msg.autoCloseReason = 'brightnessMax = ' + msg.currentBrightness;\n    msg.payload = 'half-open';\n    return [msg, null];\n} else if (Number(msg.currentTemperature) > Number(msg.tempMax)) {\n    msg.autoCloseReason = 'tempMax = ' + msg.currentTemperature;\n    msg.payload = 'half-open';\n    return [msg, null];\n} else if (Number(msg.currentTemperature) > Number(msg.temp)\n        && Number(msg.currentBrightness) > Number(msg.brightness)) {\n    msg.autoCloseReason = 'temp = ' + msg.currentTemperature\n        + ' and currentBrightness = ' + msg.currentBrightness;\n    msg.payload = 'half-open';\n    return [msg, null];\n}\nreturn [null, msg];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 280,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "fe9df3f33d9425cc",
        "type": "template",
        "z": "a50e9ae33aac98c4",
        "d": true,
        "name": "",
        "field": "telegramMessage",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Weather warning topic={{topic}}:\n\nheadline={{headline}}, \n\nlevel={{level}}, \n\nseverity={{severity}}, \n\ntype={{type}}, \n\ntext={{text}}, \n\ndescription={{description}}, \n\ninstruction={{instruction}}, \n\nbegin={{begin}}, \n\nend={{end}}, \n\nmap={{map}}.",
        "output": "str",
        "x": 320,
        "y": 120,
        "wires": [
            [
                "72a0801e37ddedd9",
                "741040e22242290e"
            ]
        ]
    },
    {
        "id": "741040e22242290e",
        "type": "debug",
        "z": "a50e9ae33aac98c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 470,
        "y": 160,
        "wires": []
    },
    {
        "id": "072c4146787ac96d",
        "type": "telegram sender",
        "z": "a50e9ae33aac98c4",
        "name": "Send warning",
        "bot": "abb06234.e8fcf",
        "haserroroutput": true,
        "outputs": 2,
        "x": 760,
        "y": 120,
        "wires": [
            [
                "1928f8ce0a77dff7"
            ],
            [
                "7bb5eafde10554b3"
            ]
        ]
    },
    {
        "id": "72a0801e37ddedd9",
        "type": "function",
        "z": "a50e9ae33aac98c4",
        "name": "Format text message",
        "func": "msg.payload = {};\n\nvar opts = {}\nif (msg.topic !== undefined && msg.topic.includes('warning'))\n{\n    opts.reply_markup = JSON.stringify({\n        \"inline_keyboard\": [\n            [\n                {\n                    \"text\": \"Schließen\",\n                    \"callback_data\": \"close\"            \n                }, \n                {\n                    \"text\": \"Halb schließen\",\n                    \"callback_data\": \"half-close\"            \n                },\n                {\n                    \"text\": \"Ignorieren\",\n                    \"callback_data\": \"ignore\"\n                }\n            ]\n        ]});\n} else {\n    opts.reply_markup = JSON.stringify({\n        \"inline_keyboard\": [\n            [\n                {\n                    \"text\": \"Schließen\",\n                    \"callback_data\": \"close\"            \n                }, \n                {\n                    \"text\": \"Halb schließen\",\n                    \"callback_data\": \"half-close\"            \n                },\n                {\n                    \"text\": \"Öffnen\",\n                    \"callback_data\": \"open\"\n                }\n            ]\n        ]});\n    \n}\n\n\nmsg.payload.content = msg.telegramMessage;\nmsg.payload.options = opts;\nmsg.payload.chatId = 1216101020;\nmsg.payload.type = \"message\";\n\nreturn [ msg ];\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 120,
        "wires": [
            [
                "072c4146787ac96d"
            ]
        ]
    },
    {
        "id": "1928f8ce0a77dff7",
        "type": "function",
        "z": "a50e9ae33aac98c4",
        "name": "save last messageId / clear old choice",
        "func": "// We create a container if there isn't one already.\nif (context.global.weatherwarning === undefined) {\n    context.global.weatherwarning = {};\n} \n\n// If we don't have an old messageId saved, it's easy.\nif (context.global.weatherwarning.messageId === undefined) {\n    // we just save the current id\n    context.global.weatherwarning.messageId = msg.payload.sentMessageId;\n    // and return null, as we don't have to proceed.\n    return null;\n}\n\nlet newPayload = {\n    type: 'editMessageReplyMarkup',\n    options: {\n        chat_id : msg.payload.chatId,\n        reply_markup : {},\n        message_id : context.global.weatherwarning.messageId\n    },\n    content: {}\n}\n\n// We store the messageId to be able to edit this reply in the callback query. \ncontext.global.weatherwarning.messageId = msg.payload.sentMessageId;\nmsg.payload = newPayload;\ndelete msg.originalMessage;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 120,
        "wires": [
            [
                "c9ca8aacf8819962"
            ]
        ]
    },
    {
        "id": "dcf3019c6cd7ce4b",
        "type": "telegram event",
        "z": "a50e9ae33aac98c4",
        "name": "",
        "bot": "abb06234.e8fcf",
        "event": "callback_query",
        "autoanswer": true,
        "x": 200,
        "y": 300,
        "wires": [
            [
                "24bcb283ae7935a9"
            ]
        ]
    },
    {
        "id": "24bcb283ae7935a9",
        "type": "function",
        "z": "a50e9ae33aac98c4",
        "name": "ignore",
        "func": "msg.choice = msg.payload.content;\n\nmsg.payload.type = 'editMessageReplyMarkup';\nmsg.payload.content = {};\nmsg.payload.options = {\n    chat_id : msg.payload.chatId,\n    reply_markup : {},\n    message_id : msg.payload.messageId\n};\n\ndelete msg.payload.callbackQueryId;\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 650,
        "y": 300,
        "wires": [
            [
                "8d6bce4a312eb3ca"
            ]
        ]
    },
    {
        "id": "8d6bce4a312eb3ca",
        "type": "telegram sender",
        "z": "a50e9ae33aac98c4",
        "name": "",
        "bot": "abb06234.e8fcf",
        "haserroroutput": true,
        "outputs": 2,
        "x": 910,
        "y": 300,
        "wires": [
            [
                "ceb504474e8b6ae6"
            ],
            [
                "7bb5eafde10554b3"
            ]
        ]
    },
    {
        "id": "c9ca8aacf8819962",
        "type": "telegram sender",
        "z": "a50e9ae33aac98c4",
        "name": "Clear old answer options",
        "bot": "abb06234.e8fcf",
        "haserroroutput": true,
        "outputs": 2,
        "x": 1390,
        "y": 120,
        "wires": [
            [],
            [
                "7bb5eafde10554b3"
            ]
        ]
    },
    {
        "id": "ceb504474e8b6ae6",
        "type": "function",
        "z": "a50e9ae33aac98c4",
        "name": "set choice as payload",
        "func": "// Question has been answered. Clear the context.\ndelete context.global.weatherwarning.messageId;\n\nif (msg.choice === undefined || msg.choice === 'ignore') {\n    // nothing\n    return null;\n}\nmsg.payload = msg.choice;\ndelete msg.choice;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 300,
        "wires": [
            [
                "5944b007c5b52d57"
            ]
        ]
    },
    {
        "id": "5944b007c5b52d57",
        "type": "debug",
        "z": "a50e9ae33aac98c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1390,
        "y": 380,
        "wires": []
    },
    {
        "id": "3851d303055588c3",
        "type": "telegram command",
        "z": "a50e9ae33aac98c4",
        "name": "/shutter",
        "command": "/shutter",
        "description": "Run a test",
        "registercommand": true,
        "language": "",
        "scope": "default",
        "bot": "abb06234.e8fcf",
        "strict": false,
        "hasresponse": false,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 1,
        "x": 170,
        "y": 440,
        "wires": [
            [
                "345bbe669ce966c3"
            ]
        ]
    },
    {
        "id": "5e1200fdf87fd802",
        "type": "template",
        "z": "a50e9ae33aac98c4",
        "name": "",
        "field": "telegramMessage",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Ja bitte?",
        "output": "str",
        "x": 420,
        "y": 380,
        "wires": [
            [
                "72a0801e37ddedd9"
            ]
        ]
    },
    {
        "id": "7bb5eafde10554b3",
        "type": "debug",
        "z": "a50e9ae33aac98c4",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1550,
        "y": 220,
        "wires": []
    },
    {
        "id": "345bbe669ce966c3",
        "type": "function",
        "z": "a50e9ae33aac98c4",
        "name": "action defined?",
        "func": "if (msg.payload.content === undefined)\n{\n    return [msg, null];\n}\nlet content = msg.payload.content.trim();\n// Shortcut. action already defined in command, so we don't need to ask.\nif (content === \"open\" || content === \"close\" || content === \"half-close\")\n{\n    msg.payload = content;\n    return [null, msg];\n}\nreturn [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 360,
        "y": 440,
        "wires": [
            [
                "5e1200fdf87fd802"
            ],
            []
        ]
    },
    {
        "id": "af327074f1bc870d",
        "type": "function",
        "z": "a50e9ae33aac98c4",
        "name": "format message",
        "func": "msg.telegramMessage = msg.headline\n    + \"\\n\\nlevel: \" + msg.level + \" severity: \" + msg.severity\n    + \"\\n\\n\" + msg.description\n    + \"\\n\\nVon \" + msg.begin + \" bis \" + msg.end\n    + \"\\n\\nSollen die Rollläden geschlossen werden?\"\nmsg.url = msg.map;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 160,
        "wires": [
            [
                "aedd0ed0eba2d424"
            ]
        ]
    },
    {
        "id": "aedd0ed0eba2d424",
        "type": "http request",
        "z": "a50e9ae33aac98c4",
        "name": "download map",
        "method": "GET",
        "ret": "bin",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 300,
        "y": 220,
        "wires": [
            [
                "741040e22242290e",
                "293efda7e0aa0ca8"
            ]
        ]
    },
    {
        "id": "293efda7e0aa0ca8",
        "type": "function",
        "z": "a50e9ae33aac98c4",
        "name": "Format map message",
        "func": "let mapChunk = msg.payload;\nmsg.payload = {};\n\nmsg.payload.content = mapChunk;\nmsg.payload.chatId = 1216101020;\nmsg.payload.type = \"photo\";\n\nreturn [ msg ];\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 520,
        "y": 60,
        "wires": [
            [
                "d52c992d90f5f35c"
            ]
        ]
    },
    {
        "id": "d52c992d90f5f35c",
        "type": "telegram sender",
        "z": "a50e9ae33aac98c4",
        "name": "Send map",
        "bot": "abb06234.e8fcf",
        "haserroroutput": true,
        "outputs": 2,
        "x": 750,
        "y": 60,
        "wires": [
            [
                "72a0801e37ddedd9"
            ],
            []
        ]
    },
    {
        "id": "5f682f2c80c0f9c8",
        "type": "split",
        "z": "7efede71724c22bc",
        "name": "",
        "splt": ",",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "attributeName",
        "x": 330,
        "y": 80,
        "wires": [
            [
                "5ba4e326ca083c48"
            ]
        ]
    },
    {
        "id": "2082d639cde13352",
        "type": "function",
        "z": "7efede71724c22bc",
        "name": "prepare message",
        "func": "msg.originalTopic = msg.topic;\nmsg.originalPayload = msg.payload;\nmsg.payload = env.get(\"attribute-names\");\nlet topic = env.get(\"topic\");\nif (topic !== undefined && topic !== \"\") {\n    msg.topic = topic;   \n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 170,
        "y": 80,
        "wires": [
            [
                "5f682f2c80c0f9c8"
            ]
        ]
    },
    {
        "id": "5ba4e326ca083c48",
        "type": "function",
        "z": "7efede71724c22bc",
        "name": "set topic",
        "func": "msg.topic = msg.topic + \".\" + msg.payload;\nmsg.attributeName = msg.payload;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 80,
        "wires": [
            [
                "87d052dc878825c6"
            ]
        ]
    },
    {
        "id": "87d052dc878825c6",
        "type": "ioBroker get",
        "z": "7efede71724c22bc",
        "name": "get value",
        "topic": "",
        "attrname": "payload",
        "payloadType": "value",
        "errOnInvalidState": "nothing",
        "x": 600,
        "y": 80,
        "wires": [
            [
                "dc7d43adbbb4f12a"
            ]
        ]
    },
    {
        "id": "b1837ddc933f9628",
        "type": "join",
        "z": "7efede71724c22bc",
        "name": "",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": true,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 890,
        "y": 80,
        "wires": [
            [
                "109b42c3efde0f57"
            ]
        ]
    },
    {
        "id": "dc7d43adbbb4f12a",
        "type": "function",
        "z": "7efede71724c22bc",
        "name": "map attribute",
        "func": "msg[msg.attributeName] = msg.payload;\ndelete msg.attributeName;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 750,
        "y": 80,
        "wires": [
            [
                "b1837ddc933f9628"
            ]
        ]
    },
    {
        "id": "109b42c3efde0f57",
        "type": "function",
        "z": "7efede71724c22bc",
        "name": "reset topic and payload",
        "func": "msg.payload = msg.originalPayload;\nmsg.topic = msg.originalTopic;\ndelete msg.originalPayload\ndelete msg.originalTopic;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "d44980ba9fbc8af9",
        "type": "function",
        "z": "c144853baeb5f845",
        "name": "function 2",
        "func": "// initialise the counter to 0 if it doesn't exist already\nvar count = global.get('count') || 0;\n\nif(msg.payload.buttonevent == 1002)\n{\n    count += 1;\n    // store the value back\n    global.set('count', count);\n    msg.payload.count = count;\n}\n\nif(msg.payload === \"resetTimer\")\n{\n    msg.payload = {}\n    msg.payload.count = count;\n    global.set('count', 0);    \n\n    // single click\n    if(count == 1)\n    {\n        return [msg, null]\n    }\n    // double click\n    else\n    {\n        return [null, msg]\n    }    \n}\n\nreturn [null, null];\n",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 380,
        "y": 140,
        "wires": [
            [],
            []
        ],
        "outputLabels": [
            "single",
            "double"
        ]
    },
    {
        "id": "ba18a69ab61eeeac",
        "type": "trigger",
        "z": "c144853baeb5f845",
        "name": "",
        "op1": "",
        "op2": "resetTimer",
        "op1type": "nul",
        "op2type": "str",
        "duration": "2",
        "extend": false,
        "overrideDelay": false,
        "units": "s",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 220,
        "y": 180,
        "wires": [
            [
                "d44980ba9fbc8af9"
            ]
        ]
    },
    {
        "id": "323a6b4cc22c0bd8",
        "type": "trigger",
        "z": "a0bf89c9c0c89918",
        "name": "",
        "op1": "1",
        "op2": "1",
        "op1type": "str",
        "op2type": "num",
        "duration": "-250",
        "extend": false,
        "overrideDelay": true,
        "units": "ms",
        "reset": "",
        "bytopic": "all",
        "topic": "topic",
        "outputs": 1,
        "x": 880,
        "y": 100,
        "wires": [
            [
                "d3e777f121037316"
            ]
        ]
    },
    {
        "id": "60b7ca06a4c86390",
        "type": "delay",
        "z": "a0bf89c9c0c89918",
        "name": "delay dimmer",
        "pauseType": "delayv",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 460,
        "y": 280,
        "wires": [
            [
                "06509ebf33d1b59c",
                "e07e1c45d34c27f2"
            ]
        ]
    },
    {
        "id": "6cbaa1684536d370",
        "type": "function",
        "z": "a0bf89c9c0c89918",
        "name": "setup trigger",
        "func": "let flowId = env.get(\"ID\");\nlet startValue = parseInt(env.get(\"START_VALUE\"));\nlet endValue = parseInt(env.get(\"END_VALUE\"));\nlet durationChange = msg.timer.durationChange;\nif (durationChange === undefined) {\n    durationChange = parseInt(env.get(\"DURATION_CHANGE\"));\n}\nlet duration = durationChange * 60 * 1000;\n\nlet tick = duration / Math.abs(endValue - startValue);\n\ncontext.global[flowId] = { value: startValue };\n\nmsg.delay = tick;\nmsg.topic = \"states.timer.\" + flowId.toLowerCase() + \".active\";\nmsg.payload = true;\nmsg.stateName = flowId;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 100,
        "wires": [
            [
                "323a6b4cc22c0bd8",
                "24857958a5ce1580",
                "50469674b29e3281"
            ]
        ]
    },
    {
        "id": "d2159cdd6a11c2c0",
        "type": "function",
        "z": "a0bf89c9c0c89918",
        "name": "reset after durationChange",
        "func": "let durationChange = parseInt(env.get(\"DURATION_CHANGE\")) * 60 * 1000;\n\nmsg.delay = durationChange;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 240,
        "y": 280,
        "wires": [
            [
                "60b7ca06a4c86390"
            ]
        ]
    },
    {
        "id": "06509ebf33d1b59c",
        "type": "change",
        "z": "a0bf89c9c0c89918",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 140,
        "wires": [
            [
                "323a6b4cc22c0bd8"
            ]
        ]
    },
    {
        "id": "4dfe55a9fce5fe4b",
        "type": "delay",
        "z": "a0bf89c9c0c89918",
        "name": "delay hold",
        "pauseType": "delayv",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 930,
        "y": 280,
        "wires": [
            [
                "14b46e87adb10456",
                "e8e0fc8f373a4675"
            ]
        ]
    },
    {
        "id": "d3e777f121037316",
        "type": "function",
        "z": "a0bf89c9c0c89918",
        "name": "set dimmer value",
        "func": "let flowId = env.get(\"ID\");\nlet ctx = context.global[flowId];\n\nlet startValue = parseInt(env.get(\"START_VALUE\"));\nlet endValue = parseInt(env.get(\"END_VALUE\"));\n\nif (startValue < endValue) {\n    ctx.value += 1;\n} else {\n    ctx.value -= 1;\n}\n\nmsg.value = ctx.value;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1110,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "080e65a6b93f9aed",
        "type": "function",
        "z": "a0bf89c9c0c89918",
        "name": "reset",
        "func": "if (msg.reset) {\n    delete msg[\"reset\"];\n    msg.delay = 1000;\n    return [null, msg];\n}\nreturn [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 170,
        "y": 100,
        "wires": [
            [
                "6cbaa1684536d370",
                "d2159cdd6a11c2c0"
            ],
            [
                "06509ebf33d1b59c",
                "4dfe55a9fce5fe4b"
            ]
        ]
    },
    {
        "id": "14b46e87adb10456",
        "type": "function",
        "z": "a0bf89c9c0c89918",
        "name": "reset delay",
        "func": "if(msg.delay == 1000) {\n    msg.regularTimeout = false;\n} else {\n    msg.regularTimeout = true;\n}\n\ndelete msg[\"delay\"];\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1130,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "e07e1c45d34c27f2",
        "type": "function",
        "z": "a0bf89c9c0c89918",
        "name": "set duration hold",
        "func": "let durationHold = msg.timer.durationHold;\nif (durationHold === undefined) {\n    durationHold = parseInt(env.get(\"DURATION_HOLD\"));\n}\nlet duration = durationHold * 60 * 1000;\n\nmsg.delay = duration;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 670,
        "y": 280,
        "wires": [
            [
                "4dfe55a9fce5fe4b"
            ]
        ]
    },
    {
        "id": "24857958a5ce1580",
        "type": "ioBroker out",
        "z": "a0bf89c9c0c89918",
        "name": "",
        "topic": "",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "",
        "role": "",
        "payloadType": "boolean",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 620,
        "y": 60,
        "wires": []
    },
    {
        "id": "50469674b29e3281",
        "type": "debug",
        "z": "a0bf89c9c0c89918",
        "name": "Write timer state",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 20,
        "wires": []
    },
    {
        "id": "e8e0fc8f373a4675",
        "type": "function",
        "z": "a0bf89c9c0c89918",
        "name": "reset timer state",
        "func": "let flowId = env.get(\"ID\");\nmsg.topic = \"states.timer.\" + flowId.toLowerCase() + \".active\";\nmsg.payload = false;\nmsg.stateName = flowId;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 320,
        "wires": [
            [
                "b0c1452bf6146313"
            ]
        ]
    },
    {
        "id": "b0c1452bf6146313",
        "type": "ioBroker out",
        "z": "a0bf89c9c0c89918",
        "name": "",
        "topic": "",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "",
        "role": "",
        "payloadType": "boolean",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1140,
        "y": 360,
        "wires": []
    },
    {
        "id": "f2066a039a46dfa1",
        "type": "subflow:c6d3de9075efb38f",
        "z": "9c37ac267425c096",
        "name": "",
        "env": [
            {
                "name": "shutter.name",
                "value": "${shutter-name}",
                "type": "env"
            }
        ],
        "x": 290,
        "y": 60,
        "wires": [
            [
                "7d617c3e5cf23aca"
            ]
        ]
    },
    {
        "id": "7d617c3e5cf23aca",
        "type": "function",
        "z": "9c37ac267425c096",
        "name": "proceed if desired != current",
        "func": "let currentPosition = parseInt(msg.currentPosition);\nlet desiredPosition = parseInt(msg.lastDesiredPosition);\n\nif (currentPosition == desiredPosition) {\n    return null;\n}\n\nmsg.payload = desiredPosition;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 60,
        "wires": [
            [
                "145cb51adbe06f65"
            ]
        ]
    },
    {
        "id": "145cb51adbe06f65",
        "type": "subflow:76dd2645ea70b9ac",
        "z": "9c37ac267425c096",
        "name": "",
        "env": [
            {
                "name": "shutter-name",
                "value": "${shutter-name}",
                "type": "env"
            }
        ],
        "x": 840,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "e41ffe2ba458ac80",
        "type": "ioBroker get",
        "z": "1b53c3a9bc37dc0e",
        "name": "terrasseLightReachable",
        "topic": "deconz.0.Lights.12.reachable",
        "attrname": "terrasseLightReachable",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 310,
        "y": 120,
        "wires": [
            [
                "2bc543c4d2e41610"
            ]
        ]
    },
    {
        "id": "c096ff80badeb452",
        "type": "inject",
        "z": "1b53c3a9bc37dc0e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 200,
        "wires": [
            [
                "e41ffe2ba458ac80"
            ]
        ]
    },
    {
        "id": "2bc543c4d2e41610",
        "type": "switch",
        "z": "1b53c3a9bc37dc0e",
        "name": "",
        "property": "terrasseLightReachable",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 120,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "4964491c2915304a",
        "type": "function",
        "z": "395982643a88a924",
        "name": "Prepare http request",
        "func": "let latitude = env.get('latitude'); \nlet longitude = env.get('longitude'); \n\n//https://sunrise-sunset.org/api\nmsg.url = `https://api.sunrise-sunset.org/json?&formatted=0&lat=${latitude}&lng=${longitude}`;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 280,
        "y": 100,
        "wires": [
            [
                "1a20ad020bb27fba"
            ]
        ]
    },
    {
        "id": "1a20ad020bb27fba",
        "type": "http request",
        "z": "395982643a88a924",
        "name": "",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 490,
        "y": 100,
        "wires": [
            [
                "71638ab9082b6109"
            ]
        ]
    },
    {
        "id": "71638ab9082b6109",
        "type": "function",
        "z": "395982643a88a924",
        "name": "Parse solarevents",
        "func": "let date = new Date();\nlet timeZoneOffset = date.getTimezoneOffset() * 60;\n\nfunction recalculateTime(x) {\n    //var z = new Date(x).valueOf();\n    //var adjustedTime = (z / 1000 + (-1 * timeZoneOffset)) * 1000;\n    return new Date(x);\n}\n\nfunction secondsToHms(d) {\n    d = Number(d);\n    var h = Math.floor(d / 3600);\n    var m = Math.floor(d % 3600 / 60);\n    return ('0' + h).slice(-2) + \"h \" + ('0' + m).slice(-2) + \"min\";\n}\n\nfunction stringtodate(timenow) {\n    let date1 = Date.parse(timenow);\n    return date1;\n}\n\nnode.log(msg.payload.results);\n\nlet solarEvents = JSON.parse(msg.payload).results;\n\n//msg.solarEventsRaw = solarEvents;\nmsg.solarEvents = {};\n//msg.solarEvents.sunriseRaw = solarEvents.sunrise;\n\n//return msg;\n\n//sunrise\nvar sunrise = recalculateTime(solarEvents['sunrise']);\nglobal.set('Time_sunrise', stringtodate(sunrise));\nmsg.solarEvents.sunrise = stringtodate(sunrise);\n\nreturn msg;\n\n//sunset\nvar sunset = recalculateTime(msg.payload.results.sunset);\nglobal.set('Time_sunset', stringtodate(sunset));\nmsg.sunset = stringtodate(sunset);\n\n//solar_noon\nvar solar_noon = recalculateTime(msg.payload.results.solar_noon);\nglobal.set('Time_solar_noon', solar_noon);\n//day_length\\nvar day_length =  secondsToHms(msg.payload.results.day_length);\\nglobal.set('Time_day_length', day_length);\\n\\n//civil_twilight_begin\\nvar civil_twilight_begin = recalculateTime(msg.payload.results.civil_twilight_begin);\\nglobal.set('Time_civil_twilight_begin', civil_twilight_begin);\\n\\n//civil_twilight_end\\nvar civil_twilight_end = recalculateTime(msg.payload.results.civil_twilight_end);\\nglobal.set('Time_civil_twilight_end', civil_twilight_end);\\n\\n//nautical_twilight_begin\\nvar nautical_twilight_begin = recalculateTime(msg.payload.results.nautical_twilight_begin);\\nglobal.set('Time_nautical_twilight_begin', nautical_twilight_begin);\\n\\n//nautical_twilight_end\\nvar nautical_twilight_end = recalculateTime(msg.payload.results.nautical_twilight_end);\\nglobal.set('Time_nautical_twilight_end', nautical_twilight_end);\\n\\n//astronomical_twilight_begin\\nvar astronomical_twilight_begin = recalculateTime(msg.payload.results.astronomical_twilight_begin);\\nglobal.set('Time_astronomical_twilight_begin', astronomical_twilight_begin);\\n\\n//astronomical_twilight_end\\nvar astronomical_twilight_end = recalculateTime(msg.payload.results.astronomical_twilight_end);\\nglobal.set('Time_astronomical_twilight_end', astronomical_twilight_end);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "9d1fde7b.8ef91",
        "type": "cronplus",
        "z": "a09414b5.859f68",
        "name": "dusk",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "str",
                "payload": "half-open",
                "expressionType": "solar",
                "expression": "0 * * * * * *",
                "location": "48.18609507662278, 11.596313697132464",
                "offset": "0",
                "solarType": "selected",
                "solarEvents": "nauticalDusk"
            }
        ],
        "x": 90,
        "y": 200,
        "wires": [
            [
                "6cca6577993b24e2"
            ]
        ]
    },
    {
        "id": "4f496314.0e4cac",
        "type": "cronplus",
        "z": "a09414b5.859f68",
        "name": "night",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "str",
                "payload": "half-open",
                "expressionType": "cron",
                "expression": "0 0 0 * * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 90,
        "y": 280,
        "wires": [
            [
                "2dd0e0aa376a95bd"
            ]
        ]
    },
    {
        "id": "fdaafb23.e94b38",
        "type": "cronplus",
        "z": "a09414b5.859f68",
        "name": "morning",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "str",
                "payload": "open",
                "expressionType": "cron",
                "expression": "0 0 7 * * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            },
            {
                "name": "schedule2",
                "topic": "schedule2",
                "payloadType": "str",
                "payload": "open",
                "expressionType": "solar",
                "expression": "0 * * * * * *",
                "location": "48.18609507662278, 11.596313697132464",
                "offset": "0",
                "solarType": "selected",
                "solarEvents": "civilDawn"
            }
        ],
        "x": 100,
        "y": 360,
        "wires": [
            [
                "09b5db00d42869cb"
            ]
        ]
    },
    {
        "id": "2c2bfa88.84e586",
        "type": "mqtt out",
        "z": "a09414b5.859f68",
        "name": "",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f1f93d18.375ea",
        "x": 1350,
        "y": 320,
        "wires": []
    },
    {
        "id": "7a76eea5.f3ae4",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "a09414b5.859f68",
        "name": "Move shutter terrasse",
        "env": [
            {
                "name": "shutter.name",
                "value": "terrasse",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 1060,
        "y": 280,
        "wires": [
            [
                "2c2bfa88.84e586"
            ]
        ]
    },
    {
        "id": "1dfd5f73.3e12d1",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "a09414b5.859f68",
        "name": "Move shutter office",
        "env": [
            {
                "name": "shutter.name",
                "value": "office",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 1050,
        "y": 200,
        "wires": [
            [
                "2c2bfa88.84e586"
            ]
        ]
    },
    {
        "id": "86fb19ad.e3f8e8",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "a09414b5.859f68",
        "name": "Move shutter garden",
        "env": [
            {
                "name": "shutter.name",
                "value": "garden",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "0",
                "type": "num"
            }
        ],
        "x": 1060,
        "y": 320,
        "wires": [
            [
                "2c2bfa88.84e586"
            ]
        ]
    },
    {
        "id": "ab3f6cd6.73bc6",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "a09414b5.859f68",
        "name": "Move shutter kitchen",
        "env": [
            {
                "name": "shutter.name",
                "value": "kitchen",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 1060,
        "y": 360,
        "wires": [
            [
                "2c2bfa88.84e586"
            ]
        ]
    },
    {
        "id": "aa3a2094.85a32",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "a09414b5.859f68",
        "name": "Move shutter bedroom",
        "env": [
            {
                "name": "shutter.name",
                "value": "bedroom",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 1060,
        "y": 440,
        "wires": [
            [
                "2c2bfa88.84e586"
            ]
        ]
    },
    {
        "id": "9fa29979.dc57f8",
        "type": "cronplus",
        "z": "a09414b5.859f68",
        "d": true,
        "name": "wake up",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "str",
                "payload": "half-open",
                "expressionType": "cron",
                "expression": "0 20 7 * * 1-5 *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            },
            {
                "name": "schedule2",
                "topic": "schedule2",
                "payloadType": "str",
                "payload": "half-open",
                "expressionType": "cron",
                "expression": "0 0 10 * * 6,7 *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 100,
        "y": 500,
        "wires": [
            [
                "74cae011301b0166"
            ]
        ]
    },
    {
        "id": "f42a18dd.aa3888",
        "type": "cronplus",
        "z": "a09414b5.859f68",
        "d": true,
        "name": "noon",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "num",
                "payload": "55",
                "expressionType": "solar",
                "expression": "0 * * * * * *",
                "location": "48.18609507662278, 11.596313697132464",
                "offset": "30",
                "solarType": "selected",
                "solarEvents": "solarNoon"
            }
        ],
        "x": 90,
        "y": 60,
        "wires": [
            [
                "625ba715.303738"
            ]
        ]
    },
    {
        "id": "625ba715.303738",
        "type": "subflow:16c9c5c.ad34a3a",
        "z": "a09414b5.859f68",
        "name": "",
        "env": [],
        "x": 310,
        "y": 60,
        "wires": [
            [
                "1dfd5f73.3e12d1"
            ]
        ]
    },
    {
        "id": "e60e8166.16b04",
        "type": "subflow:ef57397d.2bd4c8",
        "z": "a09414b5.859f68",
        "name": "",
        "env": [],
        "x": 460,
        "y": 440,
        "wires": [
            [
                "aa3a2094.85a32"
            ]
        ]
    },
    {
        "id": "1edfaa8a.bdf525",
        "type": "cronplus",
        "z": "a09414b5.859f68",
        "name": "afternoon",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "str",
                "payload": "open",
                "expressionType": "solar",
                "expression": "0 * * * * * *",
                "location": "48.18609507662278, 11.596313697132464",
                "offset": "0",
                "solarType": "selected",
                "solarEvents": "eveningGoldenHourStart"
            }
        ],
        "x": 100,
        "y": 120,
        "wires": [
            [
                "1dfd5f73.3e12d1"
            ]
        ]
    },
    {
        "id": "9f6acbd2.26b048",
        "type": "cronplus",
        "z": "a09414b5.859f68",
        "name": "time to sleep",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "str",
                "payload": "closed",
                "expressionType": "solar",
                "expression": "0 * * * * * *",
                "location": "48.18609507662278, 11.596313697132464",
                "offset": "0",
                "solarType": "selected",
                "solarEvents": "nauticalDusk"
            },
            {
                "name": "schedule2",
                "topic": "schedule2",
                "payloadType": "str",
                "payload": "closed",
                "expressionType": "cron",
                "expression": "0 0 22 * * * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 110,
        "y": 440,
        "wires": [
            [
                "cc5744c6b3e6299e"
            ]
        ]
    },
    {
        "id": "8ed13ffd.8501d",
        "type": "cronplus",
        "z": "a09414b5.859f68",
        "d": true,
        "name": "daylight bedroom",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "str",
                "payload": "open",
                "expressionType": "cron",
                "expression": "0 0 9 * * 1-5 *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            },
            {
                "name": "schedule2",
                "topic": "schedule2",
                "payloadType": "str",
                "payload": "open",
                "expressionType": "cron",
                "expression": "0 0 11 * * 6,7 *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 130,
        "y": 540,
        "wires": [
            [
                "d45275b89c2aa6aa"
            ]
        ]
    },
    {
        "id": "03b6aff0521f41ad",
        "type": "subflow:72258bd0d3dfaa6d",
        "z": "a09414b5.859f68",
        "name": "",
        "x": 580,
        "y": 540,
        "wires": [
            [
                "aa3a2094.85a32"
            ]
        ]
    },
    {
        "id": "4b02f692581073a7",
        "type": "cronplus",
        "z": "a09414b5.859f68",
        "name": "noon - open eastern shutters",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "str",
                "payload": "open",
                "expressionType": "solar",
                "expression": "0 * * * * * *",
                "location": "48.18609507662278, 11.596313697132464",
                "offset": "-10",
                "solarType": "selected",
                "solarEvents": "solarNoon"
            }
        ],
        "x": 160,
        "y": 600,
        "wires": [
            [
                "250c024a7659b7c1"
            ]
        ]
    },
    {
        "id": "c273f5a9f9148f29",
        "type": "subflow:72258bd0d3dfaa6d",
        "z": "a09414b5.859f68",
        "name": "",
        "x": 580,
        "y": 360,
        "wires": [
            [
                "ab3f6cd6.73bc6",
                "86fb19ad.e3f8e8",
                "388212d6a9efab2f"
            ]
        ]
    },
    {
        "id": "74cae011301b0166",
        "type": "subflow:893d1cfdd62ef503",
        "z": "a09414b5.859f68",
        "name": "",
        "x": 390,
        "y": 500,
        "wires": [
            [
                "aa3a2094.85a32"
            ]
        ]
    },
    {
        "id": "cc5744c6b3e6299e",
        "type": "change",
        "z": "a09414b5.859f68",
        "name": "override",
        "rules": [
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 260,
        "y": 440,
        "wires": [
            [
                "e60e8166.16b04"
            ]
        ]
    },
    {
        "id": "6cca6577993b24e2",
        "type": "change",
        "z": "a09414b5.859f68",
        "name": "override",
        "rules": [
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 260,
        "y": 200,
        "wires": [
            [
                "1dfd5f73.3e12d1",
                "86fb19ad.e3f8e8",
                "f048fb8887f6b0c5"
            ]
        ]
    },
    {
        "id": "2dd0e0aa376a95bd",
        "type": "change",
        "z": "a09414b5.859f68",
        "name": "override",
        "rules": [
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 260,
        "y": 280,
        "wires": [
            [
                "ab3f6cd6.73bc6"
            ]
        ]
    },
    {
        "id": "09b5db00d42869cb",
        "type": "change",
        "z": "a09414b5.859f68",
        "name": "override",
        "rules": [
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 260,
        "y": 360,
        "wires": [
            [
                "c273f5a9f9148f29",
                "1dfd5f73.3e12d1",
                "7a76eea5.f3ae4"
            ]
        ]
    },
    {
        "id": "d45275b89c2aa6aa",
        "type": "change",
        "z": "a09414b5.859f68",
        "name": "override",
        "rules": [
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 540,
        "wires": [
            [
                "03b6aff0521f41ad"
            ]
        ]
    },
    {
        "id": "250c024a7659b7c1",
        "type": "change",
        "z": "a09414b5.859f68",
        "name": "override",
        "rules": [
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 600,
        "wires": [
            [
                "aa3a2094.85a32",
                "86fb19ad.e3f8e8",
                "ab3f6cd6.73bc6"
            ]
        ]
    },
    {
        "id": "d30a4d27dd10c5dc",
        "type": "cronplus",
        "z": "a09414b5.859f68",
        "name": "",
        "outputField": "payload",
        "timeZone": "",
        "persistDynamic": false,
        "commandResponseMsgOutput": "output1",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "weekday",
                "payloadType": "num",
                "payload": "40",
                "expressionType": "cron",
                "expression": "0 0/5 9-12 * * * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 100,
        "y": 720,
        "wires": [
            [
                "2e9c4e26e9057cc4"
            ]
        ]
    },
    {
        "id": "2e9c4e26e9057cc4",
        "type": "subflow:7adf4d18a6dba978",
        "z": "a09414b5.859f68",
        "name": "",
        "x": 550,
        "y": 720,
        "wires": [
            [
                "86fb19ad.e3f8e8",
                "ab3f6cd6.73bc6",
                "aa3a2094.85a32"
            ],
            []
        ]
    },
    {
        "id": "da72b18c60bff4bc",
        "type": "deconz-input",
        "z": "a09414b5.859f68",
        "name": "Button | Shutter Office",
        "topic": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "sensors/uniqueid/84:ba:20:ff:fe:d3:f5:d2-01-1000"
        ],
        "device_name": "",
        "query": "{}",
        "outputs": 1,
        "output_rules": [
            {
                "type": "state",
                "format": "single",
                "output": "onchange",
                "onstart": false,
                "payload": [
                    "__complete__"
                ]
            }
        ],
        "x": 140,
        "y": 960,
        "wires": [
            [
                "5de9faf25b233668"
            ]
        ]
    },
    {
        "id": "5de9faf25b233668",
        "type": "ioBroker get",
        "z": "a09414b5.859f68",
        "name": "Get Shutter office position",
        "topic": "mqtt-client.0.shellies.shutter-office.roller.0.pos",
        "attrname": "payload",
        "payloadType": "value",
        "errOnInvalidState": "nothing",
        "x": 390,
        "y": 960,
        "wires": [
            [
                "c088e5f7f5ff2530"
            ]
        ]
    },
    {
        "id": "9222eb560198c130",
        "type": "change",
        "z": "a09414b5.859f68",
        "name": "close",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "half-open",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 940,
        "wires": [
            [
                "aee1f7f2b8b5f13a"
            ]
        ]
    },
    {
        "id": "c088e5f7f5ff2530",
        "type": "switch",
        "z": "a09414b5.859f68",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "100",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 960,
        "wires": [
            [
                "9222eb560198c130"
            ],
            [
                "797c7e4a54183cc3"
            ]
        ]
    },
    {
        "id": "797c7e4a54183cc3",
        "type": "change",
        "z": "a09414b5.859f68",
        "name": "open",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "open",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 980,
        "wires": [
            [
                "aee1f7f2b8b5f13a"
            ]
        ]
    },
    {
        "id": "aee1f7f2b8b5f13a",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "a09414b5.859f68",
        "name": "Move shutter office",
        "env": [
            {
                "name": "shutter.name",
                "value": "office",
                "type": "str"
            }
        ],
        "x": 990,
        "y": 960,
        "wires": [
            [
                "2c2bfa88.84e586"
            ]
        ]
    },
    {
        "id": "533463ce90de4980",
        "type": "switch",
        "z": "a09414b5.859f68",
        "name": "NotThere",
        "property": "presence",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "true",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 860,
        "y": 400,
        "wires": [
            [
                "aa3a2094.85a32"
            ]
        ]
    },
    {
        "id": "f048fb8887f6b0c5",
        "type": "subflow:1b53c3a9bc37dc0e",
        "z": "a09414b5.859f68",
        "name": "",
        "x": 760,
        "y": 240,
        "wires": [
            [
                "7a76eea5.f3ae4"
            ],
            [
                "1bfa5aba868e807f"
            ]
        ]
    },
    {
        "id": "1bfa5aba868e807f",
        "type": "debug",
        "z": "a09414b5.859f68",
        "name": "Terrasse light reachable.",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Prevent closing the terrasse shutter, as terrasse light is reachable.\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1080,
        "y": 100,
        "wires": []
    },
    {
        "id": "388212d6a9efab2f",
        "type": "ioBroker get",
        "z": "a09414b5.859f68",
        "name": "presence",
        "topic": "node-red.0.presence.presence",
        "attrname": "presence",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 720,
        "y": 400,
        "wires": [
            [
                "533463ce90de4980"
            ]
        ]
    },
    {
        "id": "d73b023e.7ba9f",
        "type": "ioBroker in",
        "z": "615f1b13.386e84",
        "name": "stop_reason",
        "topic": "mqtt-client.0.shellies.shutter-office.roller.0.stop_reason",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "true",
        "x": 170,
        "y": 80,
        "wires": [
            [
                "49063584.83689c"
            ]
        ]
    },
    {
        "id": "aa8ef2f5.a13dc",
        "type": "ioBroker out",
        "z": "615f1b13.386e84",
        "name": "stop_reason_numeric",
        "topic": "",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "stop_reason_numeric",
        "role": "",
        "payloadType": "",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "0",
        "stateMax": "3",
        "x": 920,
        "y": 140,
        "wires": []
    },
    {
        "id": "c2e76407.b71ec8",
        "type": "change",
        "z": "615f1b13.386e84",
        "name": "Translate stop reason",
        "rules": [
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "normal",
                "fromt": "str",
                "to": "0",
                "tot": "num"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "obstacle",
                "fromt": "str",
                "to": "1",
                "tot": "num"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "safety_switch",
                "fromt": "str",
                "to": "2",
                "tot": "num"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "overpower",
                "fromt": "str",
                "to": "3",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 140,
        "wires": [
            [
                "4c9b045e.e36c4c",
                "aa8ef2f5.a13dc"
            ]
        ]
    },
    {
        "id": "4c9b045e.e36c4c",
        "type": "debug",
        "z": "615f1b13.386e84",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 200,
        "wires": []
    },
    {
        "id": "49063584.83689c",
        "type": "function",
        "z": "615f1b13.386e84",
        "name": "",
        "func": "//node.log(msg.topic);\nlet shutterName = msg.topic.substring(msg.topic.indexOf(\"/shutter\")+1, msg.topic.indexOf(\"/roller/\"));\n//node.log(\"ShutterName: \" + shutterName);\n\n//msg.topic=msg.topic.substring(msg.topic.indexOf(\"/shutter\")+1)+\"_numeric\";\nmsg.topic=\"shellies/\"+shutterName+\"/stop_reason_numeric\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 460,
        "y": 140,
        "wires": [
            [
                "c2e76407.b71ec8"
            ]
        ]
    },
    {
        "id": "2cca56f4.4a390a",
        "type": "ioBroker in",
        "z": "615f1b13.386e84",
        "name": "stop_reason",
        "topic": "mqtt-client.0.shellies.shutter-terrasse.roller.0.stop_reason",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "true",
        "x": 170,
        "y": 140,
        "wires": [
            [
                "49063584.83689c"
            ]
        ]
    },
    {
        "id": "3bd4c279.25030e",
        "type": "ioBroker in",
        "z": "615f1b13.386e84",
        "name": "stop_reason",
        "topic": "mqtt-client.0.shellies.shutter-garden.roller.0.stop_reason",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "true",
        "x": 170,
        "y": 180,
        "wires": [
            [
                "49063584.83689c"
            ]
        ]
    },
    {
        "id": "62e4f0e4.daa7f",
        "type": "ioBroker in",
        "z": "615f1b13.386e84",
        "name": "stop_reason",
        "topic": "mqtt-client.0.shellies.shutter-kitchen.roller.0.stop_reason",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "true",
        "x": 170,
        "y": 220,
        "wires": [
            [
                "49063584.83689c"
            ]
        ]
    },
    {
        "id": "3295a73a.7d53e8",
        "type": "ioBroker in",
        "z": "615f1b13.386e84",
        "name": "stop_reason",
        "topic": "mqtt-client.0.shellies.shutter-bedroom.roller.0.stop_reason",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "true",
        "x": 170,
        "y": 280,
        "wires": [
            [
                "49063584.83689c"
            ]
        ]
    },
    {
        "id": "89f29752.234ac8",
        "type": "ioBroker out",
        "z": "9c0f9de.b23666",
        "name": "Dekobeleuchtung.on",
        "topic": "hue.0.Dekobeleuchtung.on",
        "ack": "false",
        "autoCreate": "false",
        "stateName": "",
        "role": "",
        "payloadType": "",
        "readonly": "",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1220,
        "y": 160,
        "wires": []
    },
    {
        "id": "be04119.907f2f",
        "type": "ioBroker in",
        "z": "9c0f9de.b23666",
        "name": "Presence changed",
        "topic": "node-red.0.presence.presence",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "x": 150,
        "y": 100,
        "wires": [
            [
                "13938d85.75cfb2"
            ]
        ]
    },
    {
        "id": "13938d85.75cfb2",
        "type": "switch",
        "z": "9c0f9de.b23666",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 370,
        "y": 100,
        "wires": [
            [
                "4e71eac3.bb6784"
            ],
            [
                "e96e1c45.644d8",
                "a3a5fb6b0676b111"
            ]
        ]
    },
    {
        "id": "e96e1c45.644d8",
        "type": "change",
        "z": "9c0f9de.b23666",
        "name": "false",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 100,
        "wires": [
            [
                "38fb46185e825c3b"
            ]
        ]
    },
    {
        "id": "b3c13fd.b1cebc",
        "type": "change",
        "z": "9c0f9de.b23666",
        "name": "true",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 60,
        "wires": [
            [
                "38fb46185e825c3b"
            ]
        ]
    },
    {
        "id": "4e71eac3.bb6784",
        "type": "ioBroker get",
        "z": "9c0f9de.b23666",
        "name": "evening?",
        "topic": "node-red.0.states.evening.value",
        "attrname": "payload",
        "payloadType": "value",
        "x": 540,
        "y": 60,
        "wires": [
            [
                "64f9a5b.157d35c"
            ]
        ]
    },
    {
        "id": "64f9a5b.157d35c",
        "type": "switch",
        "z": "9c0f9de.b23666",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 670,
        "y": 60,
        "wires": [
            [
                "b3c13fd.b1cebc"
            ],
            [
                "e96e1c45.644d8"
            ]
        ]
    },
    {
        "id": "57c80ff9.903e",
        "type": "ioBroker in",
        "z": "9c0f9de.b23666",
        "name": "Evening started/ended",
        "topic": "node-red.0.states.evening.value",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "x": 160,
        "y": 320,
        "wires": [
            [
                "b980d3f4.c16c7"
            ]
        ]
    },
    {
        "id": "b980d3f4.c16c7",
        "type": "switch",
        "z": "9c0f9de.b23666",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 370,
        "y": 320,
        "wires": [
            [
                "3ce28101.b3586e"
            ],
            [
                "84243df1.69b23"
            ]
        ]
    },
    {
        "id": "84243df1.69b23",
        "type": "change",
        "z": "9c0f9de.b23666",
        "name": "false",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 320,
        "wires": [
            [
                "38fb46185e825c3b"
            ]
        ]
    },
    {
        "id": "3ce28101.b3586e",
        "type": "ioBroker get",
        "z": "9c0f9de.b23666",
        "name": "get presence",
        "topic": "node-red.0.presence.presence",
        "attrname": "payload",
        "payloadType": "value",
        "x": 530,
        "y": 280,
        "wires": [
            [
                "f04904e4.772be8"
            ]
        ]
    },
    {
        "id": "f04904e4.772be8",
        "type": "switch",
        "z": "9c0f9de.b23666",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 670,
        "y": 280,
        "wires": [
            [
                "397d68af.065fb8"
            ],
            [
                "84243df1.69b23"
            ]
        ]
    },
    {
        "id": "397d68af.065fb8",
        "type": "change",
        "z": "9c0f9de.b23666",
        "name": "true",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 280,
        "wires": [
            [
                "38fb46185e825c3b"
            ]
        ]
    },
    {
        "id": "a48469d0.1daa18",
        "type": "comment",
        "z": "9c0f9de.b23666",
        "name": "At midnight, switch off no matter what.",
        "info": "At midnight, switch off no matter what.",
        "x": 570,
        "y": 360,
        "wires": []
    },
    {
        "id": "a3a5fb6b0676b111",
        "type": "delay",
        "z": "9c0f9de.b23666",
        "d": true,
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 540,
        "y": 140,
        "wires": [
            [
                "3ce28101.b3586e"
            ]
        ]
    },
    {
        "id": "38fb46185e825c3b",
        "type": "switch",
        "z": "9c0f9de.b23666",
        "name": "join",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 990,
        "y": 160,
        "wires": [
            [
                "89f29752.234ac8",
                "23ac845cb820e025",
                "6f65741dc3bfa95e"
            ]
        ]
    },
    {
        "id": "23ac845cb820e025",
        "type": "debug",
        "z": "9c0f9de.b23666",
        "name": "Dekobeleuchtung",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1220,
        "y": 260,
        "wires": []
    },
    {
        "id": "6f65741dc3bfa95e",
        "type": "deconz-output",
        "z": "9c0f9de.b23666",
        "name": "Dekobeleuchtung",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "groups/device_id/17"
        ],
        "device_name": "",
        "query": "{}",
        "commands": [
            {
                "arg": {
                    "on": {
                        "type": "msg",
                        "value": "payload"
                    },
                    "alert": {
                        "type": "str",
                        "value": ""
                    },
                    "effect": {
                        "type": "str",
                        "value": ""
                    },
                    "colorloopspeed": {
                        "type": "num",
                        "value": ""
                    },
                    "transitiontime": {
                        "type": "num",
                        "value": ""
                    },
                    "retryonerror": {
                        "type": "num",
                        "value": "0"
                    },
                    "aftererror": {
                        "type": "continue",
                        "value": ""
                    },
                    "bri": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "sat": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "hue": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "ct": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "xy": {
                        "direction": "set",
                        "type": "json",
                        "value": "[]"
                    }
                },
                "type": "deconz_state",
                "domain": "groups"
            }
        ],
        "specific": {
            "delay": {
                "type": "num",
                "value": "50"
            },
            "result": {
                "type": "at_end",
                "value": ""
            }
        },
        "x": 1210,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "b94d187b.d95508",
        "type": "ioBroker in",
        "z": "60c03b99.7554f4",
        "name": "Marijke Android.presence",
        "topic": "fb-checkpresence.0.Marijke Android.presence",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "x": 130,
        "y": 120,
        "wires": [
            [
                "595841d9.fd811"
            ]
        ]
    },
    {
        "id": "595841d9.fd811",
        "type": "switch",
        "z": "60c03b99.7554f4",
        "name": "Marijke present",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 360,
        "y": 120,
        "wires": [
            [
                "14148721.16c419"
            ],
            [
                "b40a9401.879748"
            ]
        ]
    },
    {
        "id": "3cf2b3ba.92414c",
        "type": "ioBroker in",
        "z": "60c03b99.7554f4",
        "name": "Mika Android.presence",
        "topic": "fb-checkpresence.0.Mika Android.presence",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "x": 120,
        "y": 300,
        "wires": [
            [
                "c934ed3.668981"
            ]
        ]
    },
    {
        "id": "c934ed3.668981",
        "type": "switch",
        "z": "60c03b99.7554f4",
        "name": "Mika present",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 350,
        "y": 300,
        "wires": [
            [
                "14148721.16c419"
            ],
            [
                "4b86cef8.82d08"
            ]
        ]
    },
    {
        "id": "4b86cef8.82d08",
        "type": "ioBroker get",
        "z": "60c03b99.7554f4",
        "name": "Marijke present",
        "topic": "fb-checkpresence.0.Marijke Android.presence",
        "attrname": "presence_marijke",
        "payloadType": "value",
        "x": 560,
        "y": 300,
        "wires": [
            [
                "248230c8.0aa4c"
            ]
        ]
    },
    {
        "id": "248230c8.0aa4c",
        "type": "switch",
        "z": "60c03b99.7554f4",
        "name": "Marijke present",
        "property": "presence_marijke",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 560,
        "y": 360,
        "wires": [
            [
                "14148721.16c419"
            ],
            [
                "a083999f.6e1ca8"
            ]
        ]
    },
    {
        "id": "a083999f.6e1ca8",
        "type": "change",
        "z": "60c03b99.7554f4",
        "name": "false",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 360,
        "wires": [
            [
                "602ab982d90c63c8"
            ]
        ]
    },
    {
        "id": "14148721.16c419",
        "type": "change",
        "z": "60c03b99.7554f4",
        "name": "true",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 40,
        "wires": [
            [
                "89966d9e3cde6273"
            ]
        ]
    },
    {
        "id": "b40a9401.879748",
        "type": "ioBroker get",
        "z": "60c03b99.7554f4",
        "name": "Mika present",
        "topic": "fb-checkpresence.0.Mika Android.presence",
        "attrname": "presence_mika",
        "payloadType": "value",
        "x": 550,
        "y": 120,
        "wires": [
            [
                "57ec2df0.8cf1a4"
            ]
        ]
    },
    {
        "id": "57ec2df0.8cf1a4",
        "type": "switch",
        "z": "60c03b99.7554f4",
        "name": "Mika present",
        "property": "presence_mika",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 550,
        "y": 180,
        "wires": [
            [
                "14148721.16c419"
            ],
            [
                "a083999f.6e1ca8"
            ]
        ]
    },
    {
        "id": "3f01f1ba.8f716e",
        "type": "ioBroker out",
        "z": "60c03b99.7554f4",
        "name": "presence",
        "topic": "presence.presence",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "presence.presence",
        "role": "indicator",
        "payloadType": "boolean",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1600,
        "y": 220,
        "wires": []
    },
    {
        "id": "602ab982d90c63c8",
        "type": "delay",
        "z": "60c03b99.7554f4",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 660,
        "y": 480,
        "wires": [
            [
                "e3190786db31c2a8"
            ]
        ]
    },
    {
        "id": "e3190786db31c2a8",
        "type": "ioBroker get",
        "z": "60c03b99.7554f4",
        "name": "Mika present",
        "topic": "fb-checkpresence.0.Mika Android.presence",
        "attrname": "presence_mika",
        "payloadType": "value",
        "x": 830,
        "y": 480,
        "wires": [
            [
                "78eab5859e16c896"
            ]
        ]
    },
    {
        "id": "78eab5859e16c896",
        "type": "switch",
        "z": "60c03b99.7554f4",
        "name": "Mika present",
        "property": "presence_mika",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 830,
        "y": 540,
        "wires": [
            [],
            [
                "1030d55b0b564bf5"
            ]
        ]
    },
    {
        "id": "1030d55b0b564bf5",
        "type": "ioBroker get",
        "z": "60c03b99.7554f4",
        "name": "Marijke present",
        "topic": "fb-checkpresence.0.Marijke Android.presence",
        "attrname": "presence_marijke",
        "payloadType": "value",
        "x": 840,
        "y": 660,
        "wires": [
            [
                "638cc99d649df082"
            ]
        ]
    },
    {
        "id": "638cc99d649df082",
        "type": "switch",
        "z": "60c03b99.7554f4",
        "name": "Marijke present",
        "property": "presence_marijke",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 840,
        "y": 720,
        "wires": [
            [],
            [
                "dff1bf12c8889957"
            ]
        ]
    },
    {
        "id": "f195192f69f06f6f",
        "type": "comment",
        "z": "60c03b99.7554f4",
        "name": "Check again after 5 Minutes",
        "info": "",
        "x": 760,
        "y": 420,
        "wires": []
    },
    {
        "id": "81abfb69602f9029",
        "type": "function",
        "z": "60c03b99.7554f4",
        "name": "current timestamp as ISO 8601",
        "func": "// oldValue comes as a string, so we'll have to\n// convert it into a boolean\nlet oldValue = (msg.oldValue === 'true');\nlet newValue = msg.payload;\n\nif (newValue === oldValue) {\n    // No change, hence we don't update the timestamp either.\n    return null;\n}\n\nmsg.payload = new Date().toISOString();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1350,
        "y": 320,
        "wires": [
            [
                "1527624c34b70243"
            ]
        ],
        "outputLabels": [
            "new lastUpdated"
        ]
    },
    {
        "id": "1527624c34b70243",
        "type": "ioBroker out",
        "z": "60c03b99.7554f4",
        "name": "lastUpdated",
        "topic": "presence.lastUpdated",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "presence.lastUpdated",
        "role": "value.datetime",
        "payloadType": "string",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1590,
        "y": 320,
        "wires": []
    },
    {
        "id": "89966d9e3cde6273",
        "type": "switch",
        "z": "60c03b99.7554f4",
        "name": "join",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1110,
        "y": 220,
        "wires": [
            [
                "973baa3a29632c51"
            ]
        ]
    },
    {
        "id": "973baa3a29632c51",
        "type": "ioBroker get",
        "z": "60c03b99.7554f4",
        "name": "presence",
        "topic": "node-red.0.presence.presence",
        "attrname": "oldValue",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 1280,
        "y": 220,
        "wires": [
            [
                "81abfb69602f9029",
                "3f01f1ba.8f716e"
            ]
        ]
    },
    {
        "id": "dff1bf12c8889957",
        "type": "change",
        "z": "60c03b99.7554f4",
        "name": "false",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 870,
        "y": 780,
        "wires": [
            [
                "89966d9e3cde6273"
            ]
        ]
    },
    {
        "id": "e36e86b9ed9081f2",
        "type": "comment",
        "z": "60c03b99.7554f4",
        "name": "Get the old value before potentially changing it.",
        "info": "",
        "x": 1400,
        "y": 180,
        "wires": []
    },
    {
        "id": "a7d16751.482e68",
        "type": "cronplus",
        "z": "94c83aa3.f236d8",
        "name": "Mitternacht",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "schedule1",
                "payloadType": "bool",
                "payload": "false",
                "expressionType": "cron",
                "expression": "0 0 0 * * *",
                "location": "48.18609507662278, 11.596313697132464",
                "offset": "0",
                "solarType": "selected",
                "solarEvents": "civilDusk"
            }
        ],
        "x": 130,
        "y": 100,
        "wires": [
            [
                "1c732889567a533a"
            ]
        ]
    },
    {
        "id": "1c732889567a533a",
        "type": "switch",
        "z": "94c83aa3.f236d8",
        "name": "join",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 690,
        "y": 100,
        "wires": [
            [
                "adb8ddf8bcc3922b"
            ]
        ]
    },
    {
        "id": "adb8ddf8bcc3922b",
        "type": "ioBroker get",
        "z": "94c83aa3.f236d8",
        "name": "states.evening",
        "topic": "node-red.0.states.evening.value",
        "attrname": "oldValue",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 880,
        "y": 100,
        "wires": [
            [
                "96cca2b9eb5fbff5",
                "0ab77376caab53a8"
            ]
        ]
    },
    {
        "id": "6b425b9815725773",
        "type": "comment",
        "z": "94c83aa3.f236d8",
        "name": "Get the old value before potentially changing it.",
        "info": "",
        "x": 980,
        "y": 60,
        "wires": []
    },
    {
        "id": "96cca2b9eb5fbff5",
        "type": "function",
        "z": "94c83aa3.f236d8",
        "name": "current timestamp as ISO 8601",
        "func": "// oldValue comes as a string, so we'll have to\n// convert it into a boolean\nlet oldValue = (msg.oldValue === 'true');\nlet newValue = msg.payload;\n\nif (newValue === oldValue) {\n    // No change, hence we don't update the timestamp either.\n    return null;\n}\n\nmsg.payload = new Date().toISOString();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 200,
        "wires": [
            [
                "2f076e9f374c5bea"
            ]
        ],
        "outputLabels": [
            "new lastUpdated"
        ]
    },
    {
        "id": "2f076e9f374c5bea",
        "type": "ioBroker out",
        "z": "94c83aa3.f236d8",
        "name": "lastUpdated",
        "topic": "states.evening.lastUpdated",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "presence.lastUpdated",
        "role": "value.datetime",
        "payloadType": "string",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1170,
        "y": 200,
        "wires": []
    },
    {
        "id": "0ab77376caab53a8",
        "type": "ioBroker out",
        "z": "94c83aa3.f236d8",
        "name": "states.evening",
        "topic": "states.evening.value",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "states.evening",
        "role": "indicator",
        "payloadType": "boolean",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1160,
        "y": 100,
        "wires": []
    },
    {
        "id": "5c305b67966e2efa",
        "type": "cronplus",
        "z": "94c83aa3.f236d8",
        "name": "15 minutes before sunset",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "48.18609507662278, 11.596313697132464",
        "defaultLocationType": "fixed",
        "outputs": 1,
        "options": [
            {
                "name": "sunset start",
                "topic": "sunset",
                "payloadType": "default",
                "payload": "",
                "expressionType": "solar",
                "expression": "0 * * * * * *",
                "location": "",
                "offset": "-15",
                "solarType": "selected",
                "solarEvents": "sunsetStart"
            },
            {
                "name": "civil dusk",
                "topic": "dusk",
                "payloadType": "default",
                "payload": "",
                "expressionType": "solar",
                "expression": "0 * * * * * *",
                "location": "",
                "offset": "-19",
                "solarType": "selected",
                "solarEvents": "civilDusk"
            }
        ],
        "x": 170,
        "y": 60,
        "wires": [
            [
                "19a97c66a237044b"
            ]
        ]
    },
    {
        "id": "19a97c66a237044b",
        "type": "function",
        "z": "94c83aa3.f236d8",
        "name": "Discard \"invalid\" trigger",
        "func": "let topic = msg.topic;\nlet now = new Date();\nlet currentMonth = now.getMonth();\n\nif (currentMonth <= 3 || currentMonth >= 11) {\n    // It's winter. Hence we want to trigger at (before) sunset.\n    if (topic === 'sunset') {\n        msg.payload = true;\n        return msg;\n    } else {\n        node.log(`Trigger ${topic} discarded because it's winter.`);\n        return null;\n    }\n} else {\n    // It's summer. Hence we want to trigger just before civil dusk.\n    if (topic === 'dusk') {\n        msg.payload = true;\n        return msg;\n    } else {\n        node.log(`Trigger ${topic} discarded because it's summer.`);\n        return null;\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 60,
        "wires": [
            [
                "1c732889567a533a"
            ]
        ]
    },
    {
        "id": "c107e75c.0c6288",
        "type": "ioBroker in",
        "z": "c13d8339.426df",
        "name": "Presence changed",
        "topic": "node-red.0.presence.presence",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "x": 190,
        "y": 200,
        "wires": [
            [
                "d03e8104.3bc2d"
            ]
        ]
    },
    {
        "id": "452bec58.757394",
        "type": "ioBroker get",
        "z": "c13d8339.426df",
        "name": "Check presence again",
        "topic": "node-red.0.presence.presence",
        "attrname": "payload",
        "payloadType": "value",
        "x": 740,
        "y": 200,
        "wires": [
            [
                "b50179cb.4b9a88"
            ]
        ]
    },
    {
        "id": "d03e8104.3bc2d",
        "type": "switch",
        "z": "c13d8339.426df",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 370,
        "y": 200,
        "wires": [
            [
                "39b6d700.5fea9a"
            ],
            [
                "a6c3cd0c0eae959e"
            ]
        ]
    },
    {
        "id": "b50179cb.4b9a88",
        "type": "switch",
        "z": "c13d8339.426df",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 930,
        "y": 200,
        "wires": [
            [
                "32998b23.423b34",
                "68087844.ec3fd8",
                "65546191.1d65",
                "9f461854a515f563",
                "a6c3cd0c0eae959e"
            ]
        ]
    },
    {
        "id": "39b6d700.5fea9a",
        "type": "delay",
        "z": "c13d8339.426df",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 530,
        "y": 200,
        "wires": [
            [
                "452bec58.757394"
            ]
        ]
    },
    {
        "id": "46e8964.de31368",
        "type": "inject",
        "z": "c13d8339.426df",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 920,
        "y": 260,
        "wires": [
            [
                "68087844.ec3fd8",
                "32998b23.423b34",
                "65546191.1d65",
                "9f461854a515f563"
            ]
        ]
    },
    {
        "id": "32998b23.423b34",
        "type": "sonos-universal",
        "z": "c13d8339.426df",
        "confignode": "e440dc25.3eb78",
        "command": "group.stop",
        "state": "",
        "stateType": "str",
        "avoidCheckPlayerAvailability": false,
        "name": "",
        "x": 1150,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "68087844.ec3fd8",
        "type": "sonos-universal",
        "z": "c13d8339.426df",
        "confignode": "9a755bfc.1124c8",
        "command": "group.stop",
        "state": "",
        "stateType": "str",
        "avoidCheckPlayerAvailability": false,
        "name": "",
        "x": 1150,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "65546191.1d65",
        "type": "debug",
        "z": "c13d8339.426df",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"All Sonos instances have been stopped due to absence\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 140,
        "wires": []
    },
    {
        "id": "9f461854a515f563",
        "type": "sonos-universal",
        "z": "c13d8339.426df",
        "confignode": "a641922fff0cd09a",
        "command": "group.stop",
        "state": "",
        "stateType": "str",
        "avoidCheckPlayerAvailability": false,
        "name": "",
        "x": 1150,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "6903a35305a33477",
        "type": "inject",
        "z": "c13d8339.426df",
        "name": "on",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "true",
        "payloadType": "str",
        "x": 850,
        "y": 420,
        "wires": [
            [
                "a6c3cd0c0eae959e"
            ]
        ]
    },
    {
        "id": "dc5851439c55c3cf",
        "type": "inject",
        "z": "c13d8339.426df",
        "name": "off",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "false",
        "payloadType": "str",
        "x": 850,
        "y": 460,
        "wires": [
            [
                "a6c3cd0c0eae959e"
            ]
        ]
    },
    {
        "id": "a6c3cd0c0eae959e",
        "type": "deconz-output",
        "z": "c13d8339.426df",
        "name": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "lights/uniqueid/b4:e3:f9:ff:fe:aa:0b:83-01"
        ],
        "device_name": "",
        "query": "{}",
        "commands": [
            {
                "arg": {
                    "on": {
                        "type": "msg",
                        "value": "payload"
                    },
                    "alert": {
                        "type": "str",
                        "value": ""
                    },
                    "effect": {
                        "type": "str",
                        "value": ""
                    },
                    "colorloopspeed": {
                        "type": "num",
                        "value": ""
                    },
                    "transitiontime": {
                        "type": "num",
                        "value": ""
                    },
                    "retryonerror": {
                        "type": "num",
                        "value": "0"
                    },
                    "aftererror": {
                        "type": "continue",
                        "value": ""
                    },
                    "bri": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "sat": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "hue": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "ct": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "xy": {
                        "direction": "set",
                        "type": "json",
                        "value": "[]"
                    }
                },
                "type": "deconz_state",
                "domain": "lights"
            }
        ],
        "specific": {
            "delay": {
                "type": "num",
                "value": "50"
            },
            "result": {
                "type": "at_end",
                "value": ""
            }
        },
        "x": 1150,
        "y": 400,
        "wires": [
            [
                "4b1d47f8c98d3879"
            ]
        ]
    },
    {
        "id": "4b1d47f8c98d3879",
        "type": "debug",
        "z": "c13d8339.426df",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1250,
        "y": 500,
        "wires": []
    },
    {
        "id": "469ed187f9c98cba",
        "type": "sonos-universal",
        "z": "c13d8339.426df",
        "confignode": "e440dc25.3eb78",
        "command": "group.get.state",
        "state": "",
        "stateType": "str",
        "avoidCheckPlayerAvailability": false,
        "name": "",
        "x": 380,
        "y": 420,
        "wires": [
            [
                "6e0eafb7d1879e93"
            ]
        ]
    },
    {
        "id": "6e0eafb7d1879e93",
        "type": "debug",
        "z": "c13d8339.426df",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 590,
        "y": 420,
        "wires": []
    },
    {
        "id": "ad93e3dfbecf0da8",
        "type": "inject",
        "z": "c13d8339.426df",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 420,
        "wires": [
            [
                "469ed187f9c98cba"
            ]
        ]
    },
    {
        "id": "7cdbeab38d078f4d",
        "type": "sonos-universal",
        "z": "c13d8339.426df",
        "confignode": "e440dc25.3eb78",
        "command": "group.next.track",
        "state": "",
        "stateType": "str",
        "avoidCheckPlayerAvailability": false,
        "name": "",
        "x": 420,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "887a2993a6c57e8e",
        "type": "inject",
        "z": "c13d8339.426df",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 660,
        "wires": [
            [
                "7cdbeab38d078f4d"
            ]
        ]
    },
    {
        "id": "705e794d62959bef",
        "type": "deconz-input",
        "z": "c13d8339.426df",
        "name": "Button | Skip Track",
        "topic": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "sensors/uniqueid/84:ba:20:ff:fe:ca:e8:ba-01-1000",
            "sensors/uniqueid/84:ba:20:ff:fe:a4:52:67-01-1000"
        ],
        "device_name": "",
        "query": "{}",
        "outputs": 1,
        "output_rules": [
            {
                "type": "state",
                "format": "single",
                "output": "onchange",
                "onstart": false,
                "payload": [
                    "__complete__"
                ]
            }
        ],
        "x": 150,
        "y": 580,
        "wires": [
            [
                "7cdbeab38d078f4d"
            ]
        ]
    },
    {
        "id": "68a99e64.42131",
        "type": "ioBroker in",
        "z": "4b1f3e4c.b2604",
        "name": "Presence changed",
        "topic": "node-red.0.presence.presence",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "x": 170,
        "y": 100,
        "wires": [
            [
                "9e99113d.14ab6"
            ]
        ]
    },
    {
        "id": "989f00d1.3a0bf",
        "type": "ioBroker get",
        "z": "4b1f3e4c.b2604",
        "name": "Check presence again",
        "topic": "node-red.0.presence.presence",
        "attrname": "payload",
        "payloadType": "value",
        "x": 740,
        "y": 100,
        "wires": [
            [
                "ca5ef598.e76fa8"
            ]
        ]
    },
    {
        "id": "9e99113d.14ab6",
        "type": "switch",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 370,
        "y": 100,
        "wires": [
            [
                "6c5aa871.ce7258"
            ]
        ]
    },
    {
        "id": "ca5ef598.e76fa8",
        "type": "switch",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 930,
        "y": 100,
        "wires": [
            [
                "a871ad10.0cdd8"
            ]
        ]
    },
    {
        "id": "6c5aa871.ce7258",
        "type": "delay",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "outputs": 1,
        "x": 530,
        "y": 100,
        "wires": [
            [
                "989f00d1.3a0bf"
            ]
        ]
    },
    {
        "id": "7fe56d9e.2f9014",
        "type": "telegrambot-switch",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "bot": "f88b4105.9be82",
        "chatId": "-474645721",
        "question": "",
        "answers": [
            "Yes",
            "No"
        ],
        "outputs": 3,
        "autoAnswerCallback": true,
        "verticalAnswers": false,
        "timeoutValue": "30",
        "timeoutUnits": "min",
        "parseMode": "",
        "x": 1560,
        "y": 100,
        "wires": [
            [
                "aab89493.aff268",
                "782ab93d.a63c08",
                "76e403a.9074dfc"
            ],
            [
                "e0f8fe09.3f7fa",
                "4b7a4783.9cfb38"
            ],
            [
                "6fc77e96.e05b9",
                "8cccca96.205fd8"
            ]
        ]
    },
    {
        "id": "323343b9.a44bac",
        "type": "inject",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "\"Test\"",
        "payloadType": "str",
        "x": 1350,
        "y": 40,
        "wires": [
            [
                "7fe56d9e.2f9014"
            ]
        ]
    },
    {
        "id": "aab89493.aff268",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Roomba: Starting cleanup\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1830,
        "y": 560,
        "wires": []
    },
    {
        "id": "e0f8fe09.3f7fa",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Roomba: Cleanup request has been rejected.\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1830,
        "y": 620,
        "wires": []
    },
    {
        "id": "d36bebbc.b15518",
        "type": "telegrambot-command",
        "z": "4b1f3e4c.b2604",
        "name": "clean-command",
        "bot": "f88b4105.9be82",
        "command": "/clean@roomba.*",
        "commandType": "re",
        "commandCase": false,
        "x": 880,
        "y": 160,
        "wires": [
            [
                "486905a4.85862c",
                "72e1027e.eaee4c"
            ]
        ]
    },
    {
        "id": "6fc77e96.e05b9",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Roomba: Cleanup request has timed out.\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1830,
        "y": 660,
        "wires": []
    },
    {
        "id": "ec8cad6f.38a94",
        "type": "template",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "plain",
        "template": "Apparently everyone has left. Shall I clean the place?",
        "output": "str",
        "x": 1340,
        "y": 100,
        "wires": [
            [
                "7fe56d9e.2f9014"
            ]
        ]
    },
    {
        "id": "5b6028bf.708ed8",
        "type": "template",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "json",
        "syntax": "plain",
        "template": "You want me to clean up?",
        "output": "str",
        "x": 1340,
        "y": 160,
        "wires": [
            [
                "7fe56d9e.2f9014"
            ]
        ]
    },
    {
        "id": "a7330326.7a644",
        "type": "inject",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 930,
        "y": 40,
        "wires": [
            [
                "a871ad10.0cdd8"
            ]
        ]
    },
    {
        "id": "782ab93d.a63c08",
        "type": "ioBroker out",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "topic": "roomba.0.commands.start",
        "ack": "false",
        "autoCreate": "false",
        "stateName": "",
        "role": "",
        "payloadType": "",
        "readonly": "",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1990,
        "y": 20,
        "wires": []
    },
    {
        "id": "a871ad10.0cdd8",
        "type": "subflow:ee56faad.f111e8",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "env": [],
        "x": 1120,
        "y": 100,
        "wires": [
            [
                "ec8cad6f.38a94"
            ],
            [
                "177733d7.c3e98c"
            ]
        ]
    },
    {
        "id": "177733d7.c3e98c",
        "type": "telegrambot-notify",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "bot": "f88b4105.9be82",
        "chatId": "-474645721",
        "message": "",
        "parseMode": "",
        "x": 1360,
        "y": 220,
        "wires": []
    },
    {
        "id": "486905a4.85862c",
        "type": "subflow:ee56faad.f111e8",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "env": [],
        "x": 1120,
        "y": 160,
        "wires": [
            [
                "5b6028bf.708ed8"
            ],
            [
                "177733d7.c3e98c"
            ]
        ]
    },
    {
        "id": "72e1027e.eaee4c",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1070,
        "y": 200,
        "wires": []
    },
    {
        "id": "c702d984.dfa328",
        "type": "ioBroker in",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "topic": "roomba.0.states.binFull",
        "payloadType": "value",
        "onlyack": "",
        "func": "all",
        "gap": "",
        "fireOnStart": "false",
        "x": 840,
        "y": 380,
        "wires": [
            [
                "84646cad.10c5f"
            ]
        ]
    },
    {
        "id": "84646cad.10c5f",
        "type": "subflow:ee56faad.f111e8",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "env": [],
        "x": 1120,
        "y": 380,
        "wires": [
            [],
            [
                "177733d7.c3e98c"
            ]
        ]
    },
    {
        "id": "76e403a.9074dfc",
        "type": "template",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "plain",
        "template": "Affirmative! Cleaning like a boss.",
        "output": "str",
        "x": 1940,
        "y": 80,
        "wires": [
            [
                "a39f6a10.92e1e8"
            ]
        ]
    },
    {
        "id": "4b7a4783.9cfb38",
        "type": "template",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Very well. Maybe next time.",
        "output": "str",
        "x": 1940,
        "y": 120,
        "wires": [
            [
                "a39f6a10.92e1e8"
            ]
        ]
    },
    {
        "id": "8cccca96.205fd8",
        "type": "template",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Hello?\nGuess that's a no...",
        "output": "str",
        "x": 1940,
        "y": 160,
        "wires": [
            [
                "a39f6a10.92e1e8"
            ]
        ]
    },
    {
        "id": "a39f6a10.92e1e8",
        "type": "telegrambot-notify",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "bot": "f88b4105.9be82",
        "chatId": "-474645721",
        "message": "",
        "parseMode": "",
        "x": 2140,
        "y": 120,
        "wires": []
    },
    {
        "id": "b631f2ff.5a8c",
        "type": "telegram command",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "command": "/dock",
        "description": "Let Roomba return to its base.",
        "registercommand": true,
        "language": "",
        "scope": "default",
        "bot": "35f160c4.6ef4d",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 150,
        "y": 1120,
        "wires": [
            [
                "e7405a22.2af638"
            ],
            [
                "e7405a22.2af638"
            ]
        ]
    },
    {
        "id": "e7405a22.2af638",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 390,
        "y": 1120,
        "wires": []
    },
    {
        "id": "54401799.ad08c8",
        "type": "telegrambot-command",
        "z": "4b1f3e4c.b2604",
        "name": "dock-command",
        "bot": "f88b4105.9be82",
        "command": "/dock@roomba.*",
        "commandType": "re",
        "commandCase": false,
        "x": 160,
        "y": 480,
        "wires": [
            [
                "887c4de6.fc35b",
                "4a28031e.c5451c"
            ]
        ]
    },
    {
        "id": "870d01d4.f87c1",
        "type": "telegram command",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "command": "/clean",
        "description": "Let Roomba clean the place.",
        "registercommand": true,
        "language": "",
        "scope": "default",
        "bot": "35f160c4.6ef4d",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 150,
        "y": 1060,
        "wires": [
            [
                "1a89a360.6daf8d"
            ],
            [
                "1a89a360.6daf8d"
            ]
        ]
    },
    {
        "id": "1a89a360.6daf8d",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 390,
        "y": 1060,
        "wires": []
    },
    {
        "id": "bc9255a8.449dd8",
        "type": "ioBroker out",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "topic": "roomba.0.commands.dock",
        "ack": "false",
        "autoCreate": "false",
        "stateName": "",
        "role": "",
        "payloadType": "",
        "readonly": "",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1160,
        "y": 480,
        "wires": []
    },
    {
        "id": "887c4de6.fc35b",
        "type": "subflow:ee56faad.f111e8",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "env": [],
        "x": 540,
        "y": 480,
        "wires": [
            [
                "bc9255a8.449dd8",
                "e15750bc.7e515"
            ],
            [
                "4fb09f76.1a1a4",
                "4a28031e.c5451c"
            ]
        ]
    },
    {
        "id": "4a28031e.c5451c",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 780,
        "wires": []
    },
    {
        "id": "4fb09f76.1a1a4",
        "type": "telegrambot-notify",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "bot": "f88b4105.9be82",
        "chatId": "-474645721",
        "message": "",
        "parseMode": "",
        "x": 1240,
        "y": 740,
        "wires": []
    },
    {
        "id": "e15750bc.7e515",
        "type": "template",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Affirmative! On my way home.",
        "output": "str",
        "x": 940,
        "y": 520,
        "wires": [
            [
                "4fb09f76.1a1a4",
                "4a28031e.c5451c"
            ]
        ]
    },
    {
        "id": "ceb202ad.8352c",
        "type": "comment",
        "z": "4b1f3e4c.b2604",
        "name": "Command registrations.",
        "info": "These node use a different Roomba plugin to the one used in the actual flows.\nThey are only used to register commands (including a description) at Telegram, which the other plugin isn't able to do. Hence we only use the non-polling client here (and usually deactivate the nodes) in order to prevent conflicts.",
        "x": 190,
        "y": 1000,
        "wires": []
    },
    {
        "id": "1c0601ec.93da8e",
        "type": "ioBroker in",
        "z": "4b1f3e4c.b2604",
        "name": "status",
        "topic": "roomba.0.states.status",
        "payloadType": "value",
        "onlyack": "",
        "func": "all",
        "gap": "",
        "fireOnStart": "false",
        "x": 130,
        "y": 740,
        "wires": [
            [
                "89c39357.1da74",
                "bc57ae19.f1a89"
            ]
        ]
    },
    {
        "id": "89c39357.1da74",
        "type": "switch",
        "z": "4b1f3e4c.b2604",
        "name": "docker == true",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "charge",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 380,
        "y": 740,
        "wires": [
            [
                "f1138551.4f6de8"
            ]
        ]
    },
    {
        "id": "f1138551.4f6de8",
        "type": "template",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "I am back home and recharging.",
        "output": "str",
        "x": 580,
        "y": 740,
        "wires": [
            [
                "4fb09f76.1a1a4",
                "4a28031e.c5451c"
            ]
        ]
    },
    {
        "id": "6471a32d.0f90dc",
        "type": "ioBroker in",
        "z": "4b1f3e4c.b2604",
        "name": "battery full",
        "topic": "roomba.0.states.battery",
        "payloadType": "value",
        "onlyack": "update",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "x": 140,
        "y": 800,
        "wires": [
            [
                "b495a4f3.aabfc8"
            ]
        ]
    },
    {
        "id": "b495a4f3.aabfc8",
        "type": "switch",
        "z": "4b1f3e4c.b2604",
        "name": "full",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "100",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 350,
        "y": 800,
        "wires": [
            [
                "a56850eb.73168"
            ]
        ]
    },
    {
        "id": "a56850eb.73168",
        "type": "template",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Fully charged and ready to roll.",
        "output": "str",
        "x": 580,
        "y": 800,
        "wires": [
            [
                "4fb09f76.1a1a4",
                "4a28031e.c5451c"
            ]
        ]
    },
    {
        "id": "bc57ae19.f1a89",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 680,
        "wires": []
    },
    {
        "id": "ebcc9f46.3f1d1",
        "type": "telegram sender",
        "z": "4b1f3e4c.b2604",
        "name": "Test poll",
        "bot": "abb06234.e8fcf",
        "haserroroutput": true,
        "outputs": 2,
        "x": 600,
        "y": 1280,
        "wires": [
            [
                "43c364bd.71eebc"
            ],
            [
                "133ca9d8.5d0566"
            ]
        ]
    },
    {
        "id": "6ad2b5d4.74ffbc",
        "type": "inject",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 1280,
        "wires": [
            [
                "e247cdd2.4228"
            ]
        ]
    },
    {
        "id": "1b6c8ea6.31ff81",
        "type": "template",
        "z": "4b1f3e4c.b2604",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{\n    \"type\": \"poll\",\n    \"content\": \"What do you think?\",\n    \"options\": [\"Yes\", \"No\", \"Maybe\"]\n}",
        "output": "json",
        "x": 390,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "5b49c707.260a68",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "TestInput",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 600,
        "y": 1320,
        "wires": []
    },
    {
        "id": "43c364bd.71eebc",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "TestOutput",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 1240,
        "wires": []
    },
    {
        "id": "133ca9d8.5d0566",
        "type": "debug",
        "z": "4b1f3e4c.b2604",
        "name": "ERROR",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 960,
        "y": 1300,
        "wires": []
    },
    {
        "id": "e247cdd2.4228",
        "type": "function",
        "z": "4b1f3e4c.b2604",
        "name": "create poll",
        "func": "msg.payload.type = 'poll';\nmsg.payload.content = \"What do you think?\";\nmsg.payload.options = [\"A\", \"B\", \"C\" ];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1240,
        "wires": [
            [
                "ebcc9f46.3f1d1",
                "5b49c707.260a68"
            ]
        ]
    },
    {
        "id": "29f1d57e.66b52a",
        "type": "telegram sender",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "",
        "bot": "abb06234.e8fcf",
        "haserroroutput": false,
        "outputs": 1,
        "x": 770,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "aeb4e2e8.ee8b",
        "type": "telegram event",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "Poll",
        "bot": "abb06234.e8fcf",
        "event": "poll",
        "autoanswer": false,
        "x": 170,
        "y": 480,
        "wires": [
            [
                "78b59b12.6793e4"
            ]
        ]
    },
    {
        "id": "1e912334.8a1d2d",
        "type": "telegram receiver",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "",
        "bot": "abb06234.e8fcf",
        "saveDataDir": "",
        "filterCommands": false,
        "x": 210,
        "y": 380,
        "wires": [
            [
                "78b59b12.6793e4",
                "29f1d57e.66b52a"
            ],
            []
        ]
    },
    {
        "id": "78b59b12.6793e4",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 420,
        "wires": []
    },
    {
        "id": "2bab010d.920a9e",
        "type": "telegram event",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "Poll Answer",
        "bot": "abb06234.e8fcf",
        "event": "poll_answer",
        "autoanswer": false,
        "x": 190,
        "y": 560,
        "wires": [
            [
                "78b59b12.6793e4"
            ]
        ]
    },
    {
        "id": "75a3afbd.a59c8",
        "type": "telegram command",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "",
        "command": "/newpoll1",
        "description": "",
        "registercommand": false,
        "language": "",
        "bot": "abb06234.e8fcf",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 180,
        "y": 160,
        "wires": [
            [
                "c50749bf.376108"
            ],
            []
        ]
    },
    {
        "id": "c50749bf.376108",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "create poll",
        "func": "msg.payload.type = 'poll';\nmsg.payload.content = \"What do you think?\";\nmsg.payload.options = [\"A\", \"B\", \"C\" ];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 160,
        "wires": [
            [
                "29f1d57e.66b52a"
            ]
        ]
    },
    {
        "id": "6a2b097c.bc1428",
        "type": "telegram command",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "",
        "command": "/newpoll2",
        "description": "",
        "registercommand": false,
        "language": "",
        "bot": "abb06234.e8fcf",
        "strict": false,
        "hasresponse": true,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 2,
        "x": 180,
        "y": 240,
        "wires": [
            [
                "b2033371.73ece"
            ],
            []
        ]
    },
    {
        "id": "b2033371.73ece",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "create poll with optional arguments",
        "func": "msg.payload.type = 'poll';\nmsg.payload.content = \"What do you think?\";\nmsg.payload.options = [\"A\", \"B\", \"C\" ];\n\n// you can add optional arguments see\n// https://core.telegram.org/bots/api#sendpoll\nmsg.payload.optional = {\n    allows_multiple_answers : true\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 220,
        "wires": [
            [
                "29f1d57e.66b52a"
            ]
        ]
    },
    {
        "id": "f7c18f49.063c4",
        "type": "telegram sender",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "",
        "bot": "abb06234.e8fcf",
        "haserroroutput": false,
        "outputs": 1,
        "x": 670,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "f97878f7.de1bf8",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "build keyboard",
        "func": "var opts = {\n  reply_markup: JSON.stringify({\n    \"inline_keyboard\": [[\n                {\n                    \"text\": \"A1\",\n                    \"callback_data\": \"1\"            \n                }, \n                {\n                    \"text\": \"A2\",\n                    \"callback_data\": \"2\"            \n                }]\n            ]\n  })\n};\n\nmsg.payload.content = \"Selection?\";\nmsg.payload.options = opts;\nmsg.payload.chatId = 1216101020;\nmsg.payload.messageId = 99;\nmsg.payload.sentMessageId = 99;\nmsg.payload.type = \"message\";\n\nreturn [ msg ];\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 700,
        "wires": [
            [
                "f7c18f49.063c4",
                "67925ff5.4c7c9"
            ]
        ]
    },
    {
        "id": "67925ff5.4c7c9",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 630,
        "y": 760,
        "wires": []
    },
    {
        "id": "e1a6a394.269598",
        "type": "inject",
        "z": "a8a95e02.bf408",
        "name": "",
        "props": [
            {
                "p": "payload.content",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 170,
        "y": 700,
        "wires": [
            [
                "f97878f7.de1bf8"
            ]
        ]
    },
    {
        "id": "981d4537.1ced18",
        "type": "telegram event",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "",
        "bot": "abb06234.e8fcf",
        "event": "callback_query",
        "autoanswer": false,
        "x": 180,
        "y": 782,
        "wires": [
            [
                "ab3f06a.9c5a0f8"
            ]
        ]
    },
    {
        "id": "ab3f06a.9c5a0f8",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 370,
        "y": 782,
        "wires": []
    },
    {
        "id": "93430912.0f4f4",
        "type": "comment",
        "z": "a8a95e02.bf408",
        "name": "Inline keyboard: Reply with \"callback_query\"",
        "info": "",
        "x": 290,
        "y": 642,
        "wires": []
    },
    {
        "id": "20636f59.fed13",
        "type": "telegram event",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "",
        "bot": "abb06234.e8fcf",
        "event": "callback_query",
        "autoanswer": true,
        "x": 200,
        "y": 1060,
        "wires": [
            [
                "f0a3c788.7bbb18"
            ]
        ]
    },
    {
        "id": "d0ae190d.071828",
        "type": "telegram sender",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "show inline keyboard",
        "bot": "abb06234.e8fcf",
        "haserroroutput": false,
        "outputs": 1,
        "x": 642.7594223022461,
        "y": 953.3033103942871,
        "wires": [
            [
                "23220303.4a427c"
            ]
        ]
    },
    {
        "id": "3426758a.a2d09a",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "initial inline keyboard message",
        "func": "context.global.keyboard = { messageId : msg.payload.messageId };\n\nvar opts = {\n  reply_to_message_id: msg.payload.messageId,\n  reply_markup: JSON.stringify({\n    \"inline_keyboard\": [[\n                {\n                    \"text\": \"Yes\",\n                    \"callback_data\": \"FOO YES\"            \n                }, \n                {\n                    \"text\": \"No\",\n                    \"callback_data\": \"FOO NO\"            \n                }]\n            ]\n  })\n};\n\nmsg.payload.content = 'Do you want to hide the inline keyboard?';\nmsg.payload.options = opts;\n\nreturn [ msg ];\n",
        "outputs": "1",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 381.7592468261719,
        "y": 954.3032283782959,
        "wires": [
            [
                "d0ae190d.071828"
            ]
        ]
    },
    {
        "id": "d7bfbd4.da4e34",
        "type": "telegram command",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "/foo",
        "command": "/foo",
        "description": "",
        "registercommand": false,
        "language": "",
        "bot": "abb06234.e8fcf",
        "strict": false,
        "hasresponse": false,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 1,
        "x": 162.75931549072266,
        "y": 960.3032102584839,
        "wires": [
            [
                "3426758a.a2d09a"
            ]
        ]
    },
    {
        "id": "43cecef5.e2e93",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "YES REALLY",
        "func": "// Hide the keyboard and forget the messageId\nmsg.payload.type = 'deleteMessage';\nmsg.payload.content = context.global.keyboard.messageId\ncontext.global.keyboard.messageId = null;\n\n// You could also send a editMessageReplyMarkup with an empty reply_markup here\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 640,
        "y": 1060,
        "wires": [
            [
                "8e746981.f48368"
            ]
        ]
    },
    {
        "id": "8e746981.f48368",
        "type": "telegram sender",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "",
        "bot": "abb06234.e8fcf",
        "haserroroutput": false,
        "outputs": 1,
        "x": 870,
        "y": 1060,
        "wires": [
            [
                "2e9b911.c6c726e"
            ]
        ]
    },
    {
        "id": "2c6089c4.883006",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "YES",
        "func": "// This is the message id of the initial keyboard that is simply exchanged by a new one.\nvar messageId = context.global.keyboard.messageId;\n\n// This is a sample of how to send a second inline keyboard with modified buttons\nvar reply_markup = JSON.stringify({\n    \"inline_keyboard\": [[\n                {\n                    \"text\": \"Are you really sure?\",\n                    \"callback_data\": \"FOO YES REALLY\"            \n                }, \n                {\n                    \"text\": \"No\",\n                    \"callback_data\": \"FOO NO\"            \n                }]\n            ]\n  });\n\n\nvar options = {\n    chat_id : msg.payload.chatId,\n    reply_markup : reply_markup,\n    message_id : messageId\n};\n\nmsg.payload.type = 'editMessageReplyMarkup';\nmsg.payload.content = reply_markup;\nmsg.payload.options = options;\n\nreturn [ msg ];\n",
        "outputs": "1",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 1020,
        "wires": [
            [
                "8e746981.f48368"
            ]
        ]
    },
    {
        "id": "23220303.4a427c",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "save messageId",
        "func": "// We store the messageId to be able to edit this reply in the callback query. \ncontext.global.keyboard.messageId = msg.payload.sentMessageId;\nreturn [ msg ];\n",
        "outputs": "1",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860.6667861938477,
        "y": 953.6667127609253,
        "wires": [
            []
        ]
    },
    {
        "id": "2e9b911.c6c726e",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 1060,
        "wires": []
    },
    {
        "id": "f0a3c788.7bbb18",
        "type": "switch",
        "z": "a8a95e02.bf408",
        "name": "check callback data",
        "property": "payload.content",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "FOO YES",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "FOO YES REALLY",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "FOO NO",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 410,
        "y": 1060,
        "wires": [
            [
                "2c6089c4.883006"
            ],
            [
                "43cecef5.e2e93"
            ],
            [
                "8e23029e.001b7"
            ]
        ]
    },
    {
        "id": "8e23029e.001b7",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "NO",
        "func": "var show_alert = true; // you can set this to true to open a dialog with the answer in the client.\n\n// msg.payload.content contains the callback data from the keyboard.\n// You may change this value here.\nmsg.payload.options = show_alert;\n\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 1100,
        "wires": [
            [
                "8e746981.f48368"
            ]
        ]
    },
    {
        "id": "74e754671fe7df75",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "no action during summer",
        "func": "function addDays(date, days) {\n  var result = new Date(date);\n  result.setDate(result.getDate() + days);\n  return result;\n}\n\n// longest day of the year is midsommar - 21.06.####\n// deactivate function during summer (21.06. +/- n days)\nvar daysAroundMidsommar = 30;\nvar today = new Date();\n// node.warn('today ' + today);\nvar midsommar = new Date(today.getFullYear(), 5, 21);\nvar startDate = addDays(midsommar, -1 * daysAroundMidsommar);\n// node.warn('startDate: ' + startDate);\nvar endDate = addDays(midsommar, daysAroundMidsommar);\n//node.warn('endDate: ' + endDate);\n\nif (startDate < today && today < endDate) {\n    return [null, msg];\n}\nreturn [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 370,
        "y": 1200,
        "wires": [
            [
                "3b9f8398252a8e4b"
            ],
            [
                "fa5a883d21f42bea"
            ]
        ]
    },
    {
        "id": "4ffdfc0ab8b7739f",
        "type": "inject",
        "z": "a8a95e02.bf408",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "55",
        "payloadType": "num",
        "x": 190,
        "y": 1280,
        "wires": [
            [
                "74e754671fe7df75"
            ]
        ]
    },
    {
        "id": "3b9f8398252a8e4b",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "name": "Out 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 1280,
        "wires": []
    },
    {
        "id": "fa5a883d21f42bea",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "name": "Out 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 1320,
        "wires": []
    },
    {
        "id": "7f3cee8e7bde80d9",
        "type": "inject",
        "z": "a8a95e02.bf408",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 1400,
        "wires": [
            [
                "9d76f7328883a7d9"
            ]
        ]
    },
    {
        "id": "9d76f7328883a7d9",
        "type": "ioBroker get",
        "z": "a8a95e02.bf408",
        "name": "",
        "topic": "alias.0.sensors.brightness.livingroom.0",
        "attrname": "payload",
        "payloadType": "value",
        "errOnInvalidState": "nothing",
        "x": 470,
        "y": 1400,
        "wires": [
            []
        ]
    },
    {
        "id": "7fa391c9de686acf",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "name": "brightness",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 810,
        "y": 1520,
        "wires": []
    },
    {
        "id": "0e53eb72339e568f",
        "type": "deconz-get",
        "z": "a8a95e02.bf408",
        "name": "get brightness livingroom",
        "config_version": 1,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "sensors/uniqueid/54:ef:44:10:00:01:9e:cc-01-0400"
        ],
        "device_name": "",
        "query": "{}",
        "outputs": 1,
        "output_rules": [
            {
                "type": "state",
                "format": "single",
                "payload": [
                    "__complete__"
                ]
            }
        ],
        "x": 510,
        "y": 1520,
        "wires": [
            [
                "7fa391c9de686acf"
            ]
        ]
    },
    {
        "id": "94cd3240cdcb2745",
        "type": "inject",
        "z": "a8a95e02.bf408",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 1520,
        "wires": [
            [
                "0e53eb72339e568f"
            ]
        ]
    },
    {
        "id": "474a94449b2495b0",
        "type": "deconz-output",
        "z": "a8a95e02.bf408",
        "name": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "groups/device_id/1"
        ],
        "device_name": "",
        "query": "{}",
        "commands": [
            {
                "arg": {
                    "on": {
                        "type": "keep",
                        "value": ""
                    },
                    "alert": {
                        "type": "str",
                        "value": ""
                    },
                    "effect": {
                        "type": "str",
                        "value": ""
                    },
                    "colorloopspeed": {
                        "type": "num",
                        "value": ""
                    },
                    "transitiontime": {
                        "type": "num",
                        "value": ""
                    },
                    "retryonerror": {
                        "type": "num",
                        "value": "0"
                    },
                    "aftererror": {
                        "type": "continue",
                        "value": ""
                    },
                    "bri": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "sat": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "hue": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "ct": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "xy": {
                        "direction": "set",
                        "type": "json",
                        "value": "[]"
                    }
                },
                "type": "deconz_state",
                "domain": "lights"
            }
        ],
        "specific": {
            "delay": {
                "type": "num",
                "value": "50"
            },
            "result": {
                "type": "at_end",
                "value": ""
            }
        },
        "x": 470,
        "y": 1600,
        "wires": [
            []
        ]
    },
    {
        "id": "7c393cf570bd8ea0",
        "type": "inject",
        "z": "a8a95e02.bf408",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 1600,
        "wires": [
            [
                "474a94449b2495b0"
            ]
        ]
    },
    {
        "id": "016c215c20e0261d",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "",
        "func": "var temperature = parseFloat(msg.temperatureStr);\nvar humidity = parseFloat(msg.humidityStr);\n\nvar es;\nvar ed;\nvar eln;\nvar td;\nif (temperature >= 0)\n{\n\t\t    es = 6.1078*Math.pow(10,((7.5*temperature)/(237.3 + temperature)));\n\t\t    ed = humidity/100.0*es;\n\t\t    eln = Math.log10(ed/6.1078);\n\t\t\ttd = 237.3*eln/(7.5 - eln);\n}\nelse\n{\n\t\t    es = 6.1078*Math.pow(10,((7.6*temperature)/(240.7 + temperature)));\n\t\t    ed = humidity/100.0*es;\n\t\t    eln = Math.log10(ed/6.1078);\n\t\t\ttd = 240.7*eln.payload/(7.6 - eln);\n}\nvar msg = {};\nvar payload = {};\npayload.es = es;\npayload.ed = ed;\npayload.eln = eln;\npayload.td = td;\nmsg.payload = payload;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 1700,
        "wires": [
            [
                "d6d048ac8a1e294e"
            ]
        ]
    },
    {
        "id": "d491854ee6c1a2e7",
        "type": "inject",
        "z": "a8a95e02.bf408",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 1700,
        "wires": [
            [
                "6a8a8a81c6ed56a2"
            ]
        ]
    },
    {
        "id": "6a8a8a81c6ed56a2",
        "type": "ioBroker get",
        "z": "a8a95e02.bf408",
        "name": "temperature.outside",
        "topic": "deconz.0.Sensors.10.temperature",
        "attrname": "temperatureStr",
        "payloadType": "value",
        "errOnInvalidState": "nothing",
        "x": 440,
        "y": 1700,
        "wires": [
            [
                "2d3674619a38b360"
            ]
        ]
    },
    {
        "id": "2d065b759bb9dfdf",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 890,
        "y": 1800,
        "wires": []
    },
    {
        "id": "2d3674619a38b360",
        "type": "ioBroker get",
        "z": "a8a95e02.bf408",
        "name": "humidity.outside",
        "topic": "deconz.0.Sensors.9.humidity",
        "attrname": "humidityStr",
        "payloadType": "value",
        "errOnInvalidState": "nothing",
        "x": 700,
        "y": 1700,
        "wires": [
            [
                "016c215c20e0261d",
                "2d065b759bb9dfdf"
            ]
        ]
    },
    {
        "id": "d6d048ac8a1e294e",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1130,
        "y": 1700,
        "wires": []
    },
    {
        "id": "056e97f5ebf07cf4",
        "type": "cronplus",
        "z": "a8a95e02.bf408",
        "name": "",
        "outputField": "timestamp",
        "timeZone": "",
        "persistDynamic": false,
        "commandResponseMsgOutput": "output1",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "ventilation/settings",
                "payloadType": "date",
                "payload": "",
                "expressionType": "cron",
                "expression": "* */5 * * * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 180,
        "y": 1940,
        "wires": [
            [
                "8642fdd714ecf7a9"
            ]
        ]
    },
    {
        "id": "432ec8d37cb3f4e1",
        "type": "mqtt out",
        "z": "a8a95e02.bf408",
        "name": "",
        "topic": "",
        "qos": "0",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f1f93d18.375ea",
        "x": 950,
        "y": 1940,
        "wires": []
    },
    {
        "id": "2849825550dc2b53",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "d": true,
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 730,
        "y": 2040,
        "wires": []
    },
    {
        "id": "8642fdd714ecf7a9",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "format MQTT message",
        "func": "let epochTimestamp = msg.timestamp;\n\nmsg.payload = {};\nmsg.payload.epochTimestamp = epochTimestamp;\nmsg.payload.timestamp = new Date(epochTimestamp).toISOString();\nmsg.payload.mode = \"IDLE\";\nmsg.payload.metadata = { \"env\": { \"inside\": {}}};\n//msg.payload.metadata.env = {};\n//msg.payload.metadata.env.inside = {};\nmsg.payload.metadata.env.inside.temperature = 42;\nmsg.payload.metadata.env.inside.humidity= 200;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 1940,
        "wires": [
            [
                "2849825550dc2b53",
                "432ec8d37cb3f4e1"
            ]
        ]
    },
    {
        "id": "6ea99d7469cbf44d",
        "type": "deconz-output",
        "z": "a8a95e02.bf408",
        "name": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "groups/device_id/18"
        ],
        "device_name": "",
        "query": "{}",
        "commands": [
            {
                "arg": {
                    "on": {
                        "type": "set",
                        "value": "true"
                    },
                    "alert": {
                        "type": "str",
                        "value": ""
                    },
                    "effect": {
                        "type": "str",
                        "value": ""
                    },
                    "colorloopspeed": {
                        "type": "num",
                        "value": ""
                    },
                    "transitiontime": {
                        "type": "num",
                        "value": ""
                    },
                    "retryonerror": {
                        "type": "num",
                        "value": "0"
                    },
                    "aftererror": {
                        "type": "continue",
                        "value": ""
                    },
                    "bri": {
                        "direction": "set",
                        "type": "msg",
                        "value": "brightness"
                    },
                    "sat": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "hue": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "ct": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "xy": {
                        "direction": "set",
                        "type": "json",
                        "value": "[]"
                    }
                },
                "type": "deconz_state",
                "domain": "groups"
            }
        ],
        "specific": {
            "delay": {
                "type": "num",
                "value": "0"
            },
            "result": {
                "type": "at_end",
                "value": ""
            }
        },
        "x": 1070,
        "y": 2240,
        "wires": [
            []
        ]
    },
    {
        "id": "e18d3d356c6da389",
        "type": "inject",
        "z": "a8a95e02.bf408",
        "name": "trigger",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 190,
        "y": 2240,
        "wires": [
            [
                "65ad5e82e09c7444"
            ]
        ]
    },
    {
        "id": "65ad5e82e09c7444",
        "type": "subflow:a0bf89c9c0c89918",
        "z": "a8a95e02.bf408",
        "name": "",
        "env": [
            {
                "name": "ID",
                "value": "DIMMER_1",
                "type": "str"
            },
            {
                "name": "durationMunites",
                "value": "3",
                "type": "num"
            }
        ],
        "x": 430,
        "y": 2240,
        "wires": [
            [
                "a839ef386320331d"
            ],
            [
                "c5acffefbf42bbad"
            ]
        ]
    },
    {
        "id": "592dca5ba0dd7536",
        "type": "deconz-output",
        "z": "a8a95e02.bf408",
        "name": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "groups/device_id/18"
        ],
        "device_name": "",
        "query": "{}",
        "commands": [
            {
                "arg": {
                    "on": {
                        "type": "set",
                        "value": "false"
                    },
                    "alert": {
                        "type": "str",
                        "value": ""
                    },
                    "effect": {
                        "type": "str",
                        "value": ""
                    },
                    "colorloopspeed": {
                        "type": "num",
                        "value": ""
                    },
                    "transitiontime": {
                        "type": "num",
                        "value": "50"
                    },
                    "retryonerror": {
                        "type": "num",
                        "value": "0"
                    },
                    "aftererror": {
                        "type": "continue",
                        "value": ""
                    },
                    "bri": {
                        "direction": "set",
                        "type": "num",
                        "value": "0"
                    },
                    "sat": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "hue": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "ct": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "xy": {
                        "direction": "set",
                        "type": "json",
                        "value": "[]"
                    }
                },
                "type": "deconz_state",
                "domain": "groups"
            }
        ],
        "specific": {
            "delay": {
                "type": "num",
                "value": "0"
            },
            "result": {
                "type": "at_end",
                "value": ""
            }
        },
        "x": 1070,
        "y": 2280,
        "wires": [
            []
        ]
    },
    {
        "id": "c5acffefbf42bbad",
        "type": "function",
        "z": "a8a95e02.bf408",
        "name": "reset brightness",
        "func": "if (context.global.wakeup === undefined) {\n    context.global.wakeup = { brightness: 0 };\n}\n\ncontext.global.wakeup.brightness = 0;\ndelete msg[\"delay\"];\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 2280,
        "wires": [
            [
                "592dca5ba0dd7536"
            ]
        ]
    },
    {
        "id": "a839ef386320331d",
        "type": "change",
        "z": "a8a95e02.bf408",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "brightness",
                "pt": "msg",
                "to": "value",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 2240,
        "wires": [
            [
                "6ea99d7469cbf44d"
            ]
        ]
    },
    {
        "id": "c8f62523fdef93f2",
        "type": "inject",
        "z": "a8a95e02.bf408",
        "name": "reset",
        "props": [
            {
                "p": "reset",
                "v": "true",
                "vt": "bool"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 190,
        "y": 2300,
        "wires": [
            [
                "65ad5e82e09c7444"
            ]
        ]
    },
    {
        "id": "35254ba8cdc0b106",
        "type": "cronplus",
        "z": "a8a95e02.bf408",
        "name": "",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "test_schedule",
                "topic": "topic1",
                "payloadType": "default",
                "payload": "",
                "expressionType": "cron",
                "expression": "0 48 10 * * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 180,
        "y": 2440,
        "wires": [
            [
                "242891c38d612137"
            ]
        ]
    },
    {
        "id": "242891c38d612137",
        "type": "debug",
        "z": "a8a95e02.bf408",
        "name": "debug 10",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 430,
        "y": 2440,
        "wires": []
    },
    {
        "id": "ee16368d8b86d83b",
        "type": "ioBroker in",
        "z": "8e42c1ce474ca950",
        "name": "Severity changed",
        "topic": "dwd.0.warning.severity",
        "payloadType": "value",
        "onlyack": "update",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "outFormat": "ioBroker",
        "x": 180,
        "y": 80,
        "wires": [
            [
                "86b830f9a238506a"
            ]
        ]
    },
    {
        "id": "572b2faf46d7102b",
        "type": "inject",
        "z": "8e42c1ce474ca950",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "dwd.0.warning.severity",
        "payload": "0",
        "payloadType": "str",
        "x": 210,
        "y": 40,
        "wires": [
            [
                "86b830f9a238506a"
            ]
        ]
    },
    {
        "id": "f5f4b1b1f4964653",
        "type": "subflow:a50e9ae33aac98c4",
        "z": "8e42c1ce474ca950",
        "name": "",
        "x": 560,
        "y": 420,
        "wires": [
            [
                "91304201fcc50e67"
            ]
        ]
    },
    {
        "id": "8ad1c9aa7a456553",
        "type": "subflow:7efede71724c22bc",
        "z": "8e42c1ce474ca950",
        "name": "",
        "env": [
            {
                "name": "attribute-names",
                "value": "severity,type,object,description,text,headline,begin,end,level,instruction,map",
                "type": "str"
            }
        ],
        "x": 580,
        "y": 240,
        "wires": [
            [
                "8c09ca80650cf350",
                "a11dfbdb881aa8f5"
            ]
        ]
    },
    {
        "id": "86b830f9a238506a",
        "type": "function",
        "z": "8e42c1ce474ca950",
        "name": "truncate topic name",
        "func": "// transform e.g. dwd.0.warning1.severity -> dwd.0.warning1\n// as a topic name\nconst regex = /^(dwd.0.warning[0-9]*)\\.?.*/;\nconst match = msg.topic.match(regex);\n//console.log(`Match: ${match[1]}`);\nmsg.topic = match[1];\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 80,
        "wires": [
            [
                "8c09ca80650cf350",
                "92ff1c3aab156391"
            ]
        ]
    },
    {
        "id": "8c09ca80650cf350",
        "type": "debug",
        "z": "8e42c1ce474ca950",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1030,
        "y": 80,
        "wires": []
    },
    {
        "id": "f8ac7c0443840616",
        "type": "comment",
        "z": "8e42c1ce474ca950",
        "name": "TODO - Determine relevance of the message",
        "info": "Determine relevance of the message.\nDiscard it if not relevant, otherwise send telegram message.",
        "x": 610,
        "y": 300,
        "wires": []
    },
    {
        "id": "e6ea06ecae0e08cf",
        "type": "comment",
        "z": "8e42c1ce474ca950",
        "name": "Maybe we can determine the relevance here already",
        "info": "If we only need one ot two attributes to determine relevance, maybe we can do that here.",
        "x": 630,
        "y": 120,
        "wires": []
    },
    {
        "id": "7424704285a73ab3",
        "type": "ioBroker in",
        "z": "8e42c1ce474ca950",
        "name": "Severity changed",
        "topic": "dwd.0.warning1.severity",
        "payloadType": "value",
        "onlyack": "update",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "outFormat": "ioBroker",
        "x": 180,
        "y": 120,
        "wires": [
            [
                "86b830f9a238506a"
            ]
        ]
    },
    {
        "id": "92ff1c3aab156391",
        "type": "function",
        "z": "8e42c1ce474ca950",
        "name": "filter non-relevant messages",
        "func": "// filter irrelevant messages\nif (msg.payload === \"0\") {\n    return null;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 160,
        "wires": [
            [
                "9521288522a9f87d"
            ]
        ]
    },
    {
        "id": "ed73372039f8c6b8",
        "type": "ioBroker in",
        "z": "8e42c1ce474ca950",
        "name": "Severity changed",
        "topic": "dwd.0.warning3.severity",
        "payloadType": "value",
        "onlyack": "update",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "outFormat": "ioBroker",
        "x": 180,
        "y": 200,
        "wires": [
            [
                "86b830f9a238506a"
            ]
        ]
    },
    {
        "id": "7c06ac44964b3537",
        "type": "ioBroker in",
        "z": "8e42c1ce474ca950",
        "name": "Severity changed",
        "topic": "dwd.0.warning4.severity",
        "payloadType": "value",
        "onlyack": "update",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "outFormat": "ioBroker",
        "x": 180,
        "y": 240,
        "wires": [
            [
                "86b830f9a238506a"
            ]
        ]
    },
    {
        "id": "ac667cb74bd14d50",
        "type": "ioBroker in",
        "z": "8e42c1ce474ca950",
        "name": "Severity changed",
        "topic": "dwd.0.warning2.severity",
        "payloadType": "value",
        "onlyack": "update",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "outFormat": "ioBroker",
        "x": 180,
        "y": 160,
        "wires": [
            [
                "86b830f9a238506a"
            ]
        ]
    },
    {
        "id": "a11dfbdb881aa8f5",
        "type": "function",
        "z": "8e42c1ce474ca950",
        "name": "filter non-relevant messages",
        "func": "// filter irrelevant messages\n// from https://github.com/ioBroker/ioBroker.dwd/blob/master/main.js\n\n// Warning levels\n// 5 = Warnungen vor extremem Unwetter\n// 4 = Unwetterwarnungen\n// 3 = Warnungen vor markantem Wetter\n// 2 = Wetterwarnungen\n// 1 = Vorabinformatio Unwetter\n\n// Warning types\n// 0 = Gewitter inklusive Begleiterscheinungen\n// 1 = Wind/Sturm/Orkan\n// 2 = Stark- und Dauerregen\n// 3 = Schneefall/Schneeverwehungen\n// 4 = Nebel\n// 5 = Frost\n// 6 = Glätte/Glatteis\n// 7 = Tauwetter\n// 8 = Hitzewarnungen\n// 9 = UV-Warnungen\n//10 = Küstenwarnungen ??\n//11 = Binnenseewarnungen ??\n\n// So basically we're only interrested in types 0 and 1\n// and probably only levels 4 and 5\nif ([\"0\", \"1\"].includes(msg.type) && [\"3\", \"4\", \"5\"].includes(msg.level)) {\n    return msg;\n}\n\n//msg.headline = \"IGNORE - \" + msg.headline;\n\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 340,
        "wires": [
            [
                "43fedf95db7980e1"
            ]
        ]
    },
    {
        "id": "9521288522a9f87d",
        "type": "delay",
        "z": "8e42c1ce474ca950",
        "name": "",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 500,
        "y": 200,
        "wires": [
            [
                "8ad1c9aa7a456553"
            ]
        ]
    },
    {
        "id": "43fedf95db7980e1",
        "type": "function",
        "z": "8e42c1ce474ca950",
        "name": "formatting",
        "func": "msg.begin = new Date(Number(msg.begin)).toLocaleString();\nmsg.end = new Date(Number(msg.end)).toLocaleString();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 380,
        "wires": [
            [
                "f5f4b1b1f4964653"
            ]
        ]
    },
    {
        "id": "76b65c15e0842ca0",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "8e42c1ce474ca950",
        "name": "Move shutter terrasse",
        "env": [
            {
                "name": "shutter.name",
                "value": "terrasse",
                "type": "str"
            }
        ],
        "x": 1100,
        "y": 500,
        "wires": [
            [
                "82db8e4c08412106"
            ]
        ]
    },
    {
        "id": "927ac6466c5a7e49",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "8e42c1ce474ca950",
        "name": "Move shutter office",
        "env": [
            {
                "name": "shutter.name",
                "value": "office",
                "type": "str"
            }
        ],
        "x": 1090,
        "y": 420,
        "wires": [
            [
                "82db8e4c08412106"
            ]
        ]
    },
    {
        "id": "9bd60117e73ffb2c",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "8e42c1ce474ca950",
        "name": "Move shutter garden",
        "env": [
            {
                "name": "shutter.name",
                "value": "garden",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "0",
                "type": "num"
            }
        ],
        "x": 1100,
        "y": 540,
        "wires": [
            [
                "82db8e4c08412106"
            ]
        ]
    },
    {
        "id": "6a6ad40c7902055f",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "8e42c1ce474ca950",
        "name": "Move shutter kitchen",
        "env": [
            {
                "name": "shutter.name",
                "value": "kitchen",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 1100,
        "y": 580,
        "wires": [
            [
                "82db8e4c08412106"
            ]
        ]
    },
    {
        "id": "55208da4555886d3",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "8e42c1ce474ca950",
        "name": "Move shutter bedroom",
        "env": [
            {
                "name": "shutter.name",
                "value": "bedroom",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 1100,
        "y": 660,
        "wires": [
            [
                "82db8e4c08412106"
            ]
        ]
    },
    {
        "id": "82db8e4c08412106",
        "type": "mqtt out",
        "z": "8e42c1ce474ca950",
        "name": "",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f1f93d18.375ea",
        "x": 1390,
        "y": 540,
        "wires": []
    },
    {
        "id": "91304201fcc50e67",
        "type": "change",
        "z": "8e42c1ce474ca950",
        "name": "override",
        "rules": [
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "half-close",
                "fromt": "str",
                "to": "half-open",
                "tot": "str"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "close",
                "fromt": "str",
                "to": "closed",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 420,
        "wires": [
            [
                "927ac6466c5a7e49",
                "76b65c15e0842ca0",
                "9bd60117e73ffb2c",
                "6a6ad40c7902055f",
                "55208da4555886d3"
            ]
        ]
    },
    {
        "id": "5a53fa21bbc09fa8",
        "type": "debug",
        "z": "8e42c1ce474ca950",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1410,
        "y": 500,
        "wires": []
    },
    {
        "id": "c03c6dcf3c9b3e22",
        "type": "ioBroker out",
        "z": "9de561f7972ae9bc",
        "name": "Dekobeleuchtung.on",
        "topic": "hue.0.Dekobeleuchtung.on",
        "ack": "false",
        "autoCreate": "false",
        "stateName": "",
        "role": "",
        "payloadType": "",
        "readonly": "",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 960,
        "y": 420,
        "wires": []
    },
    {
        "id": "9d067551d47fbfbf",
        "type": "change",
        "z": "9de561f7972ae9bc",
        "name": "false",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 730,
        "y": 480,
        "wires": [
            [
                "c03c6dcf3c9b3e22",
                "1f4bb3b59de89b17",
                "e350ad4fbd69f6cf",
                "747d11137f778843",
                "e50fc4afd9ceb191",
                "0e1d04f52b86b231"
            ]
        ]
    },
    {
        "id": "1f4bb3b59de89b17",
        "type": "ioBroker out",
        "z": "9de561f7972ae9bc",
        "name": "Pflanzenlampe.on",
        "topic": "hue.0.Pflanzenlampe.on",
        "ack": "false",
        "autoCreate": "false",
        "stateName": "",
        "role": "",
        "payloadType": "",
        "readonly": "",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 950,
        "y": 460,
        "wires": []
    },
    {
        "id": "e0e48d0f69707e6b",
        "type": "mqtt out",
        "z": "9de561f7972ae9bc",
        "name": "",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f1f93d18.375ea",
        "x": 1210,
        "y": 660,
        "wires": []
    },
    {
        "id": "115c73520ce364ed",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "9de561f7972ae9bc",
        "name": "Move shutter terrasse",
        "env": [
            {
                "name": "shutter.name",
                "value": "terrasse",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 960,
        "y": 580,
        "wires": [
            [
                "e0e48d0f69707e6b"
            ]
        ]
    },
    {
        "id": "55845f55050f3f18",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "9de561f7972ae9bc",
        "name": "Move shutter office",
        "env": [
            {
                "name": "shutter.name",
                "value": "office",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 950,
        "y": 540,
        "wires": [
            [
                "e0e48d0f69707e6b"
            ]
        ]
    },
    {
        "id": "5d3d1c4c799f78c9",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "9de561f7972ae9bc",
        "name": "Move shutter garden",
        "env": [
            {
                "name": "shutter.name",
                "value": "garden",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "0",
                "type": "num"
            }
        ],
        "x": 960,
        "y": 720,
        "wires": [
            [
                "e0e48d0f69707e6b"
            ]
        ]
    },
    {
        "id": "9ba92c6e50a155aa",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "9de561f7972ae9bc",
        "name": "Move shutter kitchen",
        "env": [
            {
                "name": "shutter.name",
                "value": "kitchen",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 960,
        "y": 620,
        "wires": [
            [
                "e0e48d0f69707e6b"
            ]
        ]
    },
    {
        "id": "6fd3530214079ddf",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "9de561f7972ae9bc",
        "name": "Move shutter bedroom",
        "env": [
            {
                "name": "shutter.name",
                "value": "bedroom",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 960,
        "y": 780,
        "wires": [
            [
                "e0e48d0f69707e6b"
            ]
        ]
    },
    {
        "id": "7bc8a060c8f56346",
        "type": "change",
        "z": "9de561f7972ae9bc",
        "name": "closed",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "closed",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 700,
        "wires": [
            [
                "846195e667d02d44"
            ]
        ]
    },
    {
        "id": "90c35f786b335bfa",
        "type": "change",
        "z": "9de561f7972ae9bc",
        "name": "half-open",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "half-open",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 620,
        "wires": [
            [
                "2a5db8cf6c0c31f4"
            ]
        ]
    },
    {
        "id": "e350ad4fbd69f6cf",
        "type": "sonos-universal",
        "z": "9de561f7972ae9bc",
        "confignode": "e440dc25.3eb78",
        "command": "group.stop",
        "state": "",
        "stateType": "str",
        "avoidCheckPlayerAvailability": false,
        "name": "Sonos Livingarea",
        "x": 950,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "e50fc4afd9ceb191",
        "type": "sonos-universal",
        "z": "9de561f7972ae9bc",
        "confignode": "9a755bfc.1124c8",
        "command": "group.stop",
        "state": "",
        "stateType": "str",
        "avoidCheckPlayerAvailability": false,
        "name": "Sonos Office",
        "x": 930,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "747d11137f778843",
        "type": "sonos-universal",
        "z": "9de561f7972ae9bc",
        "confignode": "a641922fff0cd09a",
        "command": "group.stop",
        "state": "",
        "stateType": "str",
        "avoidCheckPlayerAvailability": false,
        "name": "Sonos Restroom",
        "x": 950,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "105cbf0869d9bb20",
        "type": "deconz-input",
        "z": "9de561f7972ae9bc",
        "name": "Switch | Day  / Night",
        "topic": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "sensors/uniqueid/dc:8e:95:ff:fe:2e:1d:3b-01-1000",
            "sensors/uniqueid/18:7a:3e:ff:fe:f1:68:1f-01-1000"
        ],
        "device_name": "",
        "query": "{}",
        "outputs": 1,
        "output_rules": [
            {
                "type": "state",
                "format": "single",
                "output": "onchange",
                "onstart": false,
                "payload": [
                    "__complete__"
                ]
            }
        ],
        "x": 150,
        "y": 580,
        "wires": [
            [
                "a374e53beff772e2"
            ]
        ]
    },
    {
        "id": "a374e53beff772e2",
        "type": "switch",
        "z": "9de561f7972ae9bc",
        "name": "",
        "property": "payload.buttonevent",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "2002",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "1002",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 330,
        "y": 580,
        "wires": [
            [
                "db24fdc7a908cfd3"
            ],
            [
                "d26165ae67e297d4"
            ]
        ],
        "outputLabels": [
            "night = off",
            "day = on"
        ]
    },
    {
        "id": "db24fdc7a908cfd3",
        "type": "switch",
        "z": "9de561f7972ae9bc",
        "name": "Join",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 470,
        "y": 480,
        "wires": [
            [
                "9d067551d47fbfbf",
                "90c35f786b335bfa",
                "7bc8a060c8f56346"
            ]
        ]
    },
    {
        "id": "a68115ef6c4d82db",
        "type": "change",
        "z": "9de561f7972ae9bc",
        "name": "open",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "open",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 660,
        "wires": [
            [
                "2a5db8cf6c0c31f4",
                "846195e667d02d44"
            ]
        ]
    },
    {
        "id": "2a5db8cf6c0c31f4",
        "type": "switch",
        "z": "9de561f7972ae9bc",
        "name": "Join",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 750,
        "y": 580,
        "wires": [
            [
                "9ba92c6e50a155aa",
                "115c73520ce364ed",
                "55845f55050f3f18"
            ]
        ]
    },
    {
        "id": "846195e667d02d44",
        "type": "switch",
        "z": "9de561f7972ae9bc",
        "name": "Join",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 750,
        "y": 740,
        "wires": [
            [
                "5d3d1c4c799f78c9",
                "6fd3530214079ddf"
            ]
        ]
    },
    {
        "id": "d26165ae67e297d4",
        "type": "change",
        "z": "9de561f7972ae9bc",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 200,
        "y": 760,
        "wires": [
            [
                "02f3d2df3dd9f291",
                "c555a531679a5bcf"
            ]
        ]
    },
    {
        "id": "02f3d2df3dd9f291",
        "type": "ioBroker out",
        "z": "9de561f7972ae9bc",
        "name": "",
        "topic": "states.preventAutomaticShutterMovement.bedroom.active",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "bedroom",
        "role": "",
        "payloadType": "boolean",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 330,
        "y": 800,
        "wires": []
    },
    {
        "id": "c555a531679a5bcf",
        "type": "delay",
        "z": "9de561f7972ae9bc",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 400,
        "y": 760,
        "wires": [
            [
                "a68115ef6c4d82db"
            ]
        ]
    },
    {
        "id": "0e1d04f52b86b231",
        "type": "deconz-output",
        "z": "9de561f7972ae9bc",
        "name": "Dekobeleuchtung",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "groups/device_id/17"
        ],
        "device_name": "",
        "query": "{}",
        "commands": [
            {
                "arg": {
                    "on": {
                        "type": "msg",
                        "value": "payload"
                    },
                    "alert": {
                        "type": "str",
                        "value": ""
                    },
                    "effect": {
                        "type": "str",
                        "value": ""
                    },
                    "colorloopspeed": {
                        "type": "num",
                        "value": ""
                    },
                    "transitiontime": {
                        "type": "num",
                        "value": ""
                    },
                    "retryonerror": {
                        "type": "num",
                        "value": "0"
                    },
                    "aftererror": {
                        "type": "continue",
                        "value": ""
                    },
                    "bri": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "sat": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "hue": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "ct": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "xy": {
                        "direction": "set",
                        "type": "json",
                        "value": "[]"
                    }
                },
                "type": "deconz_state",
                "domain": "groups"
            }
        ],
        "specific": {
            "delay": {
                "type": "num",
                "value": "50"
            },
            "result": {
                "type": "at_end",
                "value": ""
            }
        },
        "x": 950,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "ab732fe50f20bd64",
        "type": "mqtt out",
        "z": "f6761c15b55e2d63",
        "name": "",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f1f93d18.375ea",
        "x": 1390,
        "y": 60,
        "wires": []
    },
    {
        "id": "883d68a1203cca1a",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "f6761c15b55e2d63",
        "name": "Move shutter bedroom",
        "env": [
            {
                "name": "shutter.name",
                "value": "bedroom",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 1220,
        "y": 60,
        "wires": [
            [
                "ab732fe50f20bd64"
            ]
        ]
    },
    {
        "id": "5c065b258627eb34",
        "type": "change",
        "z": "f6761c15b55e2d63",
        "name": "closed",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "closed",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1050,
        "y": 200,
        "wires": [
            [
                "883d68a1203cca1a"
            ]
        ]
    },
    {
        "id": "0296e14af995697f",
        "type": "change",
        "z": "f6761c15b55e2d63",
        "name": "open",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "open",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 60,
        "wires": [
            [
                "883d68a1203cca1a"
            ]
        ]
    },
    {
        "id": "acd25e910612ed71",
        "type": "deconz-input",
        "z": "f6761c15b55e2d63",
        "name": "Button | Change clothing",
        "topic": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "sensors/uniqueid/84:ba:20:ff:fe:76:29:6a-01-1000"
        ],
        "device_name": "",
        "query": "{}",
        "outputs": 1,
        "output_rules": [
            {
                "type": "state",
                "format": "single",
                "output": "onchange",
                "onstart": false,
                "payload": [
                    "__complete__"
                ]
            }
        ],
        "x": 110,
        "y": 160,
        "wires": [
            [
                "6cc6f29f5f1699e8"
            ]
        ]
    },
    {
        "id": "b5b0d5f5e08ef74f",
        "type": "ioBroker get",
        "z": "f6761c15b55e2d63",
        "name": "Get Shutter bedroom pos.",
        "topic": "mqtt-client.0.shellies.shutter-bedroom.roller.0.pos",
        "attrname": "payload",
        "payloadType": "value",
        "errOnInvalidState": "nothing",
        "x": 720,
        "y": 80,
        "wires": [
            [
                "f017f1a760f5d3d2"
            ]
        ]
    },
    {
        "id": "f017f1a760f5d3d2",
        "type": "switch",
        "z": "f6761c15b55e2d63",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "100",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 910,
        "y": 80,
        "wires": [
            [
                "bc8ce5cc26c19562"
            ],
            [
                "0296e14af995697f"
            ]
        ]
    },
    {
        "id": "bc8ce5cc26c19562",
        "type": "change",
        "z": "f6761c15b55e2d63",
        "name": "half-open",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "half-open",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "overrideManualChange",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 100,
        "wires": [
            [
                "883d68a1203cca1a"
            ]
        ]
    },
    {
        "id": "6cc6f29f5f1699e8",
        "type": "subflow:c144853baeb5f845",
        "z": "f6761c15b55e2d63",
        "name": "",
        "x": 370,
        "y": 160,
        "wires": [
            [
                "b5b0d5f5e08ef74f"
            ],
            [
                "5c065b258627eb34"
            ]
        ]
    },
    {
        "id": "542b1917fa40ef53",
        "type": "deconz-input",
        "z": "c4f89efe363c2ef8",
        "name": "Switch | Homeoffice on / off",
        "topic": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "sensors/uniqueid/94:34:69:ff:fe:3d:c9:a6-01-1000"
        ],
        "device_name": "",
        "query": "{}",
        "outputs": 1,
        "output_rules": [
            {
                "type": "state",
                "format": "single",
                "output": "onchange",
                "onstart": false,
                "payload": [
                    "__complete__"
                ]
            }
        ],
        "x": 210,
        "y": 140,
        "wires": [
            [
                "89452b5c3020071d"
            ]
        ]
    },
    {
        "id": "a9ad9fb54f7fbcd0",
        "type": "deconz-output",
        "z": "c4f89efe363c2ef8",
        "name": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "lights/uniqueid/70:ac:08:ff:fe:7c:f3:0f-01"
        ],
        "device_name": "",
        "query": "{}",
        "commands": [
            {
                "arg": {
                    "on": {
                        "type": "msg",
                        "value": "payload"
                    },
                    "alert": {
                        "type": "str",
                        "value": ""
                    },
                    "effect": {
                        "type": "str",
                        "value": ""
                    },
                    "colorloopspeed": {
                        "type": "num",
                        "value": ""
                    },
                    "transitiontime": {
                        "type": "num",
                        "value": ""
                    },
                    "retryonerror": {
                        "type": "num",
                        "value": "0"
                    },
                    "aftererror": {
                        "type": "continue",
                        "value": ""
                    },
                    "bri": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "sat": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "hue": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "ct": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "xy": {
                        "direction": "set",
                        "type": "json",
                        "value": "[]"
                    }
                },
                "type": "deconz_state",
                "domain": "lights"
            }
        ],
        "specific": {
            "delay": {
                "type": "num",
                "value": "50"
            },
            "result": {
                "type": "at_end",
                "value": ""
            }
        },
        "x": 670,
        "y": 140,
        "wires": [
            [
                "cb804d33b74a3c1b"
            ]
        ]
    },
    {
        "id": "cb804d33b74a3c1b",
        "type": "debug",
        "z": "c4f89efe363c2ef8",
        "name": "",
        "active": true,
        "tosidebar": false,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 850,
        "y": 140,
        "wires": []
    },
    {
        "id": "89452b5c3020071d",
        "type": "function",
        "z": "c4f89efe363c2ef8",
        "name": "switch",
        "func": "\n// Button on pressed\nif (msg.payload.buttonevent == 1002) \n{\n    // turn on\n    msg.payload = \"true\";\n}\n// Button off pressed\nelse if (msg.payload.buttonevent == 2002) \n{\n    // turn off\n    msg.payload = \"false\";\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 490,
        "y": 140,
        "wires": [
            [
                "a9ad9fb54f7fbcd0"
            ]
        ]
    },
    {
        "id": "5edadc83a4a5605c",
        "type": "comment",
        "z": "c4f89efe363c2ef8",
        "name": "Activates the HO Table",
        "info": "",
        "x": 200,
        "y": 100,
        "wires": []
    },
    {
        "id": "a71a69ed7dd19567",
        "type": "deconz-input",
        "z": "c4f89efe363c2ef8",
        "name": "Switch | Vitrine on / off",
        "topic": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "sensors/uniqueid/70:ac:08:ff:fe:db:de:23-01-1000"
        ],
        "device_name": "",
        "query": "{}",
        "outputs": 1,
        "output_rules": [
            {
                "type": "state",
                "format": "single",
                "output": "onchange",
                "onstart": false,
                "payload": [
                    "__complete__"
                ]
            }
        ],
        "x": 200,
        "y": 260,
        "wires": [
            [
                "5098bfb27cc46539"
            ]
        ]
    },
    {
        "id": "1957605ca2f05572",
        "type": "comment",
        "z": "c4f89efe363c2ef8",
        "name": "Activates / Deactivates the Vitrine",
        "info": "",
        "x": 230,
        "y": 220,
        "wires": []
    },
    {
        "id": "c1acf3bcc69a23c4",
        "type": "ioBroker out",
        "z": "c4f89efe363c2ef8",
        "name": "On/Off Vitrine.on",
        "topic": "hue.0.Vitrine.on",
        "ack": "false",
        "autoCreate": "false",
        "stateName": "",
        "role": "",
        "payloadType": "",
        "readonly": "",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 590,
        "y": 260,
        "wires": []
    },
    {
        "id": "5098bfb27cc46539",
        "type": "function",
        "z": "c4f89efe363c2ef8",
        "name": "switch",
        "func": "\n// Button on pressed\nif (msg.payload.buttonevent == 1002) \n{\n    // turn on\n    msg.payload = true;\n}\n// Button off pressed\nelse if (msg.payload.buttonevent == 2002) \n{\n    // turn off\n    msg.payload = false;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 260,
        "wires": [
            [
                "c1acf3bcc69a23c4"
            ]
        ]
    },
    {
        "id": "67fafabf64471e9d",
        "type": "deconz-input",
        "z": "c4f89efe363c2ef8",
        "name": "Button | Reset Shutters",
        "topic": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "sensors/uniqueid/84:ba:20:ff:fe:d4:12:52-01-1000"
        ],
        "device_name": "",
        "query": "{}",
        "outputs": 1,
        "output_rules": [
            {
                "type": "state",
                "format": "single",
                "output": "onchange",
                "onstart": false,
                "payload": [
                    "__complete__"
                ]
            }
        ],
        "x": 200,
        "y": 460,
        "wires": [
            [
                "d262cc202d881b49",
                "2f02ae19986d5098",
                "968796676abc2d2b",
                "bf5cd61d9c833f12",
                "1cc0e72b47d62fa7"
            ]
        ]
    },
    {
        "id": "d262cc202d881b49",
        "type": "subflow:9c37ac267425c096",
        "z": "c4f89efe363c2ef8",
        "name": "Reset shutter office",
        "env": [
            {
                "name": "shutter.name",
                "value": "office",
                "type": "str"
            }
        ],
        "x": 630,
        "y": 380,
        "wires": [
            [
                "27c25da64426b1ec"
            ]
        ]
    },
    {
        "id": "1cc0e72b47d62fa7",
        "type": "subflow:9c37ac267425c096",
        "z": "c4f89efe363c2ef8",
        "name": "Reset shutter bedroom",
        "env": [
            {
                "name": "shutter.name",
                "value": "bedroom",
                "type": "str"
            }
        ],
        "x": 640,
        "y": 540,
        "wires": [
            [
                "27c25da64426b1ec"
            ]
        ]
    },
    {
        "id": "2f02ae19986d5098",
        "type": "subflow:9c37ac267425c096",
        "z": "c4f89efe363c2ef8",
        "name": "Reset shutter terrasse",
        "env": [
            {
                "name": "shutter.name",
                "value": "terrasse",
                "type": "str"
            }
        ],
        "x": 640,
        "y": 420,
        "wires": [
            [
                "27c25da64426b1ec"
            ]
        ]
    },
    {
        "id": "968796676abc2d2b",
        "type": "subflow:9c37ac267425c096",
        "z": "c4f89efe363c2ef8",
        "name": "Reset shutter garden",
        "env": [
            {
                "name": "shutter.name",
                "value": "garden",
                "type": "str"
            }
        ],
        "x": 640,
        "y": 460,
        "wires": [
            [
                "27c25da64426b1ec"
            ]
        ]
    },
    {
        "id": "bf5cd61d9c833f12",
        "type": "subflow:9c37ac267425c096",
        "z": "c4f89efe363c2ef8",
        "name": "Reset shutter kitchen",
        "env": [
            {
                "name": "shutter.name",
                "value": "kitchen",
                "type": "str"
            }
        ],
        "x": 640,
        "y": 500,
        "wires": [
            [
                "27c25da64426b1ec"
            ]
        ]
    },
    {
        "id": "d35d3f7f0f95d700",
        "type": "comment",
        "z": "c4f89efe363c2ef8",
        "name": "Bring all shutters back to their currently desired position",
        "info": "",
        "x": 300,
        "y": 420,
        "wires": []
    },
    {
        "id": "27c25da64426b1ec",
        "type": "mqtt out",
        "z": "c4f89efe363c2ef8",
        "name": "",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f1f93d18.375ea",
        "x": 890,
        "y": 460,
        "wires": []
    },
    {
        "id": "b3443123f11f3a9b",
        "type": "cronplus",
        "z": "9d832c5af722ac78",
        "d": true,
        "name": "",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "topic1",
                "payloadType": "default",
                "payload": "",
                "expressionType": "cron",
                "expression": "0 50 6 ? * MON-FRI *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            },
            {
                "name": "schedule2",
                "topic": "topic2",
                "payloadType": "default",
                "payload": "",
                "expressionType": "cron",
                "expression": "0 50 8 ? * SAT-SUN *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 160,
        "y": 80,
        "wires": [
            [
                "82b418c7da8f912c",
                "e0a68a35c11ccb47"
            ]
        ]
    },
    {
        "id": "27d259a900501bd4",
        "type": "switch",
        "z": "9d832c5af722ac78",
        "name": "only if we're home",
        "property": "presence",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 570,
        "y": 240,
        "wires": [
            [
                "22a55e160ddc8539"
            ],
            [
                "0ab06b3fdd8e69b5"
            ]
        ]
    },
    {
        "id": "f7190daba4a489c5",
        "type": "ioBroker get",
        "z": "9d832c5af722ac78",
        "name": "Check presence",
        "topic": "node-red.0.presence.presence",
        "attrname": "presence",
        "payloadType": "value",
        "x": 360,
        "y": 240,
        "wires": [
            [
                "27d259a900501bd4"
            ]
        ]
    },
    {
        "id": "48f73191c3c18d5f",
        "type": "subflow:a0bf89c9c0c89918",
        "z": "9d832c5af722ac78",
        "name": "",
        "env": [
            {
                "name": "ID",
                "value": "DIMMER_AUFWACHLICHT",
                "type": "str"
            }
        ],
        "x": 860,
        "y": 240,
        "wires": [
            [
                "6e76bf456cbc44bf",
                "d3a4547b11a9a307"
            ],
            [
                "252ae15f79a545ff",
                "550352514186b2d1"
            ]
        ]
    },
    {
        "id": "6e76bf456cbc44bf",
        "type": "deconz-output",
        "z": "9d832c5af722ac78",
        "name": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "groups/device_id/18"
        ],
        "device_name": "",
        "query": "{}",
        "commands": [
            {
                "arg": {
                    "on": {
                        "type": "set",
                        "value": "true"
                    },
                    "alert": {
                        "type": "str",
                        "value": ""
                    },
                    "effect": {
                        "type": "str",
                        "value": ""
                    },
                    "colorloopspeed": {
                        "type": "num",
                        "value": ""
                    },
                    "transitiontime": {
                        "type": "num",
                        "value": ""
                    },
                    "retryonerror": {
                        "type": "num",
                        "value": "0"
                    },
                    "aftererror": {
                        "type": "continue",
                        "value": ""
                    },
                    "bri": {
                        "direction": "set",
                        "type": "msg",
                        "value": "value"
                    },
                    "sat": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "hue": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "ct": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "xy": {
                        "direction": "set",
                        "type": "json",
                        "value": "[]"
                    }
                },
                "type": "deconz_state",
                "domain": "groups"
            }
        ],
        "specific": {
            "delay": {
                "type": "num",
                "value": "0"
            },
            "result": {
                "type": "at_end",
                "value": ""
            }
        },
        "x": 1090,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "550352514186b2d1",
        "type": "deconz-output",
        "z": "9d832c5af722ac78",
        "name": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "groups/device_id/18"
        ],
        "device_name": "",
        "query": "{}",
        "commands": [
            {
                "arg": {
                    "on": {
                        "type": "set",
                        "value": "false"
                    },
                    "alert": {
                        "type": "str",
                        "value": ""
                    },
                    "effect": {
                        "type": "str",
                        "value": ""
                    },
                    "colorloopspeed": {
                        "type": "num",
                        "value": ""
                    },
                    "transitiontime": {
                        "type": "num",
                        "value": "50"
                    },
                    "retryonerror": {
                        "type": "num",
                        "value": "0"
                    },
                    "aftererror": {
                        "type": "continue",
                        "value": ""
                    },
                    "bri": {
                        "direction": "set",
                        "type": "num",
                        "value": "0"
                    },
                    "sat": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "hue": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "ct": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "xy": {
                        "direction": "set",
                        "type": "json",
                        "value": "[]"
                    }
                },
                "type": "deconz_state",
                "domain": "groups"
            }
        ],
        "specific": {
            "delay": {
                "type": "num",
                "value": "0"
            },
            "result": {
                "type": "at_end",
                "value": ""
            }
        },
        "x": 1090,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "252ae15f79a545ff",
        "type": "subflow:893d1cfdd62ef503",
        "z": "9d832c5af722ac78",
        "name": "",
        "x": 1120,
        "y": 320,
        "wires": [
            [
                "b19691c4b0a948c6"
            ]
        ]
    },
    {
        "id": "e3e20ed48db44a26",
        "type": "subflow:2595f1ad.a5eb8e",
        "z": "9d832c5af722ac78",
        "name": "Move shutter bedroom",
        "env": [
            {
                "name": "shutter.name",
                "value": "bedroom",
                "type": "str"
            },
            {
                "name": "half-open-position",
                "value": "40",
                "type": "num"
            }
        ],
        "x": 1640,
        "y": 320,
        "wires": [
            [
                "f6435d9c071a1680"
            ]
        ]
    },
    {
        "id": "f6435d9c071a1680",
        "type": "mqtt out",
        "z": "9d832c5af722ac78",
        "name": "",
        "topic": "",
        "qos": "1",
        "retain": "false",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "f1f93d18.375ea",
        "x": 1820,
        "y": 320,
        "wires": []
    },
    {
        "id": "1e7e7497139d42f3",
        "type": "inject",
        "z": "9d832c5af722ac78",
        "name": "manual trigger",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 240,
        "wires": [
            [
                "82b418c7da8f912c",
                "e0a68a35c11ccb47"
            ]
        ]
    },
    {
        "id": "5986d7bdf65edb74",
        "type": "deconz-input",
        "z": "9d832c5af722ac78",
        "name": "Switch | Day  / Night",
        "topic": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "sensors/uniqueid/dc:8e:95:ff:fe:2e:1d:3b-01-1000",
            "sensors/uniqueid/18:7a:3e:ff:fe:f1:68:1f-01-1000"
        ],
        "device_name": "",
        "query": "{}",
        "outputs": 1,
        "output_rules": [
            {
                "type": "state",
                "format": "single",
                "output": "onchange",
                "onstart": false,
                "payload": [
                    "__complete__"
                ]
            }
        ],
        "x": 210,
        "y": 380,
        "wires": [
            [
                "8bf4da479f36682c"
            ]
        ]
    },
    {
        "id": "8bf4da479f36682c",
        "type": "switch",
        "z": "9d832c5af722ac78",
        "name": "only day events",
        "property": "payload.buttonevent",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1002",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 420,
        "y": 380,
        "wires": [
            [
                "eb9bec07059b7b31"
            ]
        ],
        "outputLabels": [
            "day = on"
        ]
    },
    {
        "id": "eb9bec07059b7b31",
        "type": "change",
        "z": "9d832c5af722ac78",
        "name": "reset dimmer",
        "rules": [
            {
                "t": "set",
                "p": "reset",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 380,
        "wires": [
            [
                "48f73191c3c18d5f"
            ]
        ]
    },
    {
        "id": "82b418c7da8f912c",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "Wakeup - Start",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "{\"x\":\"Wakeup procedure initiated.\"}.x",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 390,
        "y": 20,
        "wires": []
    },
    {
        "id": "ec73385370e2511b",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "Wakeup - Start dimmer",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "{\"x\":\"Dimmer started.\"}.x",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 890,
        "y": 200,
        "wires": []
    },
    {
        "id": "0ab06b3fdd8e69b5",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "Wakeup - No presence",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "{\"x\":\"Wakeup procedure cancelled due to no presence.\"}.x",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 910,
        "y": 440,
        "wires": []
    },
    {
        "id": "6f6d542b857eeef1",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "Wakeup - Finish",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "{\"x\":\"Finishing procedure by opening shutter a bit. Waiting one more hour to open them entirely.\"}.x",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1630,
        "y": 280,
        "wires": []
    },
    {
        "id": "6dfa1844c1719f5c",
        "type": "inject",
        "z": "9d832c5af722ac78",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 200,
        "y": 1220,
        "wires": [
            [
                "cabd1838ea4d4240"
            ]
        ]
    },
    {
        "id": "46e9b17114d5e2ac",
        "type": "ioBroker out",
        "z": "9d832c5af722ac78",
        "name": "",
        "topic": "",
        "ack": "true",
        "autoCreate": "true",
        "stateName": "",
        "role": "",
        "payloadType": "boolean",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 780,
        "y": 1220,
        "wires": []
    },
    {
        "id": "777480c6a7c7da72",
        "type": "function",
        "z": "9d832c5af722ac78",
        "name": "preventWakeup",
        "func": "msg.topic = \"states.preventWakeup.active\";\nmsg.stateName = \"preventWakeup\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 580,
        "y": 1220,
        "wires": [
            [
                "46e9b17114d5e2ac"
            ]
        ]
    },
    {
        "id": "cabd1838ea4d4240",
        "type": "change",
        "z": "9d832c5af722ac78",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 380,
        "y": 1220,
        "wires": [
            [
                "777480c6a7c7da72"
            ]
        ]
    },
    {
        "id": "e0a68a35c11ccb47",
        "type": "ioBroker get",
        "z": "9d832c5af722ac78",
        "name": "states.preventWakeup",
        "topic": "node-red.0.states.preventWakeup.active",
        "attrname": "payload",
        "payloadType": "value",
        "errOnInvalidState": "nothing",
        "x": 400,
        "y": 60,
        "wires": [
            [
                "4dbc1905d3c6de03"
            ]
        ]
    },
    {
        "id": "4dbc1905d3c6de03",
        "type": "switch",
        "z": "9d832c5af722ac78",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 60,
        "wires": [
            [
                "ee6bb035ae55d5c6",
                "b3e62e515674c1ab",
                "bfdd75ad6b654b55"
            ],
            [
                "92d761282c565c0d"
            ]
        ]
    },
    {
        "id": "5cc4b4adbd7e2a45",
        "type": "ioBroker out",
        "z": "9d832c5af722ac78",
        "name": "",
        "topic": "states.preventWakeup.active",
        "ack": "true",
        "autoCreate": "false",
        "stateName": "",
        "role": "",
        "payloadType": "boolean",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1080,
        "y": 80,
        "wires": []
    },
    {
        "id": "ee6bb035ae55d5c6",
        "type": "change",
        "z": "9d832c5af722ac78",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 80,
        "wires": [
            [
                "5cc4b4adbd7e2a45"
            ]
        ]
    },
    {
        "id": "b3e62e515674c1ab",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "Wakeup - Prevented",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "{\"x\":\"Wakeup procedure prevented by state. Resetting respective state.\"}.x",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 20,
        "wires": []
    },
    {
        "id": "bfdd75ad6b654b55",
        "type": "change",
        "z": "9d832c5af722ac78",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 120,
        "wires": [
            [
                "08bf0972cc3d2d49"
            ]
        ]
    },
    {
        "id": "08bf0972cc3d2d49",
        "type": "ioBroker out",
        "z": "9d832c5af722ac78",
        "name": "",
        "topic": "states.preventAutomaticShutterMovement.bedroom.active",
        "ack": "true",
        "autoCreate": "false",
        "stateName": "",
        "role": "",
        "payloadType": "boolean",
        "readonly": "false",
        "stateUnit": "",
        "stateMin": "",
        "stateMax": "",
        "x": 1170,
        "y": 120,
        "wires": []
    },
    {
        "id": "b19691c4b0a948c6",
        "type": "function",
        "z": "9d832c5af722ac78",
        "name": "move shutter on regular timeout",
        "func": "if(msg.regularTimeout == false) {\n    // stop here\n    return [null, msg];   \n} \n\nmsg.overrideManualChange = true;\nmsg.payload = \"half-open\";\nreturn [msg, null];",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1370,
        "y": 320,
        "wires": [
            [
                "6f6d542b857eeef1",
                "e3e20ed48db44a26",
                "6f3881c4ef0a60e6"
            ],
            [
                "b99c4225e363bcc1"
            ]
        ]
    },
    {
        "id": "b99c4225e363bcc1",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "Wakeup - Finish by reset",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "{\"x\":\"Procedure has been reset. Shutters will not be moved.\"}.x",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1680,
        "y": 400,
        "wires": []
    },
    {
        "id": "92d761282c565c0d",
        "type": "ioBroker get",
        "z": "9d832c5af722ac78",
        "name": "shutter position",
        "topic": "mqtt-client.0.shellies.shutter-bedroom.roller.0.pos",
        "attrname": "payload",
        "payloadType": "value",
        "errOnInvalidState": "nothing",
        "x": 380,
        "y": 100,
        "wires": [
            [
                "b16032fa0e8424e6"
            ]
        ]
    },
    {
        "id": "b16032fa0e8424e6",
        "type": "switch",
        "z": "9d832c5af722ac78",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "50",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 590,
        "y": 100,
        "wires": [
            [
                "6173bfc5e2630550"
            ],
            [
                "f7190daba4a489c5"
            ]
        ]
    },
    {
        "id": "6173bfc5e2630550",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "Wakeup - Prevented",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "{\"x\":\"Wakeup procedure prevented by shutter position.\"}.x",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 780,
        "y": 40,
        "wires": []
    },
    {
        "id": "3a3225cf57ef1b0c",
        "type": "cronplus",
        "z": "9d832c5af722ac78",
        "name": "",
        "outputField": "payload",
        "timeZone": "",
        "storeName": "",
        "commandResponseMsgOutput": "output1",
        "defaultLocation": "",
        "defaultLocationType": "default",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "topic1",
                "payloadType": "default",
                "payload": "",
                "expressionType": "cron",
                "expression": "0 0 2 * * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 180,
        "y": 780,
        "wires": [
            [
                "29fae2f7dffe6ed1",
                "d7d24130dcb834b3"
            ]
        ]
    },
    {
        "id": "29fae2f7dffe6ed1",
        "type": "weekday",
        "z": "9d832c5af722ac78",
        "d": true,
        "name": "",
        "sun": false,
        "mon": true,
        "tue": true,
        "wed": true,
        "thu": true,
        "fri": true,
        "sat": false,
        "x": 480,
        "y": 720,
        "wires": [
            [
                "c24b1ab6971ec721"
            ],
            [
                "b631ccbad93d8701"
            ]
        ]
    },
    {
        "id": "c24b1ab6971ec721",
        "type": "ioBroker get",
        "z": "9d832c5af722ac78",
        "name": "weekday_alarm",
        "topic": "0_userdata.0.alarm.weekday_alarm",
        "attrname": "alarmActive",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 1100,
        "y": 780,
        "wires": [
            [
                "bda9f2856a166104"
            ]
        ]
    },
    {
        "id": "b631ccbad93d8701",
        "type": "ioBroker get",
        "z": "9d832c5af722ac78",
        "name": "weekend_alarm",
        "topic": "0_userdata.0.alarm.weekend_alarm",
        "attrname": "alarmActive",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 1100,
        "y": 840,
        "wires": [
            [
                "a8e625e31c63d063"
            ]
        ]
    },
    {
        "id": "bda9f2856a166104",
        "type": "ioBroker get",
        "z": "9d832c5af722ac78",
        "name": "weekday_alarmtime",
        "topic": "0_userdata.0.alarm.weekday_alarmtime",
        "attrname": "alarmTime",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 1320,
        "y": 780,
        "wires": [
            [
                "0ea16fdc13199e66"
            ]
        ]
    },
    {
        "id": "a8e625e31c63d063",
        "type": "ioBroker get",
        "z": "9d832c5af722ac78",
        "name": "weekend_alarmtime",
        "topic": "0_userdata.0.alarm.weekend_alarmtime",
        "attrname": "alarmTime",
        "payloadType": "value",
        "errOnInvalidState": "false",
        "x": 1320,
        "y": 840,
        "wires": [
            [
                "0ea16fdc13199e66"
            ]
        ]
    },
    {
        "id": "0ea16fdc13199e66",
        "type": "function",
        "z": "9d832c5af722ac78",
        "name": "function 3",
        "func": "let alarmActive = msg.alarmActive === 'true';\nmsg.payload = {};\nmsg.payload.suspended = !alarmActive;\nif(!alarmActive) {\n    // If the alarm is deactivated, we're ready here.\n    return msg;\n}\n\nlet alarmTimeRaw = msg.alarmTime.split(':');\nlet hour = parseInt(alarmTimeRaw[0]);\nlet minute = parseInt(alarmTimeRaw[1]);\n\n// the wakeup sequence takes 30 minutes \n// (until lights are at 100%)\n// So we have to start 30 minutes earlier that that.\nif (minute >= 30) {\n    minute -= 30;\n} else {\n    hour--;\n    minute += 30;\n}\n\n// Formatting\nif (hour < 10) {\n    hour = '0' + hour;\n}\nif (minute < 10) {\n    minute = '0' + minute;\n}\n\nmsg.payload.triggertime = `${hour}:${minute}:00`;\nmsg.payload.action = 'trigger';\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 700,
        "y": 1000,
        "wires": [
            [
                "6a7472908e01543e",
                "d72f5a3a21581003"
            ]
        ]
    },
    {
        "id": "6a7472908e01543e",
        "type": "eztimer",
        "z": "9d832c5af722ac78",
        "name": "",
        "debug": false,
        "autoname": "",
        "tag": "eztimer",
        "topic": "",
        "suspended": false,
        "sendEventsOnSuspend": false,
        "latLongSource": "manual",
        "latLongHaZone": "zone.home",
        "lat": "48.18609507662278",
        "lon": "11.596313697132464",
        "timerType": "2",
        "startupMessage": false,
        "ontype": "2",
        "ontimesun": "dawn",
        "ontimetod": "",
        "onpropertytype": "msg",
        "onproperty": "payload",
        "onvaluetype": "num",
        "onvalue": 1,
        "onoffset": 0,
        "onrandomoffset": 0,
        "onsuppressrepeats": false,
        "offtype": "9",
        "offtimesun": "dusk",
        "offtimetod": "dusk",
        "offduration": "00:01:00",
        "offpropertytype": "msg",
        "offproperty": "payload",
        "offvaluetype": "num",
        "offvalue": 0,
        "offoffset": 0,
        "offrandomoffset": 0,
        "offsuppressrepeats": true,
        "resend": false,
        "resendInterval": "0s",
        "mon": true,
        "tue": true,
        "wed": true,
        "thu": true,
        "fri": true,
        "sat": true,
        "sun": true,
        "x": 960,
        "y": 1000,
        "wires": [
            [
                "170893f55da920a7"
            ]
        ]
    },
    {
        "id": "74297738f20d3141",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Starting wakeup sequence.\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1430,
        "y": 1000,
        "wires": []
    },
    {
        "id": "170893f55da920a7",
        "type": "function",
        "z": "9d832c5af722ac78",
        "name": "discard invalid triggers",
        "func": "// TODO: Check that the _payload.triggertime is close to\n// current time.\n// eztimer will also send a trigger when it is configured,\n// which is quite annoying. :(\nlet triggerTime = msg._payload.triggertime.split(':');\n\nlet now = new Date();\nlet hour = now.getHours();\nlet minute = now.getMinutes();\n\nif (hour == triggerTime[0] && minute == triggerTime[1]) {\n    return msg;\n}\n\nconsole.log(`triggerTime ${triggerTime} does not equal the current timestamp ${now}. The trigger will be discarded`);\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 1000,
        "wires": [
            [
                "74297738f20d3141",
                "b86a67c572f56bb7"
            ]
        ]
    },
    {
        "id": "636683a3b0d04fc2",
        "type": "inject",
        "z": "9d832c5af722ac78",
        "name": "Startup",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 180,
        "y": 840,
        "wires": [
            [
                "29fae2f7dffe6ed1",
                "58928c0984020d76",
                "d7d24130dcb834b3"
            ]
        ]
    },
    {
        "id": "58928c0984020d76",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Startup detected.\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 840,
        "wires": []
    },
    {
        "id": "d72f5a3a21581003",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Provisioned wakeup sequence at \" & payload.triggertime",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 970,
        "y": 1060,
        "wires": []
    },
    {
        "id": "b86a67c572f56bb7",
        "type": "function",
        "z": "9d832c5af722ac78",
        "name": "do nothing",
        "func": "\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 150,
        "y": 140,
        "wires": [
            [
                "e0a68a35c11ccb47",
                "82b418c7da8f912c"
            ]
        ]
    },
    {
        "id": "d7d24130dcb834b3",
        "type": "german-holidays",
        "z": "9d832c5af722ac78",
        "name": "",
        "topic": "",
        "region": "",
        "holidays": [
            {
                "id": "NEUJAHRSTAG",
                "name": "Neujahrstag",
                "nameAlt": "",
                "character": 2,
                "month": 1,
                "day": 1,
                "nth": 0,
                "dow": 1,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "HEILIGEDREIKOENIGE",
                "name": "Heilige Drei Könige",
                "nameAlt": "Epiphanias",
                "character": 2,
                "month": 1,
                "day": 6,
                "nth": 0,
                "dow": 6,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "KARFREITAG",
                "name": "Karfreitag",
                "nameAlt": "",
                "character": 2,
                "month": -1,
                "day": -2,
                "nth": 0,
                "dow": -2,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "OSTERMONTAG",
                "name": "Ostermontag",
                "nameAlt": "",
                "character": 2,
                "month": -1,
                "day": 1,
                "nth": 0,
                "dow": 1,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "TAG_DER_ARBEIT",
                "name": "Maifeiertag",
                "nameAlt": "Tag der Arbeit",
                "character": 256,
                "month": 5,
                "day": 1,
                "nth": 0,
                "dow": 1,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "CHRISTIHIMMELFAHRT",
                "name": "Christi Himmelfahrt",
                "nameAlt": "Vatertag",
                "character": 2,
                "month": -1,
                "day": 39,
                "nth": 5,
                "dow": 4,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "PFINGSTMONTAG",
                "name": "Pfingstmontag",
                "nameAlt": "",
                "character": 2,
                "month": -1,
                "day": 50,
                "nth": 7,
                "dow": 1,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "FRONLEICHNAM",
                "name": "Fronleichnam",
                "nameAlt": "",
                "character": 2,
                "month": -1,
                "day": 60,
                "nth": 8,
                "dow": 4,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "MARIAHIMMELFAHRT",
                "name": "Mariä Himmelfahrt",
                "nameAlt": "",
                "character": 1024,
                "month": 8,
                "day": 15,
                "nth": 2,
                "dow": 1,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "DEUTSCHEEINHEIT",
                "name": "Tag der Deutschen Einheit",
                "nameAlt": "",
                "character": 4,
                "month": 10,
                "day": 3,
                "nth": 0,
                "dow": 3,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "ALLERHEILIGEN",
                "name": "Allerheiligen",
                "nameAlt": "",
                "character": 2,
                "month": 11,
                "day": 1,
                "nth": 0,
                "dow": 1,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "ERSTERWEIHNACHTSFEIERTAG",
                "name": "1. Weihnachtstag",
                "nameAlt": "Christtag",
                "character": 2,
                "month": 12,
                "day": 25,
                "nth": 3,
                "dow": 4,
                "plType": "none",
                "plValue": ""
            },
            {
                "id": "ZWEITERWEIHNACHTSFEIERTAG",
                "name": "2. Weihnachtstag",
                "nameAlt": "Stefanitag",
                "character": 2,
                "month": 12,
                "day": 26,
                "nth": 3,
                "dow": 5,
                "plType": "none",
                "plValue": ""
            }
        ],
        "specialdays": [],
        "x": 480,
        "y": 780,
        "wires": [
            [
                "16d7e4104f03466d"
            ]
        ]
    },
    {
        "id": "16d7e4104f03466d",
        "type": "function",
        "z": "9d832c5af722ac78",
        "name": "isWorkingDay, weekend or holiday",
        "func": "let today = msg.payload.today;\nif (today.isHoliday) {\n    return [null, null, msg];\n}\nif(today.isWeekend) {\n    return [null, msg, null];\n}\nreturn [msg, null, null];",
        "outputs": 3,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 780,
        "wires": [
            [
                "c24b1ab6971ec721"
            ],
            [
                "b631ccbad93d8701"
            ],
            [
                "b631ccbad93d8701",
                "b28e62a61e9148a1"
            ]
        ]
    },
    {
        "id": "b28e62a61e9148a1",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "Holiday!",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "\"Today is \" & payload.today.name & \" \\\\o/\"",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1090,
        "y": 900,
        "wires": []
    },
    {
        "id": "348fa428871d9453",
        "type": "ioBroker in",
        "z": "9d832c5af722ac78",
        "name": "Dimmer state change command",
        "topic": "node-red.0.states.timer.dimmer_aufwachlicht.active",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe-preinitvalue",
        "gap": "",
        "fireOnStart": "false",
        "outFormat": "ioBroker",
        "x": 250,
        "y": 440,
        "wires": [
            [
                "877f31a27e67583f"
            ]
        ]
    },
    {
        "id": "b2e722b86cae6357",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "debug 7",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 500,
        "wires": []
    },
    {
        "id": "e7dca90b0f09c202",
        "type": "switch",
        "z": "9d832c5af722ac78",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "false",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 630,
        "y": 440,
        "wires": [
            [
                "eb9bec07059b7b31",
                "b2e722b86cae6357"
            ]
        ]
    },
    {
        "id": "9995df1f65900eb5",
        "type": "ioBroker in",
        "z": "9d832c5af722ac78",
        "name": "Dimmer state change command",
        "topic": "node-red.0.states.timer.dimmer_aufwachlicht.active",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe-preinitvalue",
        "gap": "",
        "fireOnStart": "false",
        "outFormat": "ioBroker",
        "x": 250,
        "y": 500,
        "wires": [
            [
                "b5e6fc252e88c726"
            ]
        ]
    },
    {
        "id": "b5e6fc252e88c726",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 560,
        "wires": []
    },
    {
        "id": "877f31a27e67583f",
        "type": "switch",
        "z": "9d832c5af722ac78",
        "name": "",
        "property": "acknowledged",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 490,
        "y": 440,
        "wires": [
            [
                "e7dca90b0f09c202"
            ]
        ]
    },
    {
        "id": "d3a4547b11a9a307",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "Wakeup - Dimmer value changed",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "{\"message\":\"Dimmer value changed.\", \"value\": $.value}",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1180,
        "y": 200,
        "wires": []
    },
    {
        "id": "552add287a1e5a49",
        "type": "inject",
        "z": "9d832c5af722ac78",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 620,
        "wires": [
            [
                "22a55e160ddc8539"
            ]
        ]
    },
    {
        "id": "22a55e160ddc8539",
        "type": "subflow:395982643a88a924",
        "z": "9d832c5af722ac78",
        "name": "",
        "x": 360,
        "y": 300,
        "wires": [
            [
                "c98eb7bd79ee8b09"
            ]
        ]
    },
    {
        "id": "3a17c784178dadb2",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "debug 9",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 340,
        "wires": []
    },
    {
        "id": "c98eb7bd79ee8b09",
        "type": "function",
        "z": "9d832c5af722ac78",
        "name": "Calculate wakeup timer settings",
        "func": "let now = new Date();\nlet sunrise = new Date(msg.solarEvents.sunrise);\n\nlet durationChange = 30; // minutes\nlet minDurationHold = 30; // minutes\n\nmsg.timer = {};\nmsg.timer.durationChange = durationChange;\n\nlet timeToSunrise = Math.floor((sunrise.getTime() - now.getTime()) / 60000); // minutes\nmsg.timer.timeToSunrise = timeToSunrise;\n\nlet calulcatedDurationHold = timeToSunrise - durationChange;\nif (calulcatedDurationHold < minDurationHold) {\n    msg.timer.durationHold = minDurationHold;\n    msg.timer.calculatedDurationHold = calulcatedDurationHold;\n} else {\n    msg.timer.durationHold = calulcatedDurationHold;\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 300,
        "wires": [
            [
                "3a17c784178dadb2",
                "48f73191c3c18d5f",
                "ec73385370e2511b"
            ]
        ]
    },
    {
        "id": "0ba22655f18a0767",
        "type": "ioBroker in",
        "z": "9d832c5af722ac78",
        "name": "weekday alarm changed",
        "topic": "0_userdata.0.alarm.weekday_alarmtime",
        "payloadType": "value",
        "onlyack": "",
        "func": "rbe",
        "gap": "",
        "fireOnStart": "false",
        "outFormat": "ioBroker",
        "x": 230,
        "y": 900,
        "wires": [
            [
                "d7d24130dcb834b3"
            ]
        ]
    },
    {
        "id": "df2a33e5fe99636f",
        "type": "ioBroker in",
        "z": "9d832c5af722ac78",
        "name": "weekend alarm changed",
        "topic": "0_userdata.0.alarm.weekend_alarmtime",
        "payloadType": "value",
        "onlyack": "",
        "func": "all",
        "gap": "",
        "fireOnStart": "false",
        "outFormat": "ioBroker",
        "x": 230,
        "y": 940,
        "wires": [
            [
                "d7d24130dcb834b3"
            ]
        ]
    },
    {
        "id": "6850e6d00c5ba7dd",
        "type": "subflow:72258bd0d3dfaa6d",
        "z": "9d832c5af722ac78",
        "name": "",
        "x": 1360,
        "y": 440,
        "wires": [
            [
                "64f3437c062242f7"
            ]
        ]
    },
    {
        "id": "6f3881c4ef0a60e6",
        "type": "delay",
        "z": "9d832c5af722ac78",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "hours",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1300,
        "y": 400,
        "wires": [
            [
                "6850e6d00c5ba7dd"
            ]
        ]
    },
    {
        "id": "64f3437c062242f7",
        "type": "change",
        "z": "9d832c5af722ac78",
        "name": "payload = open",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "open",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1320,
        "y": 480,
        "wires": [
            [
                "e3e20ed48db44a26",
                "d3bf09babebb535f"
            ]
        ]
    },
    {
        "id": "d3bf09babebb535f",
        "type": "debug",
        "z": "9d832c5af722ac78",
        "name": "Open Shutter",
        "active": true,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "{\"x\":\"Opening shutter bedroom entirely.\"}.x",
        "targetType": "jsonata",
        "statusVal": "",
        "statusType": "auto",
        "x": 1580,
        "y": 480,
        "wires": []
    },
    {
        "id": "c8e35a348395dc50",
        "type": "cronplus",
        "z": "acc19fe5f27ac7a1",
        "name": "",
        "outputField": "payload",
        "timeZone": "",
        "persistDynamic": false,
        "commandResponseMsgOutput": "output1",
        "outputs": 1,
        "options": [
            {
                "name": "schedule1",
                "topic": "topic1",
                "payloadType": "bool",
                "payload": "false",
                "expressionType": "cron",
                "expression": "0 0 20 * * *",
                "location": "",
                "offset": "0",
                "solarType": "all",
                "solarEvents": "sunrise,sunset"
            }
        ],
        "x": 160,
        "y": 120,
        "wires": [
            [
                "6f204f46d221bdf7"
            ]
        ]
    },
    {
        "id": "6f204f46d221bdf7",
        "type": "deconz-output",
        "z": "acc19fe5f27ac7a1",
        "name": "",
        "config_version": 2,
        "server": "966aead04bc37acf",
        "statustext": "",
        "statustext_type": "auto",
        "search_type": "device",
        "device_list": [
            "lights/uniqueid/70:ac:08:ff:fe:7c:f3:0f-01"
        ],
        "device_name": "",
        "query": "{}",
        "commands": [
            {
                "arg": {
                    "on": {
                        "type": "msg",
                        "value": "payload"
                    },
                    "alert": {
                        "type": "str",
                        "value": ""
                    },
                    "effect": {
                        "type": "str",
                        "value": ""
                    },
                    "colorloopspeed": {
                        "type": "num",
                        "value": ""
                    },
                    "transitiontime": {
                        "type": "num",
                        "value": ""
                    },
                    "retryonerror": {
                        "type": "num",
                        "value": "0"
                    },
                    "aftererror": {
                        "type": "continue",
                        "value": ""
                    },
                    "bri": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "sat": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "hue": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "ct": {
                        "direction": "set",
                        "type": "num",
                        "value": ""
                    },
                    "xy": {
                        "direction": "set",
                        "type": "json",
                        "value": "[]"
                    }
                },
                "type": "deconz_state",
                "domain": "lights"
            }
        ],
        "specific": {
            "delay": {
                "type": "num",
                "value": "50"
            },
            "result": {
                "type": "at_end",
                "value": ""
            }
        },
        "x": 390,
        "y": 120,
        "wires": [
            [
                "515e64dacb36504f"
            ]
        ]
    },
    {
        "id": "515e64dacb36504f",
        "type": "debug",
        "z": "acc19fe5f27ac7a1",
        "name": "",
        "active": true,
        "tosidebar": false,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 570,
        "y": 120,
        "wires": []
    },
    {
        "id": "a9c92038274303c7",
        "type": "comment",
        "z": "acc19fe5f27ac7a1",
        "name": "Switch off Office desk at 8 PM.",
        "info": "",
        "x": 220,
        "y": 80,
        "wires": []
    }
]